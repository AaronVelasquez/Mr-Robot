define(['jquery','underscore','ko','mage/storage'],function($,_,ko){'use strict';return{notificationItems:[],complete:ko.observable(false),product:function(id,pageType,ajaxUrl,icons){var self=this,notifications,date,localStorage=$.initNamespaceStorage('bloatfish-socialproofnotifications-storage').localStorage;if(localStorage.isSet(pageType,id)){_.each(localStorage.keys(pageType),function(pid){if(new Date(localStorage.get(pageType,pid).timeout)<new Date()){localStorage.remove(pageType,pid);}});}
if(localStorage.isSet(pageType,id)){_.each(localStorage.get(pageType,id).notifications,function(notification){self.notificationItems.push(notification);});self.complete(true);return false;}
return $.ajax({url:ajaxUrl,type:'POST',dataType:'json',data:{id:id}}).done(function(data){if(data.success!==false){notifications=data.notifications;date=new Date();if(_.size(notifications)>0){_.each(notifications,function(notification,type){notification['icon']=icons[type];self.notificationItems.push(notification);});self.complete(true);date.setTime(date.getTime()+15*1000);localStorage.set(pageType,id,{'timeout':date,'notifications':notifications});}}});}};});