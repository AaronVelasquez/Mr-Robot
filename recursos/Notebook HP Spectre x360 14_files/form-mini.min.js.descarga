define(['ko','jquery','underscore','mage/template','Magento_Catalog/js/price-utils','Magento_Ui/js/lib/knockout/template/loader','jquery/ui','mage/translate','Magento_Search/form-mini','loader'],function(ko,$,_,mageTemplate,priceUtil,templateLoader){'use strict';$.widget('smileEs.quickSearch',$.mage.quickSearch,{options:{autocomplete:'off',minSearchLength:2,responseFieldElements:'dl dd',selectClass:'selected',submitBtn:'button[type="submit"]',searchLabel:'[data-role=minisearch-label]',topSuggestionsItemTemplate:'#top_suggestions_template',suggestedCategoriesItemTemplate:'#suggested_categories_template',productItemTemplate:'#product_item_template',learnBlockTemplate:'#learn_block_template',phoneNumber:'.phone_text',disableEnter:false,fieldOverride:["suggested_retail_price","name","sku","image_full_link","full_link","url_key","meta_title","default_image"]},_create:function(){},_bindNoticeSlideDown:function(globalNotice,toggleSpeed){globalNotice.slideDown(toggleSpeed,function(){if($(".page-header .header.content").height()>5){if(window.innerWidth<768){$(".quick-search-close-icon").css({top:"48px",cssText:'margin-top: 0 !important'});}else{$(".quick-search-close-icon").css({top:"0"});}}});},_initTemplates:function(){var template;for(template in this.options.templates){if({}.hasOwnProperty.call(this.options.templates,template)){this._loadTemplate(template);}}},_initTitleRenderer:function(){var typeIdentifier;this.titleRenderers={};for(typeIdentifier in this.options.templates){if(this.options.templates[typeIdentifier]['titleRenderer']){require([this.options.templates[typeIdentifier]['titleRenderer']],function(renderer){this.component.titleRenderers[this.type]=renderer;}.bind({component:this,type:typeIdentifier}));}}},_loadTemplate:function(type){var templateFile=this.options.templates[type]['template'];templateLoader.loadTemplate(templateFile).done(function(renderer){this.options.templates[type]['template']=renderer;}.bind(this));},_getTemplate:function(element){var source=this.options.template;var type=element.type?element.type:'undefined';if(this.templateCache[type]){return this.templateCache[type];}
if(element.type&&this.options.templates&&this.options.templates[element.type]){source=this.options.templates[element.type].template;}
this.templateCache[type]=mageTemplate(source);return this.templateCache[type];},_renderItem:function(element,index){var template=this._getTemplate(element);element.index=index;if(element.price&&!isNaN(element.price)){element.price=priceUtil.formatPrice(element.price,this.options.priceFormat);}
return template({data:element});},_getResultWrapper:function(){return $('<div class="smile-elasticsuite-autocomplete-result"></div>');},_getSectionHeader:function(type,data){var title='';var header=$('<dl role="listbox" class="autocomplete-list"></dl>');if(type!==undefined){title=this._getSectionTitle(type,data);header.append($.mage.__(title));}
return header;},_getSectionTitle:function(type,data){var title='';if(this.titleRenderers&&this.titleRenderers[type]){title=$('<dt role="listbox" class="autocomplete-list-title title-'+type+'">'
+this.titleRenderers[type].render(data)+'</dt>');}else if(this.options.templates&&this.options.templates[type].title){title=$('<dt role="listbox" class="autocomplete-list-title title-'+type+'">'
+this.options.templates[type].title+'</dt>');}
return title;},_isEmpty:function(value){return value===null||value.trim().length===0;},_onPropertyChange:_.debounce(function(e){var value=this.element.val(),self=this,searchResults=[];$('.header-right .phone_text').hide();$('.search .search-btn').hide();$('#language-option').hide();$('#search_mini_form .input-group-addon').addClass('icon-clear');if(this._isEmpty(value)){$('.search .actions.clear').hide();}else{$('.search .actions.clear').show();}
if(value.length>=parseInt(this.options.minSearchLength,10)){if(self.currentRequestKeyword&&self.currentRequestKeyword.trim()===value.trim()){return;}
if(self.currentRequest!==null){self.currentRequest.abort();}
setTimeout(function(){self.currentRequestKeyword=value;self.currentRequest=$.ajax({method:"POST",url:self.options.url,dataType:"json",contentType:'application/json',traditional:true,data:JSON.stringify({ClientGuid:self.options.clientGuid,Keyword:decodeURI(value),query:'(store_id.keyword: 0 OR store_id.keyword: '+self.options.storeId+')',ClientData:{"VisitorId":self.options.visitorId,"Custom":{"custom":websiteCode},"UserAgent":navigator.userAgent},FieldOverride:self.options.fieldOverride}),beforeSend:function(){$("#hot-search-menu-loader").show();$("#hot-search-loader").show();$('.search-autocomplete-left .top_suggestions_box').hide();$('.search-autocomplete-left .suggested_categories_box').hide();$('.search-autocomplete-right .products-box').hide();$('.search-autocomplete-right .learn-box').hide();$('.search-autocomplete-right .support-box').hide();$('.search-autocomplete.hawk-search .no-result-message').hide();$('.search-autocomplete.hawk-search .all-results').hide();if(self.currentRequest!==null){self.currentRequest.abort();}},success:$.proxy(function(data){var searchFormHeight;self.currentRequestKeyword='';self.lastSearchKeyword=value;$("#search_autocomplete").addClass("show");$('.message.global.inside-notice').addClass('hidden');$('.spin_toggle').addClass('hidden');$('#inside_holder').addClass('hidden');$('.page-wrapper .page-header').addClass('page-header-top');$('.pc-contact-us-new').hide();$('.page-header.floating').css('top',0);searchFormHeight=$('#search_mini_form').height();searchFormHeight=searchFormHeight>0?searchFormHeight:102;if($('#search_mini_form').find('.input-group').length){searchFormHeight+=$('#search_mini_form').find('.input-group').height();}
$('.hawk-search-autocomplete-overlay').css({'top':searchFormHeight,'height':$(window).height()-searchFormHeight}).show().closest('.header.content').addClass('hawk-search-open');$(window).width()<1366&&$("#search_autocomplete").css('height',$(window).height()-searchFormHeight);this.initSwitcherLanguage(true);$(".quick-search-close-icon").css({"top":0});$('body').css('overflow','hidden');$(".search .actions.close").show();$("#hot-search-loader").hide();$("#hot-search-menu-loader").hide();$('.minicart-wrapper').hide();$('.search-autocomplete-right .support-box').show();$('#ink_autocomplete').css('z-index','auto');if(self._isEmpty(value)){$('.search .actions.clear').hide();}else{$('.search .actions.clear').show();}
searchResults.push({key:'default',data:data});if(data['Popular'].length){$('.search-autocomplete-left .top_suggestions_box').html($(mageTemplate(self.options.topSuggestionsItemTemplate)({'result':data['Popular'],'searchUrl':self.options.searchUrl,'heading':$.mage.__('Top suggestions')}))).show();}else{$('.search-autocomplete-left .top_suggestions_box').hide();}
if(data['Categories'].length){$('.search-autocomplete-left .suggested_categories_box').html($(mageTemplate(self.options.suggestedCategoriesItemTemplate)({'result':data['Categories'],'searchUrl':self.options.searchUrl,'heading':$.mage.__('Suggested Categories'),'keyword':self.lastSearchKeyword}))).show();}else{$('.search-autocomplete-left .suggested_categories_box').hide();}
if(data['Products'].length){$('.search-autocomplete-right .products-box').html($(mageTemplate(self.options.productItemTemplate)({'result':data['Products'],'heading':$.mage.__('Shop'),'baseUrl':self.options.baseUrl,'storeId':self.options.storeId,'priceUtil':priceUtil,'priceFormat':self.options.priceFormat}))).show();$('.search-autocomplete.hawk-search .all-results').show();self.options.disableEnter=true;}else{$('.search-autocomplete-right .products-box').hide();$('.search-autocomplete.hawk-search .all-results').hide();self.options.disableEnter=false;}
if(data['Content'].length){$('.search-autocomplete-right .learn-box').html($(mageTemplate(self.options.learnBlockTemplate)({'result':data['Content'],'heading':$.mage.__('Explore'),'baseUrl':self.options.baseUrl}))).show();}else{$('.search-autocomplete-right .learn-box').hide();}
if(!data['Content'].length&&!data['Products'].length){$('.search-autocomplete.hawk-search .no-result-message').show();}
self._setAutoCompleteBackGround();self._bindSuggestMouseOver(searchResults);self._bindAllResultMouseOver(searchResults,'.search-autocomplete-left .all-results');self._bindAllResultMouseOver(searchResults,'.search-autocomplete .hover-left-auto-complete');self._bindAllResultMouseOver(searchResults,'#search');},self)});},250);}else{if(this.currentRequest!==null){this.currentRequest.abort();}
this._resetResponseList(true);this.autoComplete.hide();$("#search_autocomplete").removeClass("show");$('.message.global.inside-notice').removeClass('hidden');$('.spin_toggle').removeClass('hidden');$('#inside_holder').removeClass('hidden');$('.page-wrapper .page-header').removeClass('page-header-top');$('.pc-contact-us-new').show();$('.hawk-search-autocomplete-overlay').hide().closest('.header.content').removeClass('hawk-search-open');$('#language-option').show();this.initSwitcherLanguage();$(".quick-search-close-icon").css({"top":0});$('.minicart-wrapper').show();$('body').css('overflow','inherit');$(".search .actions.close").hide();$('.search .actions.clear').hide();$('.header-right .phone_text').show();$('.search .search-btn').removeAttr('style');$('#search_mini_form .input-group-addon').removeClass('icon-clear');$('#ink_autocomplete').css('z-index',9999);this._updateAriaHasPopup(false);this.element.removeAttr('aria-activedescendant');if($('.message.global.inside-notice.floating').is(":visible")){$('.page-header.floating').css('top',$('.message.global.inside-notice.floating').outerHeight(true));}}},250),_setAutoCompleteBackGround:function(){$('.search-autocomplete.hawk-search').css('background-color','#f7f7f7');},_bindAllResultMouseOver:function(searchResults,hoverClass){var self=this;$(hoverClass).on("mouseover",function(){var products,contents;$(".search-autocomplete-left a").removeClass("active");for(var i=0;i<searchResults.length;i++){if(searchResults[i].key==='default'){if(self.currentRequest!==null){self.currentRequest.abort();$("#hot-search-loader").hide();}
if(searchResults[i].data['Products'].length){$('.search-autocomplete-right .products-box').html($(mageTemplate(self.options.productItemTemplate)({'result':searchResults[i].data['Products'],'heading':$.mage.__('Shop'),'baseUrl':self.options.baseUrl,'storeId':self.options.storeId,'priceUtil':priceUtil,'priceFormat':self.options.priceFormat}))).show();}else{$('.search-autocomplete-right .products-box').hide();}
if(searchResults[i].data['Content'].length){$('.search-autocomplete-right .learn-box').html($(mageTemplate(self.options.learnBlockTemplate)({'result':searchResults[i].data['Content'],'heading':$.mage.__('Explore'),'baseUrl':self.options.baseUrl}))).show();}else{$('.search-autocomplete-right .learn-box').hide();}
self._setAutoCompleteBackGround();}}});},_bindSuggestMouseOver:function(searchResults){var self=this;$(".search-autocomplete-left .top_suggestions_box a, "+".search-autocomplete-left .suggested_categories_box a").on("mouseover",function(e){var status=true,products,contents,searchParams,searchField,currentTarget;$(".search-autocomplete-left a").removeClass("active");if(!$(e.target).attr('search')){currentTarget=$(e.target).parent();}else{currentTarget=$(e.target);}
currentTarget.addClass('active');for(var i=0;i<searchResults.length;i++){if(searchResults[i].key===currentTarget.attr('type')+'_'+currentTarget.attr('search')){if(self.currentRequest!==null){self.currentRequest.abort();$("#hot-search-loader").hide();}
status=false;if(searchResults[i].data['Products'].length){$('.search-autocomplete-right .products-box').html($(mageTemplate(self.options.productItemTemplate)({'result':searchResults[i].data['Products'],'heading':$.mage.__('Shop'),'baseUrl':self.options.baseUrl,'storeId':self.options.storeId,'priceUtil':priceUtil,'priceFormat':self.options.priceFormat}))).show();}else{$('.search-autocomplete-right .products-box').hide();}
if(searchResults[i].data['Content'].length){$('.search-autocomplete-right .learn-box').html($(mageTemplate(self.options.learnBlockTemplate)({'result':searchResults[i].data['Content'],'heading':$.mage.__('Explore'),'baseUrl':self.options.baseUrl}))).show();}else{$('.search-autocomplete-right .learn-box').hide();}
$('.search-autocomplete-right .support-box').show();self._setAutoCompleteBackGround();}}
if(status){searchParams={ClientGuid:self.options.clientGuid,Keyword:decodeURI(currentTarget.attr('search')),query:'(store_id.keyword: 0 OR store_id.keyword: '+self.options.storeId+')',ClientData:{"VisitorId":self.options.visitorId,"Custom":{"custom":websiteCode},"UserAgent":navigator.userAgent},FieldOverride:self.options.fieldOverride};searchField=currentTarget.data('searchField');if(searchField){searchParams.query+=' AND '+searchField+'.text: '+currentTarget.attr('search');searchParams.Keyword=self.lastSearchKeyword;}
self.currentRequest=$.ajax({method:"POST",url:self.options.url,dataType:"json",contentType:'application/json',traditional:true,data:JSON.stringify(searchParams),beforeSend:function(){if(self.currentRequest!==null){self.currentRequest.abort();}
$('.search-autocomplete-right .products-box').hide();$('.search-autocomplete-right .learn-box').hide();$('.search-autocomplete-right .support-box').hide();$("#hot-search-loader").show();$(".search-autocomplete-right").css('min-height',$(".search-autocomplete-left").height());$(".hover-left-auto-complete").css('min-height',parseInt($(".search-autocomplete-left").height())+20);},success:$.proxy(function(data){searchResults.push({key:currentTarget.attr('type')+'_'+currentTarget.attr('search'),data:data});$("#hot-search-loader").hide();$('.search-autocomplete-right .support-box').show();if(data['Products'].length){$('.search-autocomplete-right .products-box').html($(mageTemplate(self.options.productItemTemplate)({'result':data['Products'],'heading':$.mage.__('Shop'),'baseUrl':self.options.baseUrl,'storeId':self.options.storeId,'priceUtil':priceUtil,'priceFormat':self.options.priceFormat}))).show();}else{$('.search-autocomplete-right .products-box').hide();}
if(data['Content'].length){$('.search-autocomplete-right .learn-box').html($(mageTemplate(self.options.learnBlockTemplate)({'result':data['Content'],'heading':$.mage.__('Explore'),'baseUrl':self.options.baseUrl}))).show();}else{$('.search-autocomplete-right .learn-box').hide();}
self._setAutoCompleteBackGround();})});}});},_onKeyDown:function(e){var keyCode=e.keyCode||e.which;switch(keyCode){case $.ui.keyCode.HOME:this._selectElement(this._getFirstVisibleElement());break;case $.ui.keyCode.END:this._selectElement(this._getLastElement());break;case $.ui.keyCode.ESCAPE:this._resetResponseList(true);this.autoComplete.hide();break;case $.ui.keyCode.ENTER:this._validateElement(e);break;case $.ui.keyCode.DOWN:this._navigateDown();break;case $.ui.keyCode.UP:this._navigateUp();break;default:return true;}},_validateElement:function(event){var selected=this.responseList.selected;if(selected&&selected.attr('href')!==undefined){window.location=selected.attr('href');event.preventDefault();return false;}
if(this.currentRequest!==null){this.currentRequest.abort();}
$('.search-autocomplete-left .all-results').trigger('click');},_navigateDown:function(){var nextElement;if(this.responseList.indexList){if(!this.responseList.selected){this._getFirstVisibleElement().addClass(this.options.selectClass);this.responseList.selected=this._getFirstVisibleElement();}
else if(!this._getLastElement().hasClass(this.options.selectClass)){nextElement=this._getNextElement();this.responseList.selected.removeClass(this.options.selectClass);this.responseList.selected=nextElement.addClass(this.options.selectClass);}else{this.responseList.selected.removeClass(this.options.selectClass);this._getFirstVisibleElement().addClass(this.options.selectClass);this.responseList.selected=this._getFirstVisibleElement();}
this._activateElement();}},_navigateUp:function(){var prevElement;if(this.responseList.indexList!==null){if(!this._getFirstVisibleElement().hasClass(this.options.selectClass)){prevElement=this._getPrevElement();this.responseList.selected.removeClass(this.options.selectClass);this.responseList.selected=prevElement.addClass(this.options.selectClass);}else{this.responseList.selected.removeClass(this.options.selectClass);this._getLastElement().addClass(this.options.selectClass);this.responseList.selected=this._getLastElement();}
this._activateElement();}},_selectElement:function(element){element.addClass(this.options.selectClass);this.responseList.selected=element;},_activateElement:function(){this.element.val(this.responseList.selected.find('.qs-option-name').text());this.element.attr('aria-activedescendant',this.responseList.selected.attr('id'));},_getNextElement:function(){var nextElement=this.responseList.selected.next('dd');if(nextElement.length===0){nextElement=this.responseList.selected.parent('dl').next('dl').find('dd').first();}
return nextElement;},_getPrevElement:function(){var prevElement=this.responseList.selected.prev('dd');this.responseList.selected.removeClass(this.options.selectClass);if(prevElement.length===0){prevElement=this.responseList.selected.parent('dl').prev('dl').find('dd').last();}
return prevElement;},initSwitcherLanguage:function(state=false){var switchLanguageNav=$('#switcher-language-nav');if(switchLanguageNav.length){if(window.innerWidth<768){if(state===true){$('#switcher-language-nav').css({"cssText":"margin: 0 !important","line-height":"32px"});}else{var right=parseInt(switchLanguageNav.width())+parseInt(switchLanguageNav.css('right'));$('.header.content .header-right .phone_text').css({"cssText":"right: "+right+"px !important"});}}else{if(!state){$('.header.content .header-right .phone_text').removeAttr('style');}}}}});return $.smileEs.quickSearch;});