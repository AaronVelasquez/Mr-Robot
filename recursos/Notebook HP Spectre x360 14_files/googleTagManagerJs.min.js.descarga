define(['jquery','uiComponent',"jquery/ui",'detectMobileBrowser'],function($,Component){'use strict';var homePageBannerKey='homePageBanner';var smartFinderStep='smartFinderStep';var RepeatClick=true;var gaEncryption={encode:function(str){var r="",len=str.length,i;for(i=0;i<len;i++){r+=str.charCodeAt(i);if(len-1!==i){r+=',';}}
return r;},decode:function(str){var arr=str.split(","),r="",i,code;for(i=0;i<arr.length;i++){code=parseInt(arr[i],10);r+=String.fromCharCode(code);}
return r;}};return Component.extend({promoViewPromotions:[],initialize:function(configData){if((pageName5==='PDP')&&(country=='CL')){this.observerArray();}
this._bindEvents(configData);},observerArray:function(){class NewArray extends Array{constructor(...args){super(...args)}
push(...args){let dataObj=args[0];if((dataObj instanceof Object)&&(dataObj.hasOwnProperty('event'))&&dataObj.event=="e_chat"){$.cookie('livechat_hp',dataObj.chatAction,{expires:30});}
return super.push(...args)}}
dataLayer=new NewArray(...dataLayer);},_bindEvents:function(configData){var _this=this,careParkLabelValue;_this.dataLayerInit(configData);$("#maincontent").on("click","button[id='send2']",function(){var validator=$(this).closest("form[id='login-form']").validate();if(validator.form()){dataLayer.push({'event':'e_userLogin'});}});$(".customer-menu .nav-item.authorization-link a:first").on('click',function(){dataLayer.push({'event':'e_userLogin'});});$(".private-store.guest-show.menu-send").on('click',function(){dataLayer.push({'event':'e_userLogin'});});$(".login_block .cta-blue-btn.page-send").on('click',function(){dataLayer.push({'event':'e_userLogin'});});$(".page-footer").on("click","form[id='newsletter-validate-detail'] button.subscribe",function(){var validator=$(this).closest("form[id='newsletter-validate-detail']").validate(),emailVal;if(validator.form()){emailVal=$("#newsletter").val();if(emailVal!==""){dataLayer.push({'event':'e_emailSubscribe','emailSubscriber':gaEncryption.encode(emailVal),'signupLocation':'footer'});}}});$("#maincontent").on("click","button.save.primary",function(){var subscription=$("#subscription").prop('checked');if(!subscription){dataLayer.push({'event':'e_emailUnSubscribe','emailSubscriber':customerId});}});$(document).on("click",".navigation li.level0.level-top.ui-menu-item "+"ul.ui-menu.ui-widget.ui-widget-content.ui-corner-all.expanded a",function(){if($(this).attr('href')){dataLayer.push({'event':'e_linkClick','linkPlacement':'header','linkID':$(this).attr('href')});}});$(document).on("click",".navigation li.level0.level-top.ui-menu-item",function(){var url;if($(this).children('ul').length<=0){url=$(this).children('a').attr('href');if(url){dataLayer.push({'event':'e_linkClick','linkPlacement':'header','linkID':url});}}});$(document).on("click","footer.page-footer .footer-additional-info-left "+"div[data-content-type='row'] div.footer-links a",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'footer','linkID':$(this).attr('href')});});$(document.body).on("click",".category-compare-list "+"li.compare-action div.has-item>a.compare-now",function(){var compareList=$(".category-compare-list ul.compare-list>li.item");var productNames=compareList.map(function(){return $(this).find('.product-item-link').text();}).get().join();var productIds=compareList.map(function(){return $(this).attr('data-product-sku');}).get().join();dataLayer.push({'event':'e_compareModels','concatProductNames':productNames,'concatProductIDs':productIds});});$(document).on("click",".hero-container .main-wrap .row .hero-content .tagline-wrapper .cta-blue-btn",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'printsubscription:header','linkID':'subscribenow'});});$(document).on("click",".main-section .top-nav-section .main-wrap .top-nav-inner .nav-contents "+".cta-blue-btn",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'printsubscription:header','linkID':'subscribenow'});});$(document).on("click",".faq-section .panel-group .panel-default .question-heading .panel-title "+".collapsed",function(){var id=$(this).attr('href'),linkID='';switch(id){case'#questionOne':linkID="faq1";break;case'#questionTwo':linkID="faq2";break;case'#questionThree':linkID="faq3";break;case'#questionFour':linkID="faq4";break;case'#questionFive':linkID="faq5";break;case'#questionSixth':linkID="faq6";break;case'#questionSeven':linkID="faq7";break;case'#questionEigth':linkID="faq8";break;default:return;}
dataLayer.push({'event':'e_linkClick','linkPlacement':'printsubscription:faq','linkID':linkID});});$(document).on("click",".sw-toolbar-bottom .sw-btn-group-extra .sw-custom-btn-skip",function(){var step=$('#question-form .sw-theme-circles .clickable.active a').attr("href");_this.setCookie(smartFinderStep,step);});$(document).on("click",".sw-toolbar-bottom .sw-btn-group-extra .sw-custom-btn-next",function(){var step=$('#question-form .sw-theme-circles .clickable.active a').attr("href");_this.setCookie(smartFinderStep,step);});$(document).on("click",".sw-toolbar-bottom .sw-btn-group-extra .sw-custom-btn-prev",function(){var step=$('#question-form .sw-theme-circles .clickable.active a').attr("href");_this.setCookie(smartFinderStep,step);});$(document).on("click",".sw-toolbar-bottom .sw-btn-group-extra .sw-btn-reset",function(){var step=_this.getCookie(smartFinderStep),linkPlacement='';if(step==='undefined'){linkPlacement="printsubscription:config-page5";}else{switch(step){case'#step-2':linkPlacement="printsubscription:config-page2";break;case'#step-3':linkPlacement="printsubscription:config-page3";break;case'#step-4':linkPlacement="printsubscription:config-page4";break;default:return;}}
dataLayer.push({'event':'e_linkClick','linkPlacement':linkPlacement,'linkID':'startover'});});$(document).on("click",".additional-message .demobooking a",function(){var sku=$(".product-info-stock-sku .product.attribute.sku .value").html().trim(),name=$(".product.media .page-title-wrapper.product .page-title span").html();dataLayer.push({'event':'e_linkClick','linkPlacement':'demobooking:request','linkID':'demo request | '+name+' | '+sku});});$(document).on("click",".additional-message .demobooking .demo-booking-pdp",function(){var sku=$(".product-info-stock-sku .product.attribute.sku .value").html().trim(),name=$(".product.media .page-title-wrapper.product .page-title span").html();dataLayer.push({'event':'e_linkClick','linkPlacement':'demobooking:request','linkID':'demo request | '+name+' | '+sku});});$(document).on("click","#maincontent .container .row .btn.btn-default",function(){var storeName=$("#maincontent .container .row .col-lg-3 .branch-store-name").html(),sku=_this.getQueryString('sku'),productName=$("#customer-demobooking .form-group .form-control").val();dataLayer.push({'event':'e_linkClick','linkPlacement':'demobooking:book','linkID':'book | '+storeName+' | '+productName+' | '+sku});});$(document).on("click","#product-data .compare-list .compare-body .product-item-actions "+".action.find-in-store.primary",function(){var onclick=$(this).attr("onclick"),regName=new RegExp("(^|&)name=([^&]*)(&|$)","i"),regSku=new RegExp("(^|&)sku=([^&]*)(&|$)","i"),sku=unescape(onclick.match(regSku)[2]),name=unescape(onclick.match(regName)[2]);name=name.replace(/\+/g," ").replace(/\'/,"");dataLayer.push({'event':'e_linkClick','linkPlacement':'printsubscription:config-page5','linkID':'viewdetails | '+name+' | '+sku});});$(document).on("click",".demo-booking-popup table tr td a",function(){var $parent=$(this).parent().parent(),href=$(this).attr("href"),regSku=new RegExp("(^|&)sku=([^&]*)(&|$)","i"),sku=unescape(href.match(regSku)[2]),productName=$(".product.media .page-title-wrapper.product h1 span").html(),storeName=$parent.find(".branch-store-name").html().trim();dataLayer.push({'event':'e_linkClick','linkPlacement':'demobooking:storeselection','linkID':'storeselection | '+storeName+' | '+productName+' | '+sku});});$(document).on("click",".home-top-banner .home-top-banner-v2 .shopping-for-box "+".shopping-for-box-content .search",function(){var siblingsEls=$(this).siblings(".select"),categoryVal,segmentVal;if(siblingsEls[0]!==undefined&&siblingsEls[1]!==undefined){categoryVal=$(siblingsEls[0]).children("select").val();segmentVal=$(siblingsEls[1]).children("select").find("option:selected").text();dataLayer.push({'event':'e_promotionClick','promoClickType':'Find','ecommerce':{'promoClick':{'promotions':[{'id':categoryVal,'name':segmentVal,'position':'HomePage Top Banner Shopping','creative':'',}]}}});}});if(GoogleAnalyze_dataLayer3_coupon!==0&&JSON.stringify(GoogleAnalyze_dataLayer3_coupon)!=="{}"){dataLayer.push({'event':GoogleAnalyze_dataLayer3_coupon.event,'couponCode':GoogleAnalyze_dataLayer3_coupon.code});}
$(".page-header .contact-us").on('click',function(){dataLayer.push({'event':'e_callRequest'});});$(document.body).on("click",".footer_container a[href^='tel:']",function(){dataLayer.push({'event':'e_callRequest'});});$(document.body).on("click",".out-of-stock a:first-child",function(){dataLayer.push({'event':'e_callRequest'});});$(document.body).on("click","#inside_liveChatTab",function(){dataLayer.push({'event':'e_busChatOpen'});});$(".category-tabs.product.data.items").on("click",".data.item.title",function(){var map=['Use','Form Factor','Brand'];if(RepeatClick&&this.innerText.indexOf('View All')>=0){RepeatClick=false;productListPageData['currencyCode']=dlCurrencyCode;dataLayer.push({'event':'e_pageView','pageNameL5':pageName5,'pageNameL6':pageName6,'userTypeSession':customerType,'loginStatus':loginStatus,'ecommerce':productListPageData,});}else if($.inArray(this.innerText,map)>=0){RepeatClick=true;}});$(document).on("change",".product-info-main .product-view-choose-wrap .product-view-choose-config select",function(){var sku=$(this).children('option:selected').data('product-sku');if(sku){dataLayer.push({'event':'e_linkClick','linkPlacement':'pdp','linkID':'configdropdown|'+sku});}});$(document).on("change",".product-care-info .care-container select#product-care-option",function(){var sku=$(this).children('option:selected').val();if(sku&&sku!=='0'){dataLayer.push({'event':'e_linkClick','linkPlacement':'pdp','linkID':'carepackdropdown|'+sku});}});careParkLabelValue=function(label){var regLable=/printer|laptop|desktop/,regLabelArr=regLable.exec(label),linkIdName='';if(regLabelArr){linkIdName=regLabelArr[0];}
return linkIdName;};$(document).on("click",".care-pack-finder-footer .main-section .tabs-container .top-nav .tabMenu li",function(){var value=$(this).children('a').attr('href'),linkIdName='';if(value){linkIdName=careParkLabelValue(value);if(linkIdName){dataLayer.push({'event':'e_linkClick','linkPlacement':'carepackfinder','linkID':linkIdName+'carepack'});}}});$(document).on("click",".product-info-main .additional-message .buy-back-container #buybackButton",function(){var sku=$(this).data('product-sku');if(sku){dataLayer.push({'event':'e_linkClick','linkPlacement':'pdp','linkID':'exchange|'+sku});}});$(document).on("change",".category-tabs.product.data.items .item.content .toolbar-products .limiter "+"select#limiter",function(){var pageLimit=$(this).children('option:selected').val();if(pageLimit){dataLayer.push({'event':'e_linkClick','linkPlacement':'plp','linkID':'showdropdown|'+pageLimit});}});$(document).on("change",".search.results .toolbar.toolbar-products .field.limiter .control select#limiter",function(){var pageLimit=$(this).children('option:selected').val();if(pageLimit){dataLayer.push({'event':'e_linkClick','linkPlacement':'search results','linkID':'showdropdown|'+pageLimit});}});$(document).on("click",".message.global.inside-notice.floating .content .notification "+".inside-notice-content-container a",function(){var buttonName=$(this).find('.top-bar-btn-ga').html();dataLayer.push({'event':'e_linkClick','linkPlacement':'TopBar','linkID':buttonName});});$(document).on("click",".product-dynamic-discount#cart-product-dynamic-discount .recommended-products "+".product-item-actions button",function(){var sku=$(this).data('sku');if(sku){dataLayer.push({'event':'e_linkClick','linkPlacement':'cart|recommended','linkID':sku});}});$(document).on("click",".cart-empty p a",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'cart|clearcart','linkID':'continueshopping'});});$(document).on("click",".checkout-container .place-order-panel-view-cart .actions-toolbar .view-cart",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'onestepcheckout','linkID':'back to cart'});});$(document).on("click",".checkout-container .osc-authentication-wrapper a span",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'onestepcheckout','linkID':'sign in'});});$(document).on("click",".block-discount-products ul>li a",function(){var idValue=$(this).parent('div').attr("id"),namestr,name,position;if(idValue){name=idValue.split('_');namestr=name[1];}
position=$(this).parents('li').index();if(namestr){dataLayer.push({'event':'e_pageView','ecommerce':{'promoView':{'promotions':{'id':parseInt(position,10)+1,'name':'adbutler|sprocketstudio','creative':'adbutler|sprocketstudio','position':'adbutler|'+(parseInt(position,10)+1)},}}});}});var productClickClass=['.product-image-photo','.product-item-name a','.bestsellers-banner','.product-review-rating','.product-item-photo','.product-item-tabbar-left span a'];if($(".product-item-photo").length){productClickClass.shift();}
$.each(productClickClass,function(index,value){$(document).on('click',value,function(e){e.stopPropagation();var $this=$(this),linkPlacement,linkID,sku=_this.getProductSku($this),version=$this.parents(".product-item-info").attr("data-version"),resIdNode=$("input[name='tracking_id']"),resId='',itemProduct={},productClass,productName,productPrice;if(pageName5==='Home'){blockId=blockId&&$this.parents('div.block.block-container').is('.block-bestsellers')?2:1;if(version){linkPlacement='Home featured block';}else{linkPlacement='home featured block '+blockId;}
linkID=_this.getHomePageLinkId($this,sku);}
if($.inArray(value,['.bestsellers-banner','.product-review-rating'])===-1){itemProduct=_this.getItemProductVariant($this,itemProduct);productClass=$this.parents('.product-item').children('.product-item-info');productName=productClass.find('.product-item-link').text();if(productName){itemProduct['name']=productName.trim();}
itemProduct['id']=sku;productPrice=productClass.find('.price-final_price').find('.price-wrapper').attr('data-price-amount');if(productPrice){itemProduct['price']=productPrice;}
if(pageName5=='Cart'){itemProduct['name']=$this.parents('.product-item-info').attr('data-name');itemProduct['price']=$this.parents('.product-item-info').attr('data-price-amount');}
if(pageName5=='PLP'||pageName5=='Search'){itemProduct['variant']='';}
itemProduct=_this.getItemProductPosition($this,itemProduct);let actionFieldList='';if(itemProduct.list){actionFieldList=itemProduct.list;delete itemProduct.list;}
if(resIdNode){resId=resIdNode.val();}
itemProduct=_this.getItemProductCategory($this,itemProduct);if(itemProduct){if(typeof resId!==undefined&&resId!==''){dataLayer.push({event:'e_productClick','ecommerce':{click:{actionField:{list:actionFieldList},products:[itemProduct]}},hsResID:resId});}else{dataLayer.push({event:'e_productClick','ecommerce':{click:{actionField:{list:actionFieldList},products:[itemProduct]}}});}}}else if(!version){dataLayer.push({'event':'e_linkClick','linkPlacement':linkPlacement,'linkID':linkID});}});});$.each(['.block-products.block-bestsellers .block-tabs .tabs label','.block-products.block-best-deals .block-tabs .tabs label','.category-tabs.product.data.items .data.item.title a'],function(index,value){$(document).on('click',value,function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'Tab Click','linkID':$(this).text().trim()});});});$.each(['.category-tabs .toolbar-products .sorter select#sorter','.search.results .toolbar-products .sorter select#sorter'],function(index,value){$(document).on('change',value,function(){var $this=$(this),linkPlacement,pageSorter=$this.children('option:selected').text(),pageNewSorter;if($this.parents().is('.category-tabs')){linkPlacement='plp';}else linkPlacement='searchresults';if(pageSorter){if(pageName5==='Search'||pageName5==='PLP'){return;}
pageNewSorter=pageSorter.trim();dataLayer.push({'event':'e_linkClick','linkPlacement':linkPlacement,'linkID':'sortby|'+pageNewSorter});}});});$.each(['.block-what-is-new .flexsliderImg','.block-what-is-new .flexsliderBtn a'],function(index,value){$(document).on('click',value,function(){var $this=$(this),linkID,position=$this.parents("li").index(),title=$this.parents('.flexs').find('.flexsliderContents').find('h3').text();if(!title.trim()){title=$this.parents('.flexs').find('.flexsliderContents').find('h2').text();}
title=title.trim()?title:'';if($this.is('.flexsliderImg')){linkID='bannerclick|'+title;}else{linkID=$this.text()+'|'+title;}
linkID+='|'+(parseInt(position,10)+1);dataLayer.push({'event':'e_linkClick','linkPlacement':'whats new','linkID':linkID});});});$(".customer-menu .nav-item.authorization-create-link a:first").on('click',function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'create-account','linkID':'customer'});});if($.inArray(country,['IN','TH'])!==-1){$(".agree-and-enroll-button").on("click",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'hp-easy-ink','linkID':'enrollment-success'});});$(".form-smo-edit .smo-subscribe-submit").on("click",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'hp-easy-ink','linkID':'enrollment-detection-success'});});$(document).on("click",".render-printer-container .enrollment-button",function(){dataLayer.push({'event':'e_linkClick','linkPlacement':'hp-easy-ink','linkID':'enrollment-auto-detection-success'});});}
$(document).on("click",".product-data-items .features .more-or-less .more-or-less-features button",function(){if($(this).attr("class")==='show'){dataLayer.push({event:'e_linkClick',linkPlacement:'product',linkID:'see-more-features'});}});$(document).on("click",".product-data-items #specifications-div .more-or-less-specification button",function(){if($(this).attr("class")==='show'){dataLayer.push({event:'e_linkClick',linkPlacement:'product',linkID:'see-complete-specs'});}});},addPromoClick:function($this,pageNameL5){var data=this._getData($this);dataLayer.push({'event':'e_promotionClick','promoClickType':data.clicktype,'ecommerce':{'promoClick':{'promotions':[{'id':data.id,'name':data.name,'creative':data.creative,'position':data.position}]}}});},_getData:function($this){var element=$this;var aParent=$this.parents(".promotion-banner-data").eq(0);if(aParent.length>0&&aParent.attr('data-id')){element=aParent;}
var id=element.attr('data-id'),name=element.attr('data-name'),creative=element.attr('data-creative'),position=element.attr('data-position'),clicktype=element.attr('data-clicktype');if(typeof id==="undefined"){id="";}
if(typeof name==="undefined"){name="";}
if(typeof creative==="undefined"){creative="";}
if(typeof position==="undefined"){position="";}
if(typeof clicktype==="undefined"){clicktype="";}
return{id:id,name:name,creative:creative,position:position.trim(),clicktype:clicktype};},addPromotionImpression:function(data){dataLayer.push({'event':'e_promotionImpression','ecommerce':{'promoView':{'promotions':{'id':data.id,'name':data.name,'creative':data.creative,'position':data.position},}}});},getItemProductCategory:function($this,itemProduct){var category=$this.parents('.product-item-info').attr('data-category');var brand=$this.parents('.product-item-info').attr('data-brand');if(typeof category=='undefined'){category='';}
if(typeof brand=='undefined'){brand='';}
if(pageName5==='PDP'){var data=$this.parents('.product-item-info').attr('data-product')
if(!data||typeof data==='undefined'){return'';}
var productData=JSON.parse(data);itemProduct['category']=productData.category;itemProduct['brand']=productData.brand;itemProduct['price']=typeof productData.price!=='undefined'?productData.price.toString():'';}else{itemProduct['category']=category;itemProduct['brand']=brand;}
return itemProduct;},getItemProductPosition:function($this,itemProduct){var positionName='Shop now',positionId,positionTitle='',slideIndex,position;if($this.hasClass('product-image-photo')){positionName="image";}else if($this.hasClass("product-item-link")){positionName="productname";}else if($this.hasClass("product-item-photo")){positionName="image";}else if($this.hasClass("view-details")){positionName="View Details";}
positionId=$this.parents('li').index();if($this.parents('div').is(".swiper-container.recommendations-products")){slideIndex=$this.parents('.swiper-slide').attr('data-swiper-slide-index');if(slideIndex&&typeof slideIndex!=="undefined"){positionId=parseInt(slideIndex,10);}}
positionId+=1;if(pageName5==='PDP'||pageName5==='Cart'){if(pageName5==='PDP'){positionTitle=$this.parents('.block-content').prev('.block-title').find('strong').text();if(!positionTitle&&$this.parents('div').hasClass('swiper-wrapper')){positionTitle='Customer who viewed this item also viewed';}}else{positionTitle=$this.parents('div .swiper-container').prev('.block-title').find('strong span').text();if(typeof positionTitle==="undefined"||positionTitle===''){positionTitle=$this.parents('.recommended-products').prev('.title').find('h2').text();if(typeof positionTitle=='undefined'||positionTitle===''){positionTitle=$this.parents('.block-content').prev('.block-title').find('strong').text();}}}
itemProduct['position']=positionId;}else{position=$this.parents('li').index();if(!$this.parents('ol').find('li').is('.item-bestsellers-banner')){position+=1;}
if(position){itemProduct['position']=position+'|'+positionName;}}
if(typeof($this.parents('ol').attr('data-title'))!="undefined"){itemProduct['list']=$this.parents('ol').attr('data-title');}else if(typeof($this.parents('ul').attr('data-title'))!="undefined"){itemProduct['list']=$this.parents('ul').attr('data-title');}else{itemProduct['list']=this.getListName();}
return itemProduct;},getItemProductVariant:function($this,itemProduct){var variant,partnerIn,partnerOut,variantStatus;if(pageName5==='PDP'||pageName5==='Cart'){itemProduct['variant']='';}else{variant=$this.parents('.product-item-info').find('.stock-messaging').attr('class');if(variant){partnerIn=/in-stock-messaging/;partnerOut=/out-stock-messaging/;variantStatus='';if(partnerIn.test(variant)){variantStatus="In Stock";}else if(partnerOut.test(variant)){variantStatus="Out of Stock";}
itemProduct['variant']='';}}
return itemProduct;},getHomePageLinkId:function(_this,sku){var linkID,position=_this.parents('li').index(),category=_this.parents('.product-item-info').attr('data-category');if(!_this.parents('ol').find('li').is('.item-bestsellers-banner')){position+=1;}
if(typeof category=='undefined'){category=_this.parents('li').attr('data-category');if(typeof category=='undefined'){category='';}}
if(_this.is('.product-image-photo')){linkID='productimageclick|'+category+'|'+position+'|'+sku;}else if(_this.is('.product-review-rating')){linkID='productreviewclick|'+category+'|'+position+'|'+sku;}else if(_this.is('.bestsellers-banner')){linkID='bannerclick|'+category;}else{linkID='productnameclick|'+category+'|'+position+'|'+sku;}
return linkID;},getProductSku:function(_this){var _product,sku=_this.parents(".product-item-info").find(".product-item-inner").attr("data-sku");if(typeof sku==="undefined"){sku=_this.parents(".product-item-photo").attr("data-sku");if(typeof sku==="undefined"){sku=_this.parents(".product-item-info").attr("data-sku");if(typeof sku==="undefined"){sku=_this.parents(".product-item-details").prev().attr("data-sku");if(typeof sku==="undefined"){_product=_this.parents(".product-item-info").attr("data-product");if(typeof _product!=="undefined"){try{_product=JSON.parse(_product);if(typeof _product.sku!=="undefined"){sku=_product.sku;}}catch(e){}}}}}}
return sku;},getListName:function(){var name=pageName5.toLowerCase();if(name==='pdp'){return'pdp page';}else if(name==='search'){return'search results'}else{return name;}},getQueryString:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null)return unescape(r[2]);return null;},getPromotions:function(selectors,pageNameL5){var pushData=[];var _this=this;var flagArr=[];var positionIndex=1;var positions=[];var topBanner=$(".block-top-banner .promotion-banner");topBanner.each(function(index,element){if(index==0){index=topBanner.length-2;}
var newPosition=pageNameL5+'|'+$(this).attr('data-position')+'|'+index;$(this).attr('data-position',newPosition);})
$(selectors).each(function(index,element){var object={};const data=_this._getData($(this));if(($(this).parents("nav").length>0)&&(pageName5==='Cart')){return true;}
object.id=data.id;if(object.id&&(flagArr.indexOf(object.id)==-1)){object.name=data.name;var result=$.inArray(data.position,positions);if(result==-1){positions.push(data.position);positionIndex=1;}else{positionIndex++;}
if($(this).parents(".block-top-banner").length>0){object.position=data.position;}else{var newPosition=pageNameL5+'|'+data.position+'|'+positionIndex;$(this).attr('data-position',newPosition);object.position=newPosition;}
object.creative=data.creative;object.clicktype=data.clicktype;pushData.push(object);flagArr.push(object.id);}else{var newPosition=$(this).parent(".promo-content").prev().find("a").attr("data-position")
$(this).attr('data-position',newPosition);}});return pushData;},addProductImpression:function(products,currencyCode){dataLayer.push({'event':'e_productImpression','ecommerce':{'impressions':products,'currencyCode':currencyCode}});},dataLayerInit:function(configData){var _this=this,initialDataLayer,position,object={},id,name,orderSegment,customerSegment,urlHash,PLPMap,data=[],quoteItems,productEcommerce,quoteItem,homePageData,jsonArr,cookieOfferId,checkoutSposOfferId;if(customerLoggedIn==1){customerType='Login';loginStatus=true;}else if(localStorage.getItem('hp-new-user')==1){customerType='remembered';}
localStorage.setItem('hp-new-user',1);var pageNameL5=configData.analytics.page_level
initialDataLayer={'event':"e_pageView",'pageNameL5':pageNameL5,'pageNameL6':configData.analytics.product_type,'pageNameL7':configData.analytics.family,'pageNameL8':configData.analytics.simple_title,'userTypeSession':customerType,'loginStatus':loginStatus};initDataLayer=initDataLayer?$.extend(initDataLayer,initialDataLayer):initialDataLayer;var selector='.promotion-banner',promotion_banner=_this.getPromotions(selector,pageNameL5);if(promotion_banner.length!==0){$.each(promotion_banner,function(index,data){_this.pushDataToEcommerce(data);});}
if($(selector).length>0){$(selector).each(function(index,item){$(item).on("click",function(){_this.addPromoClick($(this),pageNameL5);});})}
if(pageName5==='Order Success'){try{orderSegment=localStorage.getItem('orderSegment');customerSegment=localStorage.getItem('customerSegment');if(orderSegment==null){orderSegment='consumer';}
if(customerSegment==null){customerSegment='guest';if(loginStatus){customerSegment='consumer';}}
initDataLayer.customerSegment=customerSegment;initDataLayer.orderSegment=orderSegment;}catch(e){initDataLayer.customerSegment="guest";initDataLayer.orderSegment="consumer";}
var livechatHp=$.cookie('livechat_hp');if(livechatHp&&(country=='CL')){initDataLayer.partnerID=livechatHp;$.cookie('livechat_hp',null,{path:'/'});}
if(paymentSuccessData['purchase']['actionField']['pushed_to_ga']!=1){if(paymentSuccessData['purchase']['actionField']['isrId']&&paymentSuccessData['purchase']['actionField']['isrId']!=0){var pageViewData={'event':'e_pageView','pageNameL5':pageName5,'pageNameL6':pageName6,'userTypeSession':'call center','loginStatus':loginStatus,};if(livechatHp&&(country=='CL')){pageViewData.partnerID=livechatHp;$.cookie('livechat_hp',null,{path:'/'});}
dataLayer.push(pageViewData);}
delete paymentSuccessData['purchase']['actionField']['pushed_to_ga'];delete paymentSuccessData['purchase']['actionField']['isrId'];if(initDataLayer.hasOwnProperty('ecommerce')&&initDataLayer.ecommerce.hasOwnProperty('promoView')){$.extend(initDataLayer.ecommerce,paymentSuccessData);}else{initDataLayer.ecommerce=paymentSuccessData;}
$('#message').html('DataLayer Order Success Info: '+JSON.stringify(paymentSuccessData));}}
if(pageName5==='PDP'){var listTitles={'.product-related-links > .recommended-products':'pdp-recommendedproducts','.youmayalsoliketoconnsider':'pdp-youmayalsolike','.relatedlinks':'pdp-recommendedproducts'};$.each(['.product-item-link','.product-item-photo',],function(index,select){$(select).each(function(index,elemt){index++;var positionName='';var listTitle='';if(select=='.product-item-link'){positionName='productname'}else{positionName="image";}
for(var selector in listTitles){if($(this).parents(selector).length){listTitle=listTitles[selector];}}});});var index=1;var skus=[];var productLists=[];var impressionProducts=[];var impressionsSkus=[];Object.keys(listTitles).forEach(function(key){productLists.push(key);});if(initDataLayer.ecommerce&&typeof initDataLayer.ecommerce.impressions!="undefined"){impressionsSkus=initDataLayer.ecommerce.impressions.map(function(item){return item.id;});}
setTimeout(function(){$.each(productLists,function(index,item){var listTitle=$(item).attr('data-title');$(item).find("[data-product]").each(function(){var that=$(this);var data=that.attr('data-product');var productData=JSON.parse(data);if(productData.hasOwnProperty('category')){if($.inArray(productData.sku,skus)===-1&&$.inArray(productData.sku,impressionsSkus)===-1){index++;var productDataOjb={id:productData.sku,name:productData.name,list:typeof listTitle==='undefined'?'':listTitle,price:productData.price,variant:'',position:index,category:productData.category};impressionProducts.push(productDataOjb);skus.push(productData.sku);}}});});if(impressionProducts){_this.addProductImpression(impressionProducts,dlCurrencyCode);}},2000);if(productDetails){if(initDataLayer.hasOwnProperty('ecommerce')&&initDataLayer.ecommerce.hasOwnProperty('promoView')){$.extend(initDataLayer.ecommerce,productDetails);initDataLayer.ecommerce.currencyCode=dlCurrencyCode;}else{initDataLayer.ecommerce={'currencyCode':dlCurrencyCode};$.extend(initDataLayer.ecommerce,productDetails);}}}
if(pageName5==='Checkout'){initDataLayer.currencyCode=dlCurrencyCode;var checkoutProducts={'checkout':{'actionField':{'step':1,'option':'Shipping / Contact Info'},'products':getCartContentForDataLayer}};if(initDataLayer.hasOwnProperty('ecommerce')&&initDataLayer.ecommerce.hasOwnProperty('promoView')){$.extend(initDataLayer.ecommerce,checkoutProducts);}else{initDataLayer.ecommerce=checkoutProducts;}}
if((pageName5==='PLP'||pageName5==='Search')&&typeof staticImpressions!=="undefined"){urlHash=window.location.hash;PLPMap=['#category.use','#category.form_factor','#category.brand'];if($.inArray(urlHash,PLPMap)<0){staticImpressions['currencyCode']=dlCurrencyCode;if(initDataLayer.hasOwnProperty('ecommerce')&&initDataLayer.ecommerce.hasOwnProperty('promoView')){$.extend(initDataLayer.ecommerce,staticImpressions);}else{initDataLayer.ecommerce=staticImpressions;}
RepeatClick=false;}}
if(pageName5==='Cart'){quoteItems=[];if(window.checkoutConfig&&window.checkoutConfig.quoteItemData){window.checkoutConfig.quoteItemData.forEach(function(value){quoteItem={};quoteItem.name=value['name'];quoteItem.id=value['sku'];quoteItem.price=typeof value['price_incl_tax']==='undefined'?value['price']:value['price_incl_tax'];quoteItem.category=value['category'];quoteItem.variant='';quoteItem.brand=value['brand'];quoteItem.quantity=value['qty'];quoteItems.push(quoteItem);});}
var detail={'detail':{'actionField':{'list':'view cart'},'products':quoteItems}};if(initDataLayer.hasOwnProperty('ecommerce')&&initDataLayer.ecommerce.hasOwnProperty('promoView')){$.extend(initDataLayer.ecommerce,detail);}else{initDataLayer.ecommerce=detail;}
data=[];$.each(['#cart-product-dynamic-discount .recommended-products li','.block.crosssell .products-crosssell li'],function(index,value){$(value).each(function(index,item){productEcommerce=_this.getProductEcommerce($(item).find('.product-item-info'),index);data.push(productEcommerce);});});if(data.length>=1){_this.addProductImpression(data,dlCurrencyCode);}}
cookieOfferId=_this.getCookie('spos_offer_id');if(!_.isEmpty(cookieOfferId)&&typeof cookieOfferId!=="undefined"&&cookieOfferId!=='null'){initDataLayer.offerID=cookieOfferId;initDataLayer.userTypeSession='gen';}
if(_.isEmpty(cookieOfferId)||typeof cookieOfferId=="undefined"||cookieOfferId==='null'){if(typeof window.checkout!="undefined"){checkoutSposOfferId=window.checkout.spos_offer_id;if(!_.isEmpty(checkoutSposOfferId)&&typeof checkoutSposOfferId!=="undefined"&&checkoutSposOfferId!=='null'){initDataLayer.offerID=checkoutSposOfferId;window.checkout.spos_offer_id='';}}}
if(initDataLayer.hasOwnProperty('ecommerce')){var ecommerceObj={ecommerce:initDataLayer.ecommerce};delete initDataLayer.ecommerce;$.extend(initDataLayer,ecommerceObj);this.getGaLogSwitchValue(initDataLayer,configData);dataLayer.push(initDataLayer);}else{this.getGaLogSwitchValue(initDataLayer,configData);dataLayer.push(initDataLayer);}},getGaLogSwitchValue:function(initDataLayer,configData){if(configData.analytics.ga_log_switch_value){this.getInitDataLayer(initDataLayer);}},getInitDataLayer:function(initDataLayer){$.ajax({type:"POST",url:window.BASE_URL+'googletagmanager/index/index',data:initDataLayer,dataType:'json'});},pushDataToEcommerce:function(data){var dataString=data.id+data.name+data.position;if(!data.id||$.inArray(dataString,this.promoViewPromotions)>-1){return;}
if(!initDataLayer.hasOwnProperty('ecommerce')){initDataLayer.ecommerce={'promoView':{'promotions':[data]}};}else if(initDataLayer.ecommerce.hasOwnProperty('promoView')){if(initDataLayer.ecommerce.promoView.hasOwnProperty('promotions')){initDataLayer.ecommerce.promoView.promotions.push(data);}else{initDataLayer.ecommerce.promoView.promotions=[data];}}else{initDataLayer.ecommerce.promoView={'promotions':[data]};}
this.promoViewPromotions.push(dataString);},setCookie:function(cookieName,cookieValue){document.cookie=cookieName+"="+cookieValue+";path=/";},getCookie:function(cookieName){var cookie=" "+document.cookie;var search=" "+cookieName+"=";var setStr='null';var offset=0;var end=0;if(cookie.length>0){offset=cookie.indexOf(search);if(offset!==-1){offset+=search.length;end=cookie.indexOf(";",offset);if(end===-1){end=cookie.length;}
setStr=unescape(cookie.substring(offset,end));}}
return setStr;},getProductEcommerce:function(productItemInfoEle,index){index++;var productEcommerce={},name,sku,price,productLine,productStock,position,category,brand,listTitle;name=productItemInfoEle.find('.product-item-details .product-item-name a').attr('title');if(typeof name==="undefined"){name=productItemInfoEle.find('.product-item-details .product-item-name a').text();}
sku=productItemInfoEle.find('.product-item-photo').attr('data-sku');if(typeof sku==="undefined"){sku=productItemInfoEle.find('.product-item-details .product-item-inner').attr('data-sku');if(typeof sku==="undefined"){sku=productItemInfoEle.attr('data-sku');}}
price=productItemInfoEle.find('.product-item-details .price-final_price .price-wrapper .price').text();if(typeof price==="undefined"||price===''){price=productItemInfoEle.find('.product-item-details .related-discount-price .ga-curren-price').data('value');}
if(typeof price==="string"){price=price.trim();}
productLine=productItemInfoEle.attr('data-product-line');if(typeof productLine==="undefined"||productLine===''){productLine=productItemInfoEle.attr('data-pl');}
productStock=productItemInfoEle.attr('data-product-stock');position=productItemInfoEle.parents('.block-content').prev('.block-title').find('strong').text();if(typeof position==="undefined"||position===''){position=productItemInfoEle.parents('.recommended-products').prev('.title').find('h2').text();}
category=productItemInfoEle.attr('data-category');brand=productItemInfoEle.attr('data-brand');if(typeof(productItemInfoEle.parents('ol').attr('data-title'))!="undefined"){listTitle=productItemInfoEle.parents('ol').attr('data-title');}else{listTitle=this.getListName();}
productEcommerce={'name':name.trim(),'price':price,'category':category,'id':sku,'position':index,'variant':'','list':listTitle}
return productEcommerce;}});});