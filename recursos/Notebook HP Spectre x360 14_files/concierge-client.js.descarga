/* Copyright 2014-2023 © Moxie Software. All Rights Reserved. Concierge Version: v1.35.3 */
!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e){return"function"==typeof e}var a,o,s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},c=0,u=function(e,t){S[c]=e,S[c+1]=t,2===(c+=2)&&(o?o(C):p())};var l="undefined"!=typeof window?window:void 0,d=l||{},g=d.MutationObserver||d.WebKitMutationObserver,f="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function v(){var e=setTimeout;return function(){return e(C,1)}}var p,m,y,w,b,S=new Array(1e3);function C(){for(var e=0;e<c;e+=2){(0,S[e])(S[e+1]),S[e]=void 0,S[e+1]=void 0}c=0}function k(e,t){var n=this,i=new this.constructor(_);void 0===i[O]&&P(i);var r=n._state;if(r){var a=arguments[r-1];u((function(){return W(r,i,a,n._result)}))}else L(n,i,e,t);return i}function E(e){if(e&&"object"===i(e)&&e.constructor===this)return e;var t=new this(_);return T(t,e),t}f?p=function(){return process.nextTick(C)}:g?(y=0,w=new g(C),b=document.createTextNode(""),w.observe(b,{characterData:!0}),p=function(){b.data=y=++y%2}):h?((m=new MessageChannel).port1.onmessage=C,p=function(){return m.port2.postMessage(0)}):p=void 0===l&&"function"==typeof require?function(){try{var e=Function("return this")().require("vertx");return void 0!==(a=e.runOnLoop||e.runOnContext)?function(){a(C)}:v()}catch(e){return v()}}():v();var O=Math.random().toString(36).substring(2);function _(){}var I=void 0;function x(e,t,n){t.constructor===e.constructor&&n===k&&t.constructor.resolve===E?function(e,t){1===t._state?A(e,t._result):2===t._state?N(e,t._result):L(t,void 0,(function(t){return T(e,t)}),(function(t){return N(e,t)}))}(e,t):void 0===n?A(e,t):r(n)?function(e,t,n){u((function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,(function(n){i||(i=!0,t!==n?T(e,n):A(e,n))}),(function(t){i||(i=!0,N(e,t))}),e._label);!i&&r&&(i=!0,N(e,r))}),e)}(e,t,n):A(e,t)}function T(e,t){if(e===t)N(e,new TypeError("You cannot resolve a promise with itself"));else if(a=i(r=t),null===r||"object"!==a&&"function"!==a)A(e,t);else{var n;try{n=t.then}catch(t){return void N(e,t)}x(e,t,n)}var r,a}function D(e){e._onerror&&e._onerror(e._result),M(e)}function A(e,t){e._state===I&&(e._result=t,e._state=1,0!==e._subscribers.length&&u(M,e))}function N(e,t){e._state===I&&(e._state=2,e._result=t,u(D,e))}function L(e,t,n,i){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+1]=n,r[a+2]=i,0===a&&e._state&&u(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i,r,a=e._result,o=0;o<t.length;o+=3)i=t[o],r=t[o+n],i?W(n,i,r,a):r(a);e._subscribers.length=0}}function W(e,t,n,i){var a,o,s=r(n),c=!0;if(s){try{a=n(i)}catch(e){c=!1,o=e}if(t===a)return void N(t,new TypeError("A promises callback cannot return that same promise."))}else a=i;t._state!==I||(s&&c?T(t,a):!1===c?N(t,o):1===e?A(t,a):2===e&&N(t,a))}var R=0;function P(e){e[O]=R++,e._state=void 0,e._result=void 0,e._subscribers=[]}var F=function(){function t(n,i){e(this,t),this._instanceConstructor=n,this.promise=new n(_),this.promise[O]||P(this.promise),s(i)?(this.length=i.length,this._remaining=i.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(i),0===this._remaining&&A(this.promise,this._result))):N(this.promise,new Error("Array Methods must be provided an Array"))}return n(t,[{key:"_enumerate",value:function(e){for(var t=0;this._state===I&&t<e.length;t++)this._eachEntry(e[t],t)}},{key:"_eachEntry",value:function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===E){var r,a,o=!1;try{r=e.then}catch(e){o=!0,a=e}if(r===k&&e._state!==I)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===j){var s=new n(_);o?N(s,a):x(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)}},{key:"_settledAt",value:function(e,t,n){var i=this.promise;i._state===I&&(this._remaining--,2===e?N(i,n):this._result[t]=n),0===this._remaining&&A(i,this._result)}},{key:"_willSettleAt",value:function(e,t){var n=this;L(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))}}]),t}();var j=function(){function t(n){e(this,t),this[O]=R++,this._result=this._state=void 0,this._subscribers=[],_!==n&&("function"!=typeof n&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){T(e,t)}),(function(t){N(e,t)}))}catch(t){N(e,t)}}(this,n):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return n(t,[{key:"catch",value:function(e){return this.then(null,e)}},{key:"finally",value:function(e){var t=this,n=t.constructor;return r(e)?t.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):t.then(e,e)}}]),t}();function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function V(e,t){if(e){if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?wn(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(e,t)||V(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}j.prototype.then=k,j.all=function(e){return new F(this,e).promise},j.race=function(e){var t=this;return s(e)?new t((function(n,i){for(var r=e.length,a=0;a<r;a++)t.resolve(e[a]).then(n,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},j.resolve=E,j.reject=function(e){var t=new this(_);return N(t,e),t},j._setScheduler=function(e){o=e},j._setAsap=function(e){u=e},j._asap=u;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function U(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $(e){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},$(e)}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function G(e){return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return wn(e)}(e)||V(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$(e)););return e}function K(){return K="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=z(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},K.apply(this,arguments)}function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J(e,t)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Q(e)}function Z(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return wn(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function te(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];for(var a=0;a<e.length;a+=1)t.apply(void 0,[e[a]].concat(i))}function ne(e,t){if(e.length>0){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];t.apply(void 0,[e[0]].concat(i))}}function ie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e.length>>>0;n<0&&(n+=i),n<0&&(n=0);for(var r=n;r<i;r+=1)if(e[r]==t)return r;return-1}function re(e,t){for(var n=t.length>>>0,i=0;i<n;i+=1)ie(e,t[i])<0&&e.push(t[i])}!function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var r=t&&t.prototype instanceof m?t:m,a=Object.create(r.prototype),o=new T(i||[]);return a._invoke=function(e,t,n){var i=g;return function(r,a){if(i===h)throw new Error("Generator is already running");if(i===v){if("throw"===r)throw a;return A()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===g)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=h;var c=d(e,t,n);if("normal"===c.type){if(i=n.done?v:f,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=v,n.method="throw",n.arg=c.arg)}}}(e,n,o),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var g="suspendedStart",f="suspendedYield",h="executing",v="completed",p={};function m(){}function y(){}function w(){}var b={};u(b,o,(function(){return this}));var S=Object.getPrototypeOf,C=S&&S(S(D([])));C&&C!==n&&r.call(C,o)&&(b=C);var k=w.prototype=m.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function n(a,o,s,c){var u=d(e[a],e,o);if("throw"!==u.type){var l=u.arg,g=l.value;return g&&"object"===i(g)&&r.call(g,"__await")?t.resolve(g.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(g).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var a;this._invoke=function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}}function _(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=d(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;var a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function D(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:A}}function A(){return{value:t,done:!0}}return y.prototype=w,u(k,"constructor",w),u(w,"constructor",y),y.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},E(O.prototype),u(O.prototype,s,(function(){return this})),e.AsyncIterator=O,e.async=function(t,n,i,r,a){void 0===a&&(a=j);var o=new O(l(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(k),u(k,c,"Generator"),u(k,o,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=D,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;x(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:D(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":i(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}({exports:{}}),j.resolve();var ae=Object.prototype.toString;function oe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function se(e){var t=i(e);return null!==e&&("object"===t||"function"===t)}function ce(e){return null==e}var ue=function(){try{return Symbol.iterator?Symbol.iterator:"Symbol(Symbol.iterator)"}catch(e){return"Symbol(Symbol.iterator)"}}();function le(e){return"function"==typeof(t=e[ue])||"[object Function]"===ae.call(t);var t}function de(e,t){return e===t}function ge(e){return JSON.stringify(e)}function fe(e){if(ce(e))return"";switch(i(e)){case"string":return e;case"object":return ge(e);case"symbol":return e.description;default:return String(e)}}function he(e){var t=0;if("string"==typeof e&&(t=Number(e),e=isNaN(t)?Date.parse(e):t),"number"==typeof e&&e<9999999999&&(e*=1e3),"object"===i(e)){if(e instanceof Date)return t=e.getTime(),e.getTime();throw Error("unsupported type:"+e)}return e}function ve(e,t){return function(e,t){return e=he(e),t?e-he(t):Date.now()-e}(e,t)/1e3}function pe(){return{events:{},dispatch:function(e){var t=this.events[e];if(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var a,o=Z(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.apply(void 0,i)}}catch(e){o.e(e)}finally{o.f()}}},on:function(e,t){var n=this;return(this.events[e]=this.events[e]||[]).push(t),function(){var i=n.events[e];i&&(n.events[e]=function(e,t){for(var n=[],i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];for(var o=0;o<e.length;o+=1)t.apply(void 0,[e[o]].concat(r))||n.push(e[o]);return n}(i,de,t))}}}}var me=function(){function t(){e(this,t),this.count=0,this.events=pe(),ye(this,console)}return n(t,[{key:"dispatch",value:function(e,t){var n;this.count++;for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];(n=this.events).dispatch.apply(n,[e,t].concat(r))}},{key:"log",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.dispatch.apply(this,["log",e].concat(n))}},{key:"debug",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.dispatch.apply(this,["debug",e].concat(n))}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.dispatch.apply(this,["error",e].concat(n))}},{key:"info",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.dispatch.apply(this,["info",e].concat(n))}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.dispatch.apply(this,["warn",e].concat(n))}},{key:"table",value:function(e,t){this.events.dispatch("table",e,t)}},{key:"onLog",value:function(e){return this.events.on("log",e)}},{key:"onDebug",value:function(e){return this.events.on("debug",e)}},{key:"onError",value:function(e){return this.events.on("error",e)}},{key:"onInfo",value:function(e){return this.events.on("info",e)}},{key:"onWarn",value:function(e){return this.events.on("warn",e)}},{key:"onTable",value:function(e){return this.events.on("table",e)}}]),t}();function ye(e,t){!function(e){e.unsub&&(e.unsub(),delete e.unsub)}(e),e.unsub=function(e,t){var n=[e.onLog((function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.log&&t.log.apply(t,[e].concat(i))})),e.onDebug((function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.debug&&t.debug.apply(t,[e].concat(i))})),e.onError((function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.error&&t.error.apply(t,[e].concat(i))})),e.onInfo((function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.info&&t.info.apply(t,[e].concat(i))})),e.onWarn((function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.warn&&t.warn.apply(t,[e].concat(i))})),e.onTable((function(e,n){t.table&&t.table(e,n)}))];return function(){var e,t=Z(n);try{for(t.s();!(e=t.n()).done;)(0,e.value)()}catch(e){t.e(e)}finally{t.f()}}}(e,t)}var we=new me;function be(e,t){return e.getAttribute(t)}function Se(e,t,n){e.setAttribute(t,String(n))}function Ce(e,t){e.removeAttribute(t)}function ke(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.indexOf(t,n)===n}function Ee(e,t,n){var i=e.toString();(void 0===n||n>i.length)&&(n=i.length),n-=t.length;var r=i.indexOf(t,n);return-1!==r&&r===n}function Oe(e){return fe(e).trim()}var _e=function(){function t(n){e(this,t),this.el=n}return n(t,[{key:"tokens",value:function(){return void 0===this.list&&(this.list=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";return e?e.split(t).filter(Boolean):[]}(be(this.el,"class"))),this.list}},{key:"commit",value:function(){Se(this.el,"class",this.tokens().join(" "))}},{key:"contains",value:function(e){return this.tokens().indexOf(e)>=0}},{key:"add",value:function(){for(var e=this.tokens(),t=!1,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(var a=0,o=i;a<o.length;a++){var s=o[a];e.indexOf(s)<0&&(e.push(s),t=!0)}t&&this.commit()}},{key:"remove",value:function(){for(var e=this.tokens(),t=!1,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(var a=0,o=i;a<o.length;a++)for(var s=o[a],c=e.indexOf(s);c>=0;)e.splice(c,1),t=!0,c=e.indexOf(s,c);t&&this.commit()}}]),t}();function Ie(e){return void 0===e.classList?new _e(e):e.classList}function xe(e,t){return Ie(e).contains(t)}function Te(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=Ie(e)).add.apply(t,i)}function De(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=Ie(e)).remove.apply(t,i)}function Ae(e,t){for(var n=e.length,i=0;i<n;i++)if(Ne(e[i],t))return!0;return!1}function Ne(e,t){t=t.toUpperCase();var n,i=Z(e.classList);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.length===t.length&&r.toUpperCase()===t)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}function Le(e){return void 0!==i(e.parentNode)}var Me=Node.ELEMENT_NODE;function We(e){return document.getElementById(e)}var Re={container:null,queries:{}};function Pe(e){Re.container=e,Re.queries={}}function Fe(){Re.container=null}function je(e,t){var n,i=Re.container===e;return i&&(n=Re.queries[t]),n||(n=function(e,t){try{return e.querySelectorAll(t)}catch(e){return we.error("Encountered error trying to select dom element with selector: '".concat(t,"' : ").concat(e.message)),[]}}(e,t)),i&&(Re.queries[t]=n),n}function Be(e,t){var n=e.length;if(t>=0){if(0===n)return e;if(0===t&&1===n)return e;if(n>t)return[e[t]]}return[]}function Ve(e){return function(e,t){for(var n=[],i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];for(var o=0;o<e.length;o+=1)t.apply(void 0,[e[o]].concat(r))&&n.push(e[o]);return n}(e,xt)}function He(e,t){var n=function(e){var t=e.match(/:(eq|first|last|visible)(\((\d+)\))?$/i);return t?[e.slice(0,t.index),t[1],t[3]]:[e]}(t);n.length>1&&(e.clean=!1),e.selectors.push(n)}function qe(e){var t={clean:!0,selector:e,selectors:[]};if(e.indexOf(",")>=0){var n,i=Z(e.split(","));try{for(i.s();!(n=i.n()).done;){He(t,n.value)}}catch(e){i.e(e)}finally{i.f()}}else He(t,e);return t}function Ue(e,t){return function(e,t){var n=t[1];if(!n)return e;switch(n){case"eq":return Be(e,Number(t[2]));case"first":return Be(e,0);case"last":return function(e){var t=e.length;return t>1?[e[t-1]]:e}(e);case"visible":return Ve(e)}}(je(e,t[0]),t)}function $e(e,t){var n=t.selectors.length;if(n>1){var i,r=[],a=Z(t.selectors);try{for(a.s();!(i=a.n()).done;){re(r,Ue(e,i.value))}}catch(e){a.e(e)}finally{a.f()}return r}return 1===n?Ue(e,t.selectors[0]):[]}function Je(e){return function(e,t){return(t=t.trim())?$e(e,qe(t)):[]}(document,e)}function Ge(e){Le(e)&&(e.remove?e.remove():e.parentNode.removeChild(e))}function ze(e,t){e.innerHTML=t}function Ke(e,t,n){e.insertAdjacentHTML(t,n)}function Xe(e,t){Ke(e,"afterbegin",t)}function Qe(e,t){Ke(e,"beforeend",t)}function Ye(e,t){!function(e,t){Ke(e,"afterend",t)}(e,t),Ge(e)}function Ze(e){te(e.childNodes,Ge)}function et(e,t){e.appendChild(t)}function tt(e,t){e.childNodes.length>0?e.insertBefore(t,e.childNodes[0]):et(e,t)}function nt(e){e.focus()}function it(e){e.blur()}function rt(e,t){return e===t||!!t.parentNode&&rt(e,t.parentNode)}function at(e){return rt(e.ownerDocument,e)}function ot(e,t){return e.tagName===t}function st(e,t){return e.attributes&&null!==be(e,t)}function ct(e,t){try{return(e.matches||e.msMatchesSelector).call(e,t)}catch(e){return we.error("ERROR: ".concat(e.message)),!1}}function ut(e,t){return t.clean?ct(e,t.selector):ie($e(document,t),e)>=0}function lt(e){return void 0!==e.parentElement?e.parentElement:Le(e)?e.parentNode:null}var dt={value:"",text:""};function gt(e){if(e){if(e instanceof HTMLSelectElement){var t=e.selectedIndex;return t>=0?gt(e.options[t]):dt}if(function(e){return e instanceof HTMLOptionElement}(e))return{value:e.value,text:e.text};if(function(e){return e instanceof HTMLTextAreaElement}(e)){var n=e.value;return{value:n,text:n}}if(function(e){return e instanceof HTMLInputElement}(e)){var i=e.value;return{value:i,text:i}}var r=e.textContent||"";return{value:r,text:r}}return dt}function ft(e){return e.value||e.text}function ht(){return window.innerHeight}function vt(){return window.innerWidth}function pt(){return ht()>window.visualViewport.height}function mt(e){return isFinite(Number(e))?"".concat(e,"px"):String(e)}var yt={top:mt,bottom:mt,left:mt,right:mt,height:mt,width:mt};function wt(e){var t=(e=String(e)).indexOf("px");return t>0&&(e=Number(e.slice(0,t))),e}var bt={top:wt,bottom:wt,left:wt,right:wt,height:wt,width:wt};function St(e,t){var n=yt[e];return n?n(t):t}function Ct(e,t){var n=bt[e];return n?n(t):t}function kt(e){return e.getBoundingClientRect()}function Et(e){var t=kt(e);return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}function Ot(e){return getComputedStyle(e,null)}function _t(e){var t=wt(Ot(e).height);return""!==t&&"auto"!==t||(t=kt(e).height),Number(t)}function It(e){var t=wt(Ot(e).width);return""!==t&&"auto"!==t||(t=kt(e).width),Number(t)}function xt(e){var t=Ot(e);if("none"==t.display)return!1;if("hidden"==t.visibility)return!1;var n=lt(e);return!n||xt(n)}function Tt(e,t,n,i){e.addEventListener(t,n,i)}function Dt(e,t,n){Tt(e,t,n,!1)}var At=void 0;function Nt(e,t,n){if(void 0===At)try{var i=function(){};Tt(window,"click",i,{get passive(){return At=!0,!1}}),Lt(window,"click",i)}catch(e){At=!1}Tt(e,t,n,!!At&&{passive:!0})}function Lt(e,t,n){e.removeEventListener(t,n)}function Mt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(t){if(t&&t.target){var i=t.target,r=t.currentTarget;try{Pe(document);for(var a=i;null!==a&&!a.isEqualNode(r);){if(e.apply(void 0,[a].concat(n)))return[!0,a];a=lt(a)}}finally{Fe()}}return[!1,null]}}var Wt=[document.body];function Rt(e,t,n,i){var r=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(e){var t=n(e),o=t[0],s=t[1];o&&(null===s&&(s=r),!1===i.bind(s)(e)&&(e.stopPropagation(),a||e.preventDefault()))};return te(e,a?Nt:Dt,t,o),o}function Pt(e,t,n){te(e,Lt,t,n)}function Ft(e){return Mt(xe,e)}function jt(e){return Mt(ot,e.toUpperCase())}function Bt(e){var t=qe(e);return t.clean?Mt(ct,t.selector):Mt(ut,t)}function Vt(e){for(var t=[],n=!1,i=0;i!==e.length;i++){var r=e[i];"-"===r?n=!0:n?(t.push(r.toUpperCase()),n=!1):t.push(r)}return t.join("")}function Ht(e){return encodeURIComponent(e)}var qt=Date.now()%1e9;var Ut=!1||"undefined"==typeof WeakMap?new(function(){function t(){e(this,t),this.n="__stash_"+(1e9*Math.random()>>>0)+qt+++"__"}return n(t,[{key:"set",value:function(e,t){var n=e[this.n];return n&&n[0]===e?n[1]=t:Object.defineProperty(e,this.n,{value:[e,t],writable:!0}),this}},{key:"get",value:function(e){var t=e[this.n];return t&&t[0]===e?t[1]:void 0}},{key:"delete",value:function(e){var t=e[this.n];if(!t)return!1;var n=t[0]===e;return t[0]=t[1]=void 0,n}},{key:"has",value:function(e){var t=e[this.n];return!!t&&t[0]===e}}]),t}()):new WeakMap;function $t(e){var t;return Ut.has(e)?t=Ut.get(e):(t={},Ut.set(e,t)),t}function Jt(e,t,n){var i=$t(e),r=i[t];return i[t]=n,r}function Gt(e,t){return $t(e)[t]}function zt(e,t){delete $t(e)[t]}function Kt(e,t){var n=Gt(e,t);return void 0===n&&(n=be(e,"data-"+function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}(t))),n}function Xt(e){for(var t=bn({},$t(e)),n=e.attributes,i=n.length,r=0;r<i;r++){var a=n.item(r);0===a.name.indexOf("data-")&&(t[Vt(a.name.slice(5))]=a.value)}return t}function Qt(e,t,n){e.style[t]=St(t,n)}function Yt(e,t){for(var n in t)Qt(e,n,t[n])}function Zt(e,t){e.style&&e.style.removeProperty(t)}function en(e,t){var n=(e=t||e).style.display;return"none"===n||""===n&&at(e)&&"none"===Ot(e).display}var tn={};function nn(e){var t=e.ownerDocument,n=e.nodeName,i=tn[n];if(i)return i;var r=t.body.appendChild(t.createElement(n));return i=Ot(r).display,Ge(r),"none"===i&&(i="block"),tn[n]=i,i}function rn(e,t){for(var n,i,r=0,a=[],o=e.length;r<o;r++)(i=e[r]).style&&(n=i.style.display,t?("none"===n&&(a[r]=null,a[r]||(i.style.display="")),""===i.style.display&&en(i)&&(a[r]=nn(i))):"none"!==n&&(a[r]="none"));for(r=0;r<o;r++)null!=a[r]&&(e[r].style.display=a[r]);return e}var an=null;function on(e){null===an&&(an=document.createElement("DIV")),Xe(an,e);var t=wn(an.childNodes);return te(t,Ge),t}var sn=function(){function t(n){e(this,t),this.length=0,null==n||null==n||("string"==typeof n?n.length>0&&("<"===n.charAt(0)?this.pushAll(on(n)):this.pushAll(je(document,n))):t.isArrayLike(n)?this.pushAll(n):this.push(n))}return n(t,[{key:"push",value:function(e){return e&&e.nodeType===Me&&(this[this.length]=e,this.length+=1),this}},{key:"pushAll",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t]);return this}},{key:"each",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return te.apply(void 0,[this,e].concat(n)),this}},{key:"hasClass",value:function(e){return this.length>0&&xe(this[0],e)}},{key:"attr",value:function(e,t){var n=arguments.length;if(2===n)te(this,Se,e,t);else if(1===n){var i=this.length>0?be(this[0],e):null;return null!==i?i:void 0}return this}},{key:"removeAttr",value:function(e){return te(this,Ce,e),this}},{key:"data",value:function(e,t){var n=arguments.length;if(2===n)te(this,Jt,e,t);else{if(1===n)return 0===this.length?void 0:Kt(this[0],e);if(0===n)return 0===this.length?void 0:Xt(this[0])}return this}},{key:"addClass",value:function(e){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];te.apply(void 0,[e,Te].concat(n))}(this,e),this}},{key:"removeClass",value:function(e){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];te.apply(void 0,[e,De].concat(n))}(this,e),this}},{key:"on",value:function(e,t,n){var i=this,r=Array.isArray(e)?e:[e],a=arguments.length;return 2===a&&"function"==typeof t&&r.forEach((function(e){return te(i,Dt,e,t)})),3===a&&"string"==typeof t&&r.forEach((function(e){Rt(i,e,Bt(t),n,!1)})),this}},{key:"onPassive",value:function(e,t,n){var i=this,r=Array.isArray(e)?e:[e],a=arguments.length;return 2===a&&"function"==typeof t&&r.forEach((function(e){return te(i,Nt,e,t)})),3===a&&"string"==typeof e&&"string"==typeof t&&"function"==typeof n&&r.forEach((function(e){return Rt(i,e,Bt(t),n,!0)})),this}},{key:"css",value:function(e,t){var n=arguments.length;if(n>0){var r=i(e);if(1===n){if("string"===r)return this.length>0?Ot(this[0])[Vt(e)]:null;if(Array.isArray(e)){for(var a={},o=Ot(this[0]),s=0;s<e.length;s++){var c=e[s];a[c]=o[c]}return a}"object"===r&&te(this,Yt,e)}if(2===n&&"string"==typeof e){var u=Vt(e);te(this,Qt,u,t)}}return this}},{key:"append",value:function(e){return"string"==typeof e?te(this,Qe,e):ne(this,et,e),this}},{key:"replaceWith",value:function(e){return te(this,Ye,e),this}},{key:"prepend",value:function(e){return"string"==typeof e?te(this,Xe,e):ne(this,tt,e),this}},{key:"empty",value:function(){return te(this,Ze),this}},{key:"appendTo",value:function(e){var n=null;return e instanceof t?e.length>0&&(n=e[0]):n=e,n&&te(this,(function(e){et(n,e)})),this}},{key:"html",value:function(e){return te(this,ze,e),this}},{key:"val",value:function(){return this.length>0?this[0].value||null:void 0}},{key:"text",value:function(e){var t=arguments.length;if(0===t){var n=[];return te(this,(function(e){e.textContent&&n.push(e.textContent)})),n.join("")}return 1===t&&this.length>0&&(this[0].textContent=e),this}},{key:"prependHtml",value:function(e){return te(this,Xe,e),this}},{key:"remove",value:function(){return te(this,Ge),this}},{key:"find",value:function(e){var n=new t;return te(this,(function(t){n.pushAll(je(t,e))})),n}},{key:"closest",value:function(e){var n=new t;return te(this,(function(t){n.push(function(e,t){if(Element.prototype.closest)return e.closest(t);var n=e;do{if(ct(n,t))return n;n=lt(n)}while(null!==n&&n.nodeType===Me);return null}(t,e))})),n}},{key:"first",value:function(){var e=new t;return this.length>0&&e.push(this[0]),e}},{key:"parent",value:function(){var e=new t;return this.length>0&&e.push(this[0].parentNode),e}},{key:"children",value:function(e){var n=new t;return te(this,(function(e){var t=e.childNodes;n.pushAll(t)})),e&&(n=n.filter(e)),n}},{key:"index",value:function(){return this.length>0?function(e){var t=e.parentNode.childNodes,n=0;for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1}(this[0]):0}},{key:"filter",value:function(e){var n=new t;return te(this,(function(t){ct(t,e)&&n.push(t)})),n}},{key:"not",value:function(e){var n=new t;if("string"==typeof e)te(this,(function(t){ct(t,e)||n.push(t)}));else if(e instanceof t){var i=e.length;te(this,(function(t){for(var r=!1,a=0;a<i&&!r;a++)r=t===e[a];r||n.push(t)}))}return n}},{key:"show",value:function(){return rn(this,!0),this}},{key:"hide",value:function(){return rn(this,!1),this}},{key:"focus",value:function(){return ne(this,nt),this}},{key:"blur",value:function(){return ne(this,it),this}},{key:"height",value:function(e){return 0===arguments.length?this.length>0?_t(this[0]):0:(te(this,Yt,{height:"".concat(e,"px")}),this)}},{key:"width",value:function(e){return 0===arguments.length?this.length>0?It(this[0]):0:(te(this,Yt,{width:"".concat(e,"px")}),this)}},{key:"sort",value:function(e){var t=wn(this);t.sort(e);for(var n=0;n<this.length;n++)this[n]=t[n];return this}},{key:"detach",value:function(){return te(this,Ge),this}}],[{key:"isArrayLike",value:function(e){return void 0!==e.length}}]),t}();function cn(e){return new sn(e)}function un(e){return function(){e()}}var ln=new RegExp("[^0-9,\\.e]","g");function dn(e){var t=(e=e.replace(ln,"")).split(/,|\./g),n=e.lastIndexOf("."),i=e.lastIndexOf(","),r=n>=0&&i>=0;if(1===t.length)return parseFloat(t[0]);var a=t.slice(0,-1).join(""),o=t.slice(-1).join("");return r||n>i?parseFloat(a+"."+o):i>n&&3===o.length?"0"===a?parseFloat(a+"."+o):parseFloat(a+o):parseFloat(a+"."+o)}function gn(e){var t=Oe(e).toLowerCase();if(Ee(t,"%"))return dn(t.slice(0,-1))/100;var n=t.lastIndexOf("e");if(n>0){var i=t.slice(n+1);return Number("".concat(dn(t.slice(0,n)),"e").concat(i))}return dn(t)}function fn(e,t){return fe(e.value).indexOf(t)>=0||fe(e.text).indexOf(t)>=0}var hn={none:function(e,t){return!0},startsWith:function(e,t){return ke(Oe(e.value),t)||ke(Oe(e.text),t)},endsWith:function(e,t){return Ee(Oe(e.value),t)||Ee(Oe(e.text),t)},contains:fn,notContains:function(e,t){return!fn(e,t)},matches:function(e,t){try{var n=new RegExp(t);return n.test(fe(e.value))||n.test(fe(e.text))}catch(n){return Oe(e.value)===t||Oe(e.text)===t}},lessThan:function(e,t){return gn(ft(e))<t},greaterThan:function(e,t){return gn(ft(e))>t},equalTo:function(e,t){return t==gn(ft(e))},notEqualTo:function(e,t){return t!=gn(ft(e))}};function vn(e,t,n,i){return function(r){var a=r.target;a instanceof HTMLElement&&function(e,t,n){if("none"==t)return!0;for(var i=hn[t],r=gt(e),a=n.length,o=0;o<a;o++)if(i(r,n[o]))return!0;return!1}(a,n,i)&&t.call(r.target,e)}}var pn="click",mn="touchend";var yn="change";function wn(e,t,n){if(ce(e))throw new TypeError("Cannot be not null or undefined");var i=Object(e),r=i.length,a=[];if(le(e)){var o,s=Z(e);try{for(s.s();!(o=s.n()).done;){var c=o.value;t?a.push(t.call(n,c)):a.push(c)}}catch(e){s.e(e)}finally{s.f()}}else for(var u=0;u<r;u++){var l=i[u];t?a.push(t.call(n,l)):a.push(l)}return a}function bn(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var a=0,o=i;a<o.length;a++){var s=o[a];if(null!=s)for(var c in s)oe(s,c)&&(t[c]=s[c])}return t}function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Cn(e,t){Object.defineProperty(this,"name",{enumerable:!1,writable:!1,value:"AJAXError"}),Object.defineProperty(this,"message",{enumerable:!1,writable:!0,value:e.statusText}),Object.defineProperty(this,"elapsed",{enumerable:!1,writable:!0,value:t}),Object.defineProperty(this,"request",{enumerable:!1,writable:!0,value:e}),oe(Error,"captureStackTrace")?Error.captureStackTrace(this,Cn):Object.defineProperty(this,"stack",{enumerable:!1,writable:!1,value:new Error(e.statusText).stack})}function kn(e,t){return t?bn({},e,t):e}"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(Cn.prototype,Error.prototype):Cn.prototype=Object.create(Error.prototype,{constructor:{value:Cn}});var En={retainFor:1e4,timeout:2e4};function On(e,t,n){var i=e.cache[t];if(!i){var r=function(){!function(e,t,n){e.cache[t]===n&&(delete e.cache[t],e.retainTimeouts[t]&&(clearTimeout(e.retainTimeouts[t]),delete e.retainTimeouts[t]))}(e,t,i)},a=new XMLHttpRequest;if(i=new j((function(e,i){var r=Date.now();a.open("GET",t,!0),n.crossDomain&&(a.withCredentials=!0),a.setRequestHeader("Accept","application/json");var o=!1;n.timeout&&n.timeout>=0&&(a.addEventListener("loadstart",(function(){o=setTimeout((function(){o=!1,a.abort(),i(new Error("Operation timed out"))}),n.timeout)})),a.addEventListener("loadend",(function(){o&&clearTimeout(o)}))),a.addEventListener("load",(function(){a.status>=200&&a.status<400?e(a):i(new Cn(a,Date.now()-r))})),a.addEventListener("error",(function(){i(new Cn(a,Date.now()-r))})),a.send()})),e.cache[t]=i,n.retainFor>0){var o=setTimeout(r,n.retainFor);e.retainTimeouts[t]=o}i.catch((function(){return r(),null}))}return i}var _n=function(){function t(){var n=this;e(this,t),this.cache={},this.retainTimeouts={},this.get=function(e,t){return n.getXMLHttpRequest(e,kn(n.defaults,t)).then((function(e){return"string"==typeof e.response?JSON.parse(e.response):e.response}))},this.set=function(e,t){n.cache[e]=j.resolve(t)},this.getXMLHttpRequest=function(e,t){return On(n,e,kn(n.defaults,t))},this.defaults=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sn(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},En)}return n(t,[{key:"retainFor",value:function(e){var t=Number(e);return t>=0&&(this.defaults.retainFor=t),this.defaults.retainFor}},{key:"timeout",value:function(e){var t=Number(e);return t>=0&&(this.defaults.timeout=t),this.defaults.timeout}},{key:"urls",value:function(){return Object.keys(this.cache)}},{key:"remove",value:function(e){delete this.cache[e],this.retainTimeouts[e]&&(clearTimeout(this.retainTimeouts[e]),delete this.retainTimeouts[e])}},{key:"clear",value:function(){for(var e in this.retainTimeouts)clearTimeout(this.retainTimeouts[e]);this.cache={},this.retainTimeouts={}}}]),t}(),In="function"==typeof CustomEvent?function(e,t){return new CustomEvent(e,{detail:t})}:function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n};function xn(e,t,n){var i=In("GoMoxie:"+e,t);return i.version=n,i}var Tn={kb:1,chat:2,email:3,kbot:2,link:4,"cxone-expert":1,"dfo-live":2,customChannel:5},Dn={_blank:1,_self:2},An="Desktop",Nn="Tablet",Ln="Mobile",Mn=An;function Wn(e){var t=e.userAgent;return t.match(/GoogleTV|SmartTV|Internet.TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE-HTML/i)||t.match(/Xbox|PLAYSTATION.3|Wii/i)?Mn:t.match(/Windows.(NT|XP|ME|9)/)&&!t.match(/Phone/i)||t.match(/Win(9|.9|NT)/i)?An:t.match(/iPad/i)||t.match(/tablet/i)&&!t.match(/RX-34/i)||t.match(/FOLIO/i)||t.match(/Linux/i)&&t.match(/Android/i)&&!t.match(/Fennec|mobi|HTC.Magic|HTCX06HT|Nexus.One|SC-02B|fone.945/i)||t.match(/Kindle/i)||t.match(/Mac.OS/i)&&t.match(/Silk/i)||t.match(/GT-P10|SC-01C|SHW-M180S|SGH-T849|SCH-I800|SHW-M180L|SPH-P100|SGH-I987|zt180|HTC(.Flyer|_Flyer)|Sprint.ATP51|ViewPad7|pandigital(sprnova|nova)|Ideos.S7|Dell.Streak.7|Advent.Vega|A101IT|A70BHT|MID7015|Next2|nook/i)||t.match(/MB511/i)&&t.match(/RUTEM/i)?Nn:t.match(/BOLT|Fennec|Iris|Maemo|Minimo|Mobi|mowser|NetFront|Novarra|Prism|RX-34|Skyfire|Tear|XV6875|XV6975|Google.Wireless.Transcoder/i)||t.match(/Opera/i)&&t.match(/Windows.NT.5/i)&&t.match(/HTC|Xda|Mini|Vario|SAMSUNG-GT-i8000|SAMSUNG-SGH-i9/i)?Ln:t.match(/Macintosh|PowerPC/i)&&!t.match(/Silk/i)||t.match(/Linux/i)&&t.match(/X11/i)||t.match(/Solaris|SunOS|BSD/i)||t.match(/Bot|Crawler|Spider|Yahoo|ia_archiver|Covario-IDS|findlinks|DataparkSearch|larbin|Mediapartners-Google|NG-Search|Snappy|Teoma|Jeeves|TinEye/i)&&!t.match(/Mobile/i)||t.match(/CrOS/i)?An:Ln}var Rn="uuid",Pn="moxie_cc",Fn="Rules",jn=7,Bn=8,Vn="profileJSON",Hn="engagementWidgets",qn="MoxieCache_visitorProfile_lastUpdated",Un="moxie_channels_custom_data",$n="moxie_channels_form_data",Jn="rules_version",Gn="widgets_version",zn="engagement_id",Kn="moxie_concierge_event_serial_number",Xn=4294967295,Qn="SharedStorage",Yn="window.name",Zn="externalAPI",ei="externalLink",ti={chat:1,kb:2,email:3,kbot:4},ni="drag_position",ii="concierge-widget-area",ri="dfo-live",ai="online",oi=0;function si(e){switch(e){case 1:return"kb";case 2:return"chat";case 3:return"email";case 4:return"link";case 5:return"kbot";case 6:return"cxone-expert";case 7:return"dfo-live";case 8:return"customChannel";default:we.error("Unknown widget value:",e)}}function ci(e,t,n){return 4===e?6:1===e?1002===t||1001===t?isNaN(gn(n))?16:oi:2===t||13===t||9===t?oi:16:e}function ui(e){return-1!==[oi,jn,Bn].indexOf(e)}function li(e,t,n){return ui(t)?function(e,t,n){if("number"==typeof e&&!isNaN(e)&&"number"==typeof n&&!isNaN(n))switch(t){case oi:return e===n;case jn:return e<n;case Bn:return e<=n;default:return}}(gn(e),t,gn(n)):function(e,t,n){if(!e||!n)return!1;switch(e=e.toLowerCase(),n=n.toLowerCase(),t){case 2:return ke(e,n);case 6:return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return-1!==e.indexOf(t,n)}(e,n);case 16:return e===n;case 3:return Ee(e,n);case 5:return null!==e.match(n);default:return!1}}(e,t,n)}function di(e,t,n,i){void 0===i&&(i=!0);var r=0;switch(t){case 0:r=0;break;case 1:r=e.journey.length-1;break;case 2:n||(n=2),(e.journey.length>n||!1===i)&&(r=e.journey.length-n)}return e.journey[r]}function gi(e,t,n,i){void 0===i&&(i=!0);var r=0;switch(t){case 0:r=0;break;case 1:r=e.session.visits.length-1;break;case 2:n||(n=2),(e.session.visits.length>n||!1===i)&&(r=e.session.visits.length-n)}return e.session.visits[r]}function fi(e){return void 0===e?e:JSON.parse(JSON.stringify(e))}function hi(e,t,n){e&&e[t]!==n&&(e[t]=n,e.dirty=!0)}var vi=String.prototype.valueOf,pi=Object.prototype.toString,mi="function"==typeof Symbol&&"symbol"===i(Symbol.toStringTag);function yi(e){return"string"==typeof e||"object"===i(e)&&(mi?function(e){try{return vi.call(e),!0}catch(e){return!1}}(e):"[object String]"===pi.call(e))}function wi(e){var t=new Set;if(null!=e)for(var n=0;n!==e.length;n++)t.add(e[n]);return t}var bi={name:"n",value:"V",quantity:"q",skuOrId:"s",uom:"u"};function Si(e){var t=e.toLowerCase();return ke(t,"http:")||ke(t,"https:")}function Ci(e){return function(){try{return e.apply(this,arguments)}catch(e){we.error(e)}}}function ki(e,t){var n,i,r,a,o;if(e&&e.rulesEngine&&e.rulesEngine.siteRules&&e.rulesEngine.siteRules.rules)e:for(i=0;i<e.rulesEngine.siteRules.rules.length;i++)if((r=e.rulesEngine.siteRules.rules[i]).id===t){if(r.action&&r.action.success)for(a=0;a<r.action.success.length;a++)if((o=r.action.success[a]).parameters&&o.parameters.rule&&o.parameters.rule.id===t){n=a;break e}break}return n}function Ei(e){return"proactive"==e?1:"reactive"==e?2:3}function Oi(e,t){return e.widgetManager.engagementWidgets.widgets[t]}function _i(e,t,n,i){if(i)e["#"]=i;else if("chat"===n||"kbot"===n){var r=Oi(t,n);r&&(r.widgetParameters&&r.widgetParameters.traceId?e["#"]=r.widgetParameters.traceId:r.parameters&&r.parameters.traceId&&(e["#"]=r.parameters.traceId))}return e}function Ii(e,t){return Tn[t]||Tn.customChannel}function xi(e){var t=null,n=e.contextMonitor.getLastDevice();if(n)switch(n){case An:t=1;break;case Nn:t=2;break;case Ln:t=3}var i={};i.d=Date.now();var r=function(e){return e.cacheManager.getVisitorProfileId()}(e);return null!==r&&(i.u=r),null!==t&&(i.w=t),i.W=1,i.p=e.url,i.q=e.pageTitle,i.v="v1.35.3",i.$="1.1",e.brandId&&(i.N=e.brandId),i["@"]=e.cacheManager.makeEventSerialNumber(),i}function Ti(e,t,n,i){var r=xi(e);return r.t=t,r.z=Ii(0,n),r.r=i.id,r.i=1,r.o=e.currentOfferCreatedAt.toString(),r=_i(r,e,n)}function Di(e,t){e.logDisabled||(we.log("Events.sendToEventService:",t),e.eventService.notifyEventService(t))}function Ai(e,t){e.logDisabled||(we.log("Events.sendToEventServiceImmediately:",t),e.eventService.notifyEventServiceImmediately(t))}function Ni(e,t,n){var i=function(e,t){var n=Oi(e,t);return n&&n.widgetParameters&&n.widgetParameters.rule?n.widgetParameters.rule.id:n.parameters&&n.parameters.rule?n.parameters.rule.id:null}(e,n);if(i){t.r=i;var r=ki(e,i);void 0!==r&&(t.i=r),t.x=function(e,t){var n=Oi(e,t),i=2;return n&&n.proactive&&(i="None"==n.parameters.offer_type?3:1),i}(e,n)}return t}var Li=Ci((function(e,t,n,i,r,a,o,s,c){var u=xi(e);(u=_i(u,e,n)).Z=n,u.t=t?10:9,i&&(u.a=i.toString()),r&&(u.A=r),a&&(u.S=a.toString()),void 0!==o&&(u.f=o),s&&(u["!"]=s.toString()),c&&(u.J=c.toString()),Ai(e,u=Ni(e,u,n))})),Mi=Ci((function(e,t,n,i){var r=xi(e);r.Z=i,r.t=40,r.S=t.toString(),r.M=n,Ai(e,r)})),Wi=Ci((function(e,t,n){var i=xi(e);i.Z=n,i.t=41,i.S=t.toString(),Ai(e,i)})),Ri=Ci((function(e,t,n){var i=xi(e);i.Z=n,i.t=42,i.S=t.toString(),Di(e,i)})),Pi=Ci((function(e,t,n,i,r,a){var o=xi(e);(o=_i(o,e,n)).Z=n,o.t=t?17:18,void 0!==i&&(o.S=i.toString()),o=Ni(e,o,n),void 0!==r&&(o.f=r),void 0!==a&&(o["!"]=a.toString()),Di(e,o)})),Fi=Ci((function(e,t,n,i){var r=xi(e);r.t=11,r.Z=t,void 0!==n&&(r.k=n),void 0!==i&&(r.K=i),(r=Ni(e,r,t)).z=Ii(0,t),Ai(e,r)})),ji=Ci((function(e,t,n,i,r,a,o){var s=xi(e);s.t=33,s.Z=t,void 0!==n&&(s.k=n),void 0!==i&&(s.K=i),void 0!==r&&(s.Q=r),void 0!==a&&(s.j=a),void 0!==o&&(s["+"]=o),(s=Ni(e,s,t)).z=Ii(0,t),Ai(e,s)})),Bi=Ci((function(e,t,n,i,r,a,o,s){var c=xi(e);c.t=34,c.Z=t,void 0!==n&&(c.k=n),void 0!==i&&(c.K=i),void 0!==r&&(c.Q=r),void 0!==a&&(c.j=a),void 0!==o&&(c["+"]=o),void 0!==s&&(c.m=s),(c=Ni(e,c,t)).z=Ii(0,t),Ai(e,c)})),Vi=Ci((function(e,t,n){var i=xi(e);i.t=12,i.Z=t,n&&(i.E=String(n)),Di(e,i=Ni(e,i,t))})),Hi=Ci((function(e,t,n){var i=xi(e);return i.t=99,void 0!==n&&(i.I=n),i.V=parseFloat(t)||0,Ai(e,i),i})),qi=Ci((function(e,t,n){var i=xi(e);return i.t=5,i.V=parseFloat(t)||0,void 0!==n&&(i.F=function(e){for(var t=0;t<e.length;t++)e[t].s&&(e[t].s=e[t].s.toString());return e}(function(e,t){if(e&&e.length){var n=Object.keys(t);return e.map((function(e){var i={};return n.forEach((function(n){void 0!==e[[n]]&&(i[t[n]]=e[[n]])})),i}))}return[]}(n,bi))),Di(e,i),i})),Ui=Ci((function(e,t,n){var i=Ti(e,21,t,n);return i.Z=t,Di(e,i),i})),$i=Ci((function(e,t,n){var i=Ti(e,22,t,n);return i.Z=t,i["Δ"]=Date.now()-e.currentOfferCreatedAt,Di(e,i),i})),Ji=Ci((function(e,t,n){var i=Ti(e,23,t,n);return i.Z=t,i["Δ"]=Date.now()-e.currentOfferCreatedAt,Di(e,i),i})),Gi=Ci((function(e,t,n,i,r){var a=xi(e);if(a.Z=t,a.t=15,void 0!==n&&(a.Q=n),i&&(a.h=parseInt(i,10)),r){a.H=[];for(var o=0;o<r.length;o++){var s={};s.k=r[o].articleId,s.K=r[o].articleTitle,a.H.push(s)}}Di(e,a)})),zi=Ci((function(e,t,n,i){var r=_i(xi(e),e,t);r.Z=t,r.t=16,r=Ni(e,r,t),void 0!==n&&(r.f=n),i&&(r["!"]=i.toString()),Di(e,r)})),Ki=Ci((function(e,t,n,i,r,a){if(i){var o=_i(xi(e),e,"chat",a);switch(t){case"service-line-closed":o.t=25;break;case"no-agent-available":o.t=26;break;case"no-agent-slots-available":o.t=35;break;case"wait-too-long":o.t=27}if(n&&(o["!"]=n.toString()),void 0!==i){o.r=i;var s=ki(e,i);void 0!==s&&(o.i=s)}o.x=Ei(r),Di(e,o)}})),Xi=Ci((function(e,t,n){var i=xi(e);if(t){if(i.t=31,i=Ni(e,i,n),void 0!==n){if(void 0===Tn[n])return;i.z=Ii(0,n)}}else i.t=30;Di(e,i)})),Qi=Ci((function(e){var t=xi(e);t.t=1;var n=e.contextMonitor.getLastBrowseInfo().name;n&&(t.B=n),Di(e,t)})),Yi=Ci((function(e){var t=xi(e);t.t=2,t.U=window.navigator.userAgent;var n=e.contextMonitor.getLastBrowseInfo().version;n&&(t.b=n);var i=e.contextMonitor.getLastLocation();if(!i)return e.contextMonitor.fetchLocation().then((function(n){t.l=n.latitude,t.L=n.longitude,t.C=n.city,t.T=n.state,t.Y=n.country,Di(e,t)}));t.l=i.latitude,t.L=i.longitude,t.C=i.city,t.T=i.state,t.Y=i.country,Di(e,t)})),Zi=Ci((function(e){var t=xi(e);t.t=3,Di(e,t)})),er=Ci((function(e,t){var n=xi(e);n.t=6,n.D=JSON.stringify(t),Di(e,n)})),tr=Ci((function(e,t,n,i,r){var a=xi(t);a.t=e?13:14,a.G=n,a.r=i,a.i=r,Di(t,a)})),nr=Ci((function(e,t,n,i,r,a){var o=xi(e);o.t=20,o.r=t,o.i=n,i&&(o["!"]=i.toString()),r&&(o.z=Ii(0,r),o.Z=r),o.x=Ei(a),Di(e,o)})),ir=Ci((function(e,t,n,i){var r=xi(e);r.t=32,r.r=i,r["^"]=Dn[n],r["&"]=t,r.z=Tn.link,r.x=1,"_self"===n?Ai(e,r):Di(e,r)})),rr=Ci((function(e,t){var n=xi(e);n.t=36,n["%"]=function(e,t){if(e.length<=t)return e;return e.slice(0,t)+"..."}(t,1e3),Di(e,n)}));var ar=Ci((function(e,t){if(!sessionStorage.getItem("MoxieLegacyMethod:"+t)){var n=xi(e);n.t=37,n["~"]=t,Di(e,n),sessionStorage.setItem("MoxieLegacyMethod:"+t,!0)}}));function or(e,t){var n=new xn(e,t,"1.0");return setTimeout((function(){try{window.dispatchEvent(n)}catch(t){we.log("PublicAPI.broadcast("+e+"): error: "+(t.stack?t.stack:t.message))}})),n}function sr(e,t,n){var i,r,a,o,s,c,u;if(c={cartValue:!1,cartItems:!1},!t||!function(e){return!!(e&&e.session&&e.session.visits&&e.session.visits.length>=1)}(e))return e;if(o=e.session.visits.length-1,a=e.session.visits[o].journey.length-1,void 0!==t.currentCartValue&&(r=Number(t.currentCartValue),isNaN(r)||(e.session.visits[o].journey[a].current_cart_value=r,c.cartValue=r)),void 0!==t.currentCartItems&&(i=(u=t.currentCartItems)&&u.length>0?u.filter((function(e){if("name"in e&&""!==e.name||"sku_or_id"in e&&""!==e.sku_or_id)return!0})):[],e.session.visits[o].journey[a].current_cart_items=i,c.cartItems=i),void 0!==t.transactionTotal&&(s=Number(t.transactionTotal),isNaN(s)||(e.session.end_cart_value=s)),e.last_updated=Date.now(),c.cartValue||c.cartItems){var l=c.cartValue||r,d=c.cartItems||i;or("cartUpdated",{cartValue:l,cartItems:d}),qi(n,l,d)}return e}function cr(e){return-1!==["link"].indexOf(e)}function ur(e,t){return new j((function(n,i){n(void 0===t?e():e.call(t))}))}function lr(e){return function(){var t=this,n=[].slice.call(arguments,0);return new j((function(i){i(e.apply(t,n))}))}}function dr(e){try{var t=window[e],n="__test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return!1}}var gr=new Array(16);for(var fr,hr,vr=[],pr=0;pr<256;++pr)vr[pr]=(pr+256).toString(16).substr(1);var mr=0,yr=0;function wr(e,t,n){var i=t&&n||0,r=t||[],a=(e=e||{}).node||fr,o=void 0!==e.clockseq?e.clockseq:hr;if(null==a||null==o){var s=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),gr[t]=e>>>((3&t)<<3)&255;return gr}();null==a&&(a=fr=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=hr=16383&(s[6]<<8|s[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:yr+1,l=c-mr+(u-yr)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||c>mr)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");mr=c,yr=u,hr=o;var d=(1e4*(268435455&(c+=122192928e5))+u)%4294967296;r[i++]=d>>>24&255,r[i++]=d>>>16&255,r[i++]=d>>>8&255,r[i++]=255&d;var g=c/4294967296*1e4&268435455;r[i++]=g>>>8&255,r[i++]=255&g,r[i++]=g>>>24&15|16,r[i++]=g>>>16&255,r[i++]=o>>>8|128,r[i++]=255&o;for(var f=0;f<6;++f)r[i+f]=a[f];return t||function(e,t){var n=t||0,i=vr;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}(r)}function br(e){return!0===e?"p":"s"}function Sr(e){if(void 0!==e)try{return JSON.parse(e)}catch(t){return e}}var Cr=function(){function t(){e(this,t),this.name="DefaultStoragePlugin",this.data={p:{},s:{}}}return n(t,[{key:"destroy",value:function(){}},{key:"clear",value:function(){this.data.p={},this.data.s={}}},{key:"has",value:function(e,t){return oe(this.data[br(t)],e)}},{key:"set",value:function(e,t,n){this.data[br(n)][e]=t}},{key:"del",value:function(e,t){delete this.data[br(t)][e]}},{key:"get",value:function(e,t){var n=br(t);return oe(this.data[n],e)?Sr(this.data[n][e]):null}},{key:"removeKeysOtherThan",value:function(e,t){var n;n=t?this.data.p:this.data.s;var i=Object.keys(n);if(0!==i.length)for(var r=wi(e),a=0;a!==i.length;a++){var o=i[a];r.has(o)||delete n[o]}}}]),t}(),kr=["rules_version","uuid","widgets_version"],Er=["chat-","conclient_","email-","kbot-","kb-","MoxieCache_","moxie","cxone-expert-"];function Or(e){if(ie(kr,e,0)>=0)return!0;for(var t=0;t<Er.length;t++)if(0===e.indexOf(Er[t]))return!0;return!1}function _r(e){var t,n,i=[];for(n=0;n<e.length;n++)Or(t=e.key(n))&&i.push(t);for(n=0;n<i.length;n++)e.removeItem(i[n])}function Ir(e,t){t=wi(t);var n,i,r=function(e){var t,n,i=[];for(n=0;n!==e.length;n++)Or(t=e.key(n))&&i.push(t);return i}(e),a=[];for(i=0;i!==r.length;i++)-1!==(n=r[i]).indexOf("EventState")||t.has(n)||a.push(n);return a}var xr=function(){function t(n){e(this,t),this.parentStorage=n,this.name="LocalStorageStoragePlugin",this.skip=[Fn,Hn]}return n(t,[{key:"destroy",value:function(){this.parentStorage.destroy()}},{key:"has",value:function(e,t){return!!this.parentStorage.has(e,t)||(!0===t?null!==localStorage.getItem(e):null!==sessionStorage.getItem(e))}},{key:"set",value:function(e,t,n){if(this.parentStorage.set(e,t,n),!(ie(this.skip,e)>=0))if(!0===n)try{localStorage.setItem(e,ge(t))}catch(t){we.log("Error setting "+e+": "+t)}else try{sessionStorage.setItem(e,ge(t))}catch(t){we.log("Error setting "+e+": "+t)}}},{key:"get",value:function(e,t){if(this.parentStorage.has(e,t))return this.parentStorage.get(e,t);var n=!0===t?localStorage.getItem(e):sessionStorage.getItem(e);return null!==n&&(n=Sr(n)),n}},{key:"del",value:function(e,t){this.parentStorage.del(e,t),!0===t?localStorage.removeItem(e):sessionStorage.removeItem(e)}},{key:"clear",value:function(){this.parentStorage.clear(),_r(localStorage),_r(sessionStorage)}},{key:"removeKeysOtherThan",value:function(e,t){var n;this.parentStorage.removeKeysOtherThan(e,t);for(var i=Ir(n=t?localStorage:sessionStorage,e),r=0;r!==i.length;r++){var a=i[r];n.removeItem(a)}}}]),t}(),Tr="moxie=",Dr=Tr.length,Ar="!--moxie",Nr=Ar.length,Lr=window.top||window;function Mr(e){var t="",n="",i=e.indexOf(Tr);if(i>=0){i>0&&(t=e.slice(0,i));var r=e.indexOf(Ar,i+Dr);r>=0?(n=e.slice(i+Dr,r),t+=e.slice(r+Nr)):n=e.slice(Tr.length)}return[t,n]}function Wr(e){var t=Mr(Lr.name||"");Lr.name=t[0]+Tr+JSON.stringify(e)+Ar}var Rr=function(){function t(n,i){e(this,t),this.name="WindowNameStoragePlugin",this.parentStorage=n,this.clientName=i.clientName,this._data=function(e){var t=Mr(Lr.name||"")[1],n={};if(t.length>0)try{n=JSON.parse(t)}catch(e){we.log("JSON: unable to parse window.name value:",t)}return n[e]||(n[e]={p:{},s:{}}),n}(this.clientName);var r,a=this;this.saveItListener||(this.saveItListener=function(){Wr(a._data)},Lr.addEventListener("unload",this.saveItListener,!1));var o=a._data[this.clientName];for(r in o.p)n.set(r,o.p[r],!0);for(r in o.s)n.set(r,o.s[r],!1)}return n(t,[{key:"destroy",value:function(){this.parentStorage.destroy(),this.saveItListener&&(Lr.removeEventListener("unload",this.saveItListener),delete this.saveItListener)}},{key:"has",value:function(e,t){return this.parentStorage.has(e,t)}},{key:"set",value:function(e,t,n){if(this.parentStorage.set(e,t,n),!this.skipSaveForKey||!this.skipSaveForKey(e)){var i=!1;!0===n?(this._data[this.clientName].p[e]!==t&&(i=!0),this._data[this.clientName].p[e]=t):(this._data[this.clientName].s[e]!==t&&(i=!0),this._data[this.clientName].s[e]=t),i&&Wr(this._data)}}},{key:"get",value:function(e,t){var n=!0===t?this._data[this.clientName].p[e]:this._data[this.clientName].s[e];if(void 0!==n)try{return JSON.parse(n)}catch(e){return n}return this.parentStorage.has(e,t)?(n=this.parentStorage.get(e,t),this.skipSaveForKey&&this.skipSaveForKey(e)||(!0===t?this._data[this.clientName].p[e]=n:this._data[this.clientName].s[e]=n,Wr(this._data)),n):null}},{key:"del",value:function(e,t){this.parentStorage.del(e,t),!0===t?delete this._data[this.clientName].p[e]:delete this._data[this.clientName].s[e],Wr(this._data)}},{key:"clear",value:function(){this.parentStorage.clear(),this._data[this.clientName].p={},this._data[this.clientName].s={},Wr(this._data)}}]),t}();function Pr(e){var t=e.widgetManager,n=e.cacheManager;return e._clearingHistoryPromise||(e._clearingHistoryPromise=j.resolve(!0).then((function(){return e.contextMonitor.stop(),t.clearHistory().then((function(){t.destroy()})).then((function(){var t=e.eventService;return e.eventService={clearHistoryStub:!0,notifyEventServiceImmediately:function(){},notifyEventService:function(){}},j.resolve(t.stopEventService())})).then((function(){return j.resolve(n.storagePlugin.clear()).then((function(){n.destroy(),e.cacheManager=null}))})).catch((function(e){throw we.log("History.clearHistory received an error:",e),e}))}))),e._clearingHistoryPromise}function Fr(e){var t=e.userAgent.toString().toLowerCase(),n=e.appName,i=/(dolfin)[ /]([\w.]+)/.exec(t)||/(javafx)[/]([\w.]+)/.exec(t)||/(chrome)[ /]([\w.]+)/.exec(t)||/(opera)(?:.*version)?[ /]([\w.]+)/.exec(t)||/(webkit)(?:.*version)?[ /]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(t)||["","unknown"];return"webkit"===i[1]?i=/fbav|instagram/.test(t)&&/(iphone|ipad|ipod)/.test(t)?[i[0],"safari",i[2]]:/(iphone|ipad|ipod)\/?\s*(\.?\d+(\.\d+)*)/.exec(t)||/(android)[ /]([\w._-]+);/.exec(t)||[i[0],"safari",i[2]]:"mozilla"===i[1]?/trident/.test(t)?i[1]="MSIE":i[1]="firefox":/polaris|natebrowser|([010|011|016|017|018|019]{3}\d{3,4}\d{4}$)/.test(t)&&(i[1]="Polaris"),[i[1].toLowerCase(),"unknown"===i[2]?[n,window.navigator.appVersion,"-?"]:i[2]]}var jr={},Br=0,Vr={},Hr=0,qr={},Ur={};var $r=!1;function Jr(){$r||(we.error("Double load of concierge suspected"),$r=!0)}function Gr(e,t){var n=++Hr;return t.bridgeName="storage_bridge",t.requesterId=e.id,t.requestId=n,t.client=e.concierge.clientName,t.signature="moxie_concierge",e&&e.ifrm&&e.ifrm.contentWindow&&e.ifrm.contentWindow.postMessage?(function(){if("function"==typeof window.CustomEvent)return!1;window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}}(),e.ifrm.contentWindow.postMessage(JSON.stringify(t),"*"),new j((function(i,r){var a=setTimeout((function(){if(a=!1,r(new Error("TIMEOUT waiting for shared storage.")),e.concierge.isTestMode){var t=new CustomEvent("stopWriting");document.dispatchEvent(t)}}),6e3);if(e.concierge.isTestMode){var o=new CustomEvent("storagePost");document.dispatchEvent(o)}var s=function(){a&&(clearTimeout(a),a=!1)};qr[n]={message:t,resolve:function(e){s(),i(e)},reject:function(e){s(),r(e)}}})).finally((function(){delete qr[n]}))):(Jr(),j.resolve(!0))}function zr(e,t){this.useSharedStorage=!1,this.parentStorage=e,this.concierge=t,this.scriptLocation=t.scriptLocation,this.created=Date.now(),this.sharedStorageId=function(e){var t=Vr[e];return t||(t="concierge-shared-storage",++Br>1&&(t=t+"-"+Br),Vr[e]=t),t}(this.scriptLocation),this.id=Date.now()}function Kr(e){this.name="InvalidArgumentException",this.message=e,this.toString=function(){return this.name+": "+this.message}}function Xr(e){return Ee(e,"_file")&&e.indexOf(Vn)<0||e===Fn||e===Hn}function Qr(e,t,n,i){return j.resolve(e.storagePlugin.set(t,n,i))}zr.prototype.destroy=function(e){e&&this.parentStorage.destroy(),Ge(this.ifrm),this.removeListener?(this.removeListener(),delete this.ifrm):Jr()},zr.prototype.init=function(){var e=this;if(jr[this.id]=this,this.data={p:{},s:{}},e.ifrm=We(e.sharedStorageId),!e.ifrm){e.ifrm=document.createElement("iframe"),e.ifrm.setAttribute("id",e.sharedStorageId),e.ifrm.setAttribute("tabindex","-1");var t=e.scriptLocation+"/client/storage_bridge.html";e.ifrm.setAttribute("src",t),e.ifrm.setAttribute("sandbox","allow-scripts allow-same-origin");var n=function(t){if("."===e.scriptLocation||0===e.scriptLocation.indexOf(t.origin)){var n={};try{n="string"==typeof t.data?JSON.parse(t.data):t.data}catch(e){}if(n&&"storage_bridge"===n.bridgeName){var i,r,a,o=e;if(n.requesterId&&jr[n.requesterId]&&(o=jr[n.requesterId]),n.requesterId===o.id)n.error?(i=n.requestId,r=new Error("Error from shared storage: "+n.error.message),(a=qr[i])?a.reject(r):we.log("SharedStorageBridge: rejectRequest("+i+", "+JSON.stringify(r)+") cannot find outstanding request")):"updated"===n.request?(we.log("CONCIERGE StoragePlugin update: ",n),"moxie_cc"!==n.key||n.newValue||Pr(e.concierge).catch((function(e){we.log("ERROR clearing history"+e)}))):function(e,t){var n=qr[e];n?n.resolve(t):we.log("SharedStorageBridge: resolveRequest("+e+", "+JSON.stringify(t)+") cannot find outstanding request")}(n.requestId,n);else $r||we.log('CONCIERGE StoragePlugin request ID mismatch: plug in "'+o.id+'" receved an event for "'+n.requesterId+'"')}}};e.removeListener=function(){window.removeEventListener("message",n,!1)},Ur[e.scriptLocation]=new j((function(t){e.ifrm.onload=function(e){e.target&&e.target.src&&t(e)}})).then((function(){window.addEventListener("message",n,!1)})),e.ifrm.style.display="none",document.body.appendChild(e.ifrm)}return Ur[e.scriptLocation].then((function(){var t="safari"===Fr(window.navigator)[0];return Gr(e,{request:"init",shadowInSessionStorage:t}).then((function(t){for(var n in e.parentStorage.removeKeysOtherThan(Object.keys(t.lsValue),!0),e.parentStorage.removeKeysOtherThan(Object.keys(t.ssValue),!1),t.lsValue)e.parentStorage.set(n,t.lsValue[n],!0);for(var i in t.ssValue)e.parentStorage.set(i,t.ssValue[i],!1);e.useSharedStorage=!0})).catch((function(t){throw we.log("SharedStoragePlugin#init: Failed to load from shared storage, removing listener: "+t.message),e.removeListener(),t}))}))},zr.prototype.name="SharedStoragePlugin",zr.prototype.has=function(e,t){return this.parentStorage.has(e,t)},zr.prototype.get=function(e,t){return this.parentStorage.get(e,t)},zr.prototype.clear=function(){this.parentStorage.clear();return Gr(this,{request:"clear"}).then((function(e){return"ack"===e.request}))},zr.prototype.set=function(e,t,n){if(this.parentStorage.set(e,t,n),!this.skipSaveForKey||!this.skipSaveForKey(e))return Gr(this,{request:"store",key:e,value:t,persist:!0===n}).then((function(e){return"ack"===e.request}))},zr.prototype.del=function(e,t){return this.parentStorage.del(e,t),Gr(this,{request:"remove",key:e,persist:!0===t}).then((function(e){return"ack"===e.request}))};var Yr=0;function Zr(e){this.id=++Yr,this.concierge=e,this.storagePlugin=this.defaultStoragePlugin=new Cr;var t=dr("sessionStorage");dr("localStorage")&&t?(this.storagePlugin=new xr(this.defaultStoragePlugin),this.storagePluginToLoad=Qn):this.storagePluginToLoad=Yn,this.eventSerialNumber=null,this.saveEventSerialNumber=null,t&&(this.saveEventSerial=this.storeEventSerialNumberSessionStorage,this.eventSerialNumber=this.readEventSerialNumberFromSessionStorage())}function ea(e,t,n){return j.resolve(e.storagePlugin.del(t,n))}function ta(e){return"MoxieCache_"+e+"_file"}function na(e){if(e&&(delete e.last_updated,delete e.last_submitted,e.session&&e.session.visits)){var t=e.session.visits.length-1;if(t>=0){var n=e.session.visits[t].journey;if(n){var i=n.length-1;i>=0&&(e.session.visits[t].journey[i].end_time=0)}}}}function ia(e){var t=ta(Vn);return function(e,t){return j.resolve(e.storagePlugin.get(t,!0)).then((function(e){return e?void 0===e.contents?(we.log("Loaded "+t+" from localStorage, but .contents was undefined"),null):(we.log("Loaded "+t+" from localStorage"),e.contents):null}))}(e,t).then((function(e){if(null!==e)try{return JSON.parse(e)}catch(e){we.log("Error parsing profile: "+e.message)}return null})).then((function(t){if(null!==t)return e.setData(Vn,JSON.stringify(t),!0)})).then((function(){return e}))}function ra(e){return function(e){return e.storagePlugin.get(Pn,!0)||e.storagePlugin.get(Rn,!0)}(e)?e.autoLoadProperties().then(ia).then((function(){return e})):function(e){we.log("Creating new identity");var t=e.makeProfileId();return j.all([Qr(e,Rn,t,!0),Qr(e,Pn,t+"|2147483647",!0)]).then((function(){return e.uuid=t,e}))}(e).then(ia).then((function(){return e}))}Zr.prototype.storeEventSerialNumberSessionStorage=function(e){window.sessionStorage.setItem(Kn,JSON.stringify(e))},Zr.prototype.readEventSerialNumberFromSessionStorage=function(){var e=window.sessionStorage.getItem(Kn);if(null==e||""===e)return null;var t=null;try{t=JSON.parse(e)}catch(e){return we.log("Could not read serial number from session storage: "+e.message),null}return"number"!=typeof t||Math.floor(t)!==t||t<0||t>Xn?null:t},Zr.prototype.makeEventSerialNumber=function(){null===this.eventSerialNumber&&(this.eventSerialNumber=Math.floor(Math.random()*(Math.pow(2,32)-1)));var e=this.eventSerialNumber++;return this.saveEventSerial&&this.saveEventSerial(this.eventSerialNumber),this.eventSerialNumber>Xn&&(this.eventSerialNumber=0),e},Zr.prototype.cleanup=function(){delete this.profileJSON,delete this.uuid},Zr.prototype.destroy=function(){this.cleanup(),this.storagePlugin.destroy()},Zr.prototype.skipSaveForKey=Xr,Zr.prototype.isValidUserProfile=function(e){return void 0!==e.session&&void 0!==e.session.id},Zr.prototype.getVisitorProfileId=function(){return this.getDataClone(Rn)},Zr.prototype.emitEvent=function(e){var t;return"function"==typeof CustomEvent?t=new CustomEvent(e):(t=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,{}),we.log("CacheManager: emitting profile update event: "+JSON.stringify(t)),this.dispatchEvent(window,t)},Zr.prototype.dispatchEvent=function(e,t){return e.dispatchEvent(t)},Zr.prototype.resetVisitorProfile=function(){var e=this;return this.concierge.contextMonitor.stop(),ea(this,ta(Vn),!0).then((function(){e.visitorProfile=null;var t=e.concierge.contextMonitor.createNewProfile();return e.setData(Vn,JSON.stringify(t))})).then((function(){e.concierge.contextMonitor.start()}))},Zr.prototype.setData=lr((function(e,t,n){if(!yi(t))throw new Kr("Cannot set "+e+", data must be a string.");if(e===Vn){var i,r=this.getDataClone(Vn);try{i=JSON.parse(t)}catch(t){throw new Kr("Cannot set "+e+", data is invalid JSON.")}var a=!1,o=!n&&function(e,t){var n=!1;if(e&&e.session&&e.session.visits&&e.session.visits.length>0){var i=e.session.visits.slice(-1)[0];if(i.journey&&i.journey.length>0){var r=i.journey.slice(-1)[0];new Date-new Date(r.end_time)>60*t*1e3&&(n=!0)}else n=!0}else n=!0;return n}(r,30),s=!1;if(n||null!=r){if(void 0!==i.customData)if(r&&void 0!==r.customData)JSON.stringify(r.customData)!==JSON.stringify(i.customData)&&(s=!0);else s=!0}else a=!0,void 0!==i.customData&&(s=!0);return a&&Qi(this.concierge),o&&Yi(this.concierge),s&&er(this.concierge,i.customData),this.storeProfile(t)}if(e===qn)return this[qn]=t,Qr(this,qn,t,!0);if(e===Jn)return this.rules_version=t,Qr(this,Jn,t,!0);if(e===Gn)return this.widgets_version=t,Qr(this,Gn,t,!0);throw new Kr("Cannot set "+e+", unknown property.")})),Zr.prototype.storeProfile=lr((function(e){var t,n=this,i=JSON.parse(e);if(n.isValidUserProfile(i)){n.profileJSON=i;var r=(t=0,{contents:e,timestamp:(new Date).getTime(),version:t});return Qr(n,ta(Vn),r,!0)}throw new Kr("Cannot store profile, it is not valid.")})),Zr.prototype.setVolatileData=lr((function(e,t){if(e===Un||e===$n)return this[e]=t;throw new Kr("Cannot set "+e+".")})),Zr.prototype.getVolatileData=function(e){return this[e]},Zr.prototype.profileUpdated=function(e){var t=this.getDataClone(Vn),n=fi(e);return na(n),na(t),JSON.stringify(t)!==JSON.stringify(n)},Zr.prototype.getData=function(e){var t=this[e];return t?"object"===i(t)?fi(this[e]):this[e]:null},Zr.prototype.getDataClone=function(e){return this.getData(e)},Zr.prototype.getDataObject=function(e){return this[e]?this[e]:null},Zr.prototype.removeClientCache=function(e,t){return ea(this,"conclient_"+e,t)},Zr.prototype.setClientCache=function(e,t,n){return Qr(this,"conclient_"+e,t,n)},Zr.prototype.getClientCache=function(e,t){return this.storagePlugin.get("conclient_"+e,t)},Zr.prototype.removeWidgetCache=function(e,t,n){return ea(this,e+"-"+t,n)},Zr.prototype.setWidgetCache=function(e,t,n,i){return Qr(this,e+"-"+t,n,i)},Zr.prototype.getWidgetCache=function(e,t,n){return this.storagePlugin.get(e+"-"+t,n)},Zr.prototype.clearWidgetCacheKey=function(e,t){for(var n=[],i=this.storagePlugin;i.parentStorage;)i=i.parentStorage;var r,a=t?"p":"s",o=Object.keys(i.data[a]);for(r=0;r<o.length;r++)Ee(o[r],e)&&n.push(ea(this,o[r],t));return j.all(n)},Zr.prototype.init=function(){var e=this;if(!this.ready){var t,n=j.resolve(e);e.storagePluginToLoad===Yn?(e.storagePlugin=new Rr(e.storagePlugin,e.concierge),e.storagePlugin.skipSaveForKey=Xr):e.storagePluginToLoad===Qn&&(t=new zr(e.storagePlugin,e.concierge),n=n.then((function(){return t.init()})).then((function(){e.storagePlugin=t,t.skipSaveForKey=Xr})).catch((function(e){t&&t.destroy(!1),we.log("FAILED to initialize the SharedStoragePlugin falling back to using regular localStorage: "+e.message)})).then((function(){return e}))),this.ready=n}return this.ready.then(ra)};var aa=function(e,t){j.resolve(e.storagePlugin.get(t,!0)).then((function(n){e[t]=n}))};Zr.prototype.autoLoadProperties=function(){var e=this,t=[];return t.push(e.storagePlugin.get(Pn,!0)),t.push(e.storagePlugin.get(Rn,!0)),t.push(aa(e,qn)),t.push(aa(e,Jn)),t.push(aa(e,Gn)),j.all(t).then((function(t){var n,i=t[0],r=t[1];return n=i?i.split("|").shift():r,e.uuid=n,e}))},Zr.prototype.makeProfileId=function(){return wr()};var oa=200,sa=null,ca=null,ua=null;function la(e){this.monitoredRules=[],this.concierge=e,this.rulesEngine=e.rulesEngine,this.cacheManager=e.cacheManager,this.moxieData=window.MoxieData||{},this.getLastLocation=function(){return sa},this.getLastDevice=function(){return ca},this.getLastBrowseInfo=function(){return ua};var t=0,n=0;this.nextMonitorId=function(){return++n},this.start=function(){var e=this;t=setInterval((function(){e.poll()}),1e3)},this.stop=function(){t>0&&(clearInterval(t),t=0)}}la.prototype.cleanup=function(){this.stop()},la.prototype.evalRules=function(){this.monitoredRules.forEach((function(e){this.rulesEngine.evalRule(e)?(this.rulesEngine.queueActions(e),this.unregister(e),e.monitor=!1):this.rulesEngine.rulesSucceeded[e.id]&&this.unregister(e)}),this)},la.prototype.fetchLocation=function(){return this.concierge.httpGet(this.concierge.serviceUrl.location,{type:"GET"}).then((function(e){var t=e.subdivisions&&e.subdivisions.length?e.subdivisions[0].names.en:"";return{city:e.city?e.city.names.en:"",state:t,country:e.country?e.country.names.en:"",ip_address:"",zip:"",longitude:e.location?e.location.longitude:"",latitude:e.location?e.location.latitude:""}}))},la.prototype.recordEngagementValue=function(){var e=this.cacheManager.getDataClone(Vn),t=di(gi(e,1),1).current_cart_value;return void 0===e.session.first_engagement_cart_value&&(e.session.dirty=!0,e.session.first_engagement_cart_value=t),void 0===e.session.visits[e.session.visits.length-1].first_engagement_cart_value&&(e.session.visits[e.session.visits.length-1].first_engagement_cart_value=t),this.cacheManager.setData(Vn,JSON.stringify(e))},la.prototype.parseMappedContext=function(e){if(void 0!==e){"string"==typeof e&&(e=[e]);var t=function(e,t){t.replace(/^\$\[/,"").replace(/\]\$$/,"");var n=cn(Je(t)),i=n.text()||n.val();return i?i.trim():""};for(var n in e)oe(e,n)&&"string"==typeof e[n]&&(e[n]=e[n].replace(/\$\[(.*?)\]\$/g,t));return e}},la.prototype.initTracking=function(){var e,t=0,n=0,i=this.cacheManager.getDataClone(Vn),r=!1,a=!1,o=Fr(navigator);ua={name:o[0],version:o[1]},ca=Wn(navigator);var s=Number(this.cacheManager.getData(qn)),c=this;if(null==i)(i={id:this.cacheManager.getData(Rn),dirty:!0,tags:null,ip_address:"",all_device_names:[],all_browsers:[{name:ua[0],version:ua[1],language:navigator.language}],all_locations:null,preferences:{never_invite_to_chat:!1,language:navigator.language},session:null,history:{visits:0,last_visit:Date.now(),articles_viewed:0,invited_chat:0,refused_chat:0},last_updated:Date.now(),last_submitted:0}).all_device_names.push(ca),r=!0,a=!0;else{if(Number(di(gi(i,1),1).end_time)<s&&(t=i.session.visits.length-1,e=i.session.visits[t].journey.length-1,i.session.visits[t].journey[e].end_time=s,i.last_updated=s),!0!==i.session.transaction_completed&&!0!==this.moxieData.transactionComplete||(this.moxieData.transactionComplete&&(i.session.transaction_completed=this.moxieData.transactionComplete=!0,i.session.end_cart_value=this.moxieData.transactionTotal,or("transactionCompleted",{transactionTotal:this.moxieData.transactionTotal,cart:{value:this.moxieData.currentCartValue,items:this.moxieData.currentCartItems}}),Hi(this.concierge,this.moxieData.transactionTotal),this.cacheManager.setData(Vn,JSON.stringify(i))),void 0!==this.moxieData.customData&&this.concierge.publicAPI.customData(this.concierge,this.moxieData.customData),i.session=null),void 0!==i.session&&null!==i.session&&void 0!==i.session.visits){var u=ve(di(gi(i,0)).start_time);(u>2592e3||isNaN(u))&&(i.session=null)}null!==i.session&&0!==i.session.visits.length&&((n=ve(di(gi(i,1),1).end_time))>1800||isNaN(n))&&(a=!0)}if(null===i.session||void 0===i.session){var l={};l.id=wr(),l.visits=[],l.dirty=!0,l.end_cart_value=0,i.session=l,r=!0,a=!0}if(a){var d={};d.id=wr(),d.dirty=!0,d.journey=[],d.browser={name:ua[0],version:ua[1],language:navigator.language},d.device={},d.device.name=Wn(navigator),d.referral={url:document.referrer.substr(0,oa)},d.journey=[],i.session.visits.push(d),i.history.visits+=1,r=!0}var g={};g.id=wr(),g.dirty=!0,g.url=this.concierge.url.substr(0,oa),g.title=this.concierge.pageTitle.substr(0,200),g.start_time=Date.now(),g.end_time=Date.now(),g.referral={url:document.referrer.substr(0,oa)};var f=di(gi(i,1),1),h=f&&f.current_cart_value?f.current_cart_value:0;if(void 0!==this.moxieData.customData&&this.concierge.publicAPI.customData(this.concierge,this.moxieData.customData),void 0!==this.moxieData.currentCartValue){g.current_cart_value=this.moxieData.currentCartValue;var v=this.moxieData.currentCartItems||(f&&f.current_cart_items?f.current_cart_items:[]);or("cartUpdated",{cartValue:this.moxieData.currentCartValue,cartItems:v}),qi(this.concierge,this.moxieData.currentCartValue,v)}else g.current_cart_value=h;if(void 0!==this.moxieData.currentCartItems){var p;for(g.current_cart_items=[],p=0;p<this.moxieData.currentCartItems.length;p++)g.current_cart_items.push({name:this.moxieData.currentCartItems[p].name?this.moxieData.currentCartItems[p].name:"",sku_or_id:this.moxieData.currentCartItems[p].skuOrId,value:this.moxieData.currentCartItems[p].value,quantity:this.moxieData.currentCartItems[p].quantity,uom:this.moxieData.currentCartItems[p].uom,description:this.moxieData.currentCartItems[p].description})}else{var m=f&&f.current_cart_items?f.current_cart_items:[];g.current_cart_items=fi(m)}t=i.session.visits.length-1;return i.history.last_visit=Date.now(),(r?this.fetchLocation().then((function(e){sa=e,hi(i,"ip_address",e.ip_address),hi(i.session,"ip_address",e.ip_address);var n=!0;if(i.all_locations)for(var r=0;r<i.all_locations.length;r++)if(i.all_locations[r].city===e.city){n=!1;break}n&&(i.all_locations=i.all_locations||[],i.all_locations.push(e)),a&&(i.session.visits[t].ip_address=e.ip_address,i.session.visits[t].location=e)})).catch((function(e){we.log("Failed to fetch location: "+JSON.stringify(e))})):j.resolve()).then((function(){return i.session.visits[t].journey.push(g),c.cacheManager.setData(Vn,JSON.stringify(i)).then((function(){return{rules:1,widgets:c.concierge.configuration.widgets.version}}))}))},la.prototype.createNewProfile=function(){var e=Date.now();return{last_updated:e,last_submitted:0,history:{last_visit:e},session:{id:wr(),dirty:!0,visits:[{journey:[{id:wr(),dirty:!0,start_time:e,end_time:e,title:this.concierge.pageTitle.substr(0,200),url:this.concierge.url.substr(0,oa),current_cart_value:0,current_cart_items:[]}]}],transaction_completed:!1,end_cart_value:0}}},la.prototype.poll=function(){var e=Date.now(),t=this;ur((function(){t.evalRules();var n=[];if(n.push(t.cacheManager.setData(qn,e.toString(),!0)),"function"==typeof document.hasFocus&&document.hasFocus()){var i=t.cacheManager.getDataClone(Vn),r=i.session.visits.length-1,a=i.session.visits[r].journey.length-1;i.session.visits[r].journey[a].end_time=e,i.last_updated=e,n.push(t.cacheManager.setData(Vn,JSON.stringify(i)))}return j.all(n)})).catch((function(e){we.log("ContextMonitor.poll: error "+(e.stack?e.stack:e.message))}))},la.prototype.register=function(e){e.monitor&&!e.monitorId&&(e.monitorId=this.nextMonitorId(),this.monitoredRules.push(e))},la.prototype.unregister=function(e){if(e.monitor&&void 0!==e.monitorId)for(var t=e.monitorId,n=0;n<this.monitoredRules.length;n++)if(this.monitoredRules[n].monitorId===t){this.monitoredRules.splice(n,1),e.monitorId=!1;break}},la.prototype.tagProfile=function(e,t){var n=Vn,i=this.cacheManager.getData(n);i.tags=i.tags||[];var r={status:!1,tags:e.tag.filter((function(e){return-1===i.tags.indexOf(e)}))};return r.tags.length&&(i.tags=i.tags||[],i.tags=i.tags.concat(r.tags),this.cacheManager.setData(n,JSON.stringify(i)),r.status=!0),r},la.prototype.removeProfileTag=function(e,t){var n=Vn,i=this.cacheManager.getData(n);i.tags=i.tags||[];var r={status:!1,tags:e.tag.filter((function(e){return-1!==i.tags.indexOf(e)}))};return r.tags.length&&(i.tags=i.tags.filter((function(e){return-1===r.tags.indexOf(e)})),0===i.tags.length&&(i.tags=null),this.cacheManager.setData(n,JSON.stringify(i)),r.status=!0),r};var da=function(){function t(n){e(this,t),this.concierge=n}return n(t,[{key:"log",value:function(e){we.log(e)}},{key:"location",value:function(){return this.concierge.scriptLocation+"/widgets/"+this.concierge.assetVersion.widgets+"/translation.json"}},{key:"navigator",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return navigator}))},{key:"htmlElement",value:function(){return document.documentElement}},{key:"sanitizeLang",value:function(e){return e=(e=e.toLowerCase()).replace("_","-")}},{key:"parentLang",value:function(e){return e?e.split("-").slice(0,-1).join("-"):""}},{key:"detectLanguage",value:function(){var e=this.navigator(),t=this.htmlElement(),n=this.sanitizeLang(t.getAttribute("lang")||t.getAttribute("xml:lang")||e.languages&&e.languages[0]||e.language||e.userLanguage||this.data.defaultLanguage||"en");return this.log("Language: "+n),n}},{key:"getValue",value:function(e,t){var n=this.data.sourceLangs[e];return!(!n||!oe(this.data.langs[n],t))&&this.data.langs[n][t]}},{key:"translate",value:function(e,t){for(var n=this.data.selectedLanguage,i=!1,r=!1;n;){if(!1!==(i=this.getValue(n,e)))return i;n===this.data.defaultLanguage&&(r=!0),(n=this.parentLang(n))||r||(n=this.data.defaultLanguage)}return t||"__"+e+"__"}},{key:"handleJSONResponse",value:function(e){this.data=e,e.selectedLanguage=this.detectLanguage(),e.defaultLanguage=this.sanitizeLang(e.defaultLanguage);for(var t={},n=Object.keys(e.langs),i=0;i<n.length;i++)t[this.sanitizeLang(n[i])]=n[i];e.sourceLangs=t,this.concierge.langOptions={defaultLanguage:e.defaultLanguage,selectedLanguage:e.selectedLanguage}}},{key:"init",value:function(){this.handleJSONResponse(this.concierge.configuration.translations)}}]),t}();function ga(e,t){return e.then((function(e){try{var n=t(e);void 0!==n&&(e=n)}catch(e){we.error("Error in callback function: "+e)}return e}))}var fa=function(){function t(){e(this,t),this.callbacks=[]}return n(t,[{key:"add",value:function(e){this.callbacks.push(e)}},{key:"doCallbacksAsync",value:function(e){for(var t=j.resolve(e),n=0;n<this.callbacks.length;n++)t=ga(t,this.callbacks[n]);return t}},{key:"doCallbacksSync",value:function(e){for(var t=0;t<this.callbacks.length;t++)try{var n=this.callbacks[t](e);void 0!==n&&(e=n)}catch(e){we.error("Error in callback function: "+e)}return e}}]),t}();function ha(e){this.concierge=e,this.names={}}function va(){this.isRunning=!1,this.whenDone=j.resolve(!0),this.queue=[]}function pa(e){we.log("ActionQueue: Error thrown from run promise, "+JSON.stringify(e))}function ma(e){this[1]=function(t,n,i){return e.widgetManager.addWidget(n,{id:t.id,action:i,name:t.name,source:t.source})},this[2]=function(t,n,i){var r=e.widgetManager.findWidget(n.widget);return e.widgetManager.removeWidget(r,void 0)},this[3]=function(t,n,i){return e.widgetManager.notify(n,{id:t.id,action:i,name:t.name,source:t.source})},this[4]=function(t,n,i){return e.contextMonitor.tagProfile(n,{id:t.id,action:i,name:t.name,source:t.source})},this[5]=function(t,n,i){return e.contextMonitor.removeProfileTag(n,{id:t.id,action:i,name:t.name,source:t.source})}}function ya(){if(0!==arguments.length){for(var e=arguments.length<=0?void 0:arguments[0],t=1;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(null==e)return;e="function"==typeof n?n(e):e[n]}return e}}function wa(e){var t=e.cacheManager;this.conciergeItem=function(t){return e[t]},this.visitorProfileGetTags=function(){return t.getData(Vn).tags},this.visitsToSite=function(){return ya(t.getData(Vn),"history","visits")},this.currentCartValue=function(){return di(gi(t.getData(Vn),1),1).current_cart_value},this.productsInCart=function(){return di(gi(t.getData(Vn),1),1).current_cart_items},this.userDeviceName=function(){return gi(t.getData(Vn),1).device.name.toLowerCase()},this.secondsOnCurrentPage=function(){var e=di(gi(t.getData(Vn),1),1);return ve(Date.now(),e.start_time)},this.secondsOnSite=function(){var e=gi(t.getData(Vn),1),n=di(e,0);return ve(di(e,1).end_time,n.start_time)},this.secondsFromLastVisit=function(){var e,n=gi(t.getData(Vn),2,2,!1);if(n){var i=di(n,2,1,!1);void 0!==i&&void 0!==i.end_time&&(e=ve(i.end_time))}return e},this.numberOfPagesVisited=function(){return gi(t.getData(Vn),1).journey.length},this.geographicLocationItem=function(e){return gi(t.getData(Vn),1).location[e]},this.numberOfTimesPageViewed=function(){for(var n=gi(t.getData(Vn),1),i=0,r=1;r<=n.journey.length;r++){di(n,2,r,!1).url===e.url&&i++}return i},this.referralURL=function(){return di(gi(t.getData(Vn),1),1).referral.url},this.lastPageVisitedItem=function(e){return di(gi(t.getData(Vn),1),2)[e]},this.previouslyVisitedItems=function(e){for(var n=gi(t.getData(Vn),1),i=[],r=1;r<=n.journey.length;r++){var a=di(n,2,r,!1);i.push(a[e])}return i},this.elementCount=function(e){return cn(Je(e)).length},this.elementValue=function(e){var t=cn(Je(e)),n={},i=!1;return t[0]&&"SELECT"===t[0].nodeName&&(t=cn(Je(e)).find("option:checked"),i=!0),i?(n.value=t.val(),n.text=t.text()):n.value=t.val()||t.text(),n},this.customValue=function(e){return ya(window,"MoxieData",e)}}function ba(e){return 9===e}function Sa(e){return 13===e}function Ca(e){return 32===e}function ka(e){return 38===e}function Ea(e){return 40===e}ha.prototype.getServiceLines=function(){var e,t;return this.linesPromise||(this.linesPromise=(e=this.concierge,t=e.serviceUrl.connector+"/connector/channels/service_lines",e.httpGet(t).then((function(e){for(var t={},n=e.response,i=0;i<n.length;i+=1)t[n[i].id]=n[i].name;return t})).catch((function(e){throw we.log("Error in fetchServiceLines"+e),e})))),this.linesPromise},ha.prototype.setName=function(e,t){this.names[e]=j.resolve(t)},ha.prototype.getName=function(e){return this.names[e]?this.names[e]:this.getServiceLines().then((function(t){return t[e]})).catch((function(){}))},va.prototype={done:function(){return 0===this.queue.length?(this.isRunning=!1,this.finishedRunning&&this.finishedRunning(!0),!0):this.next()},enqueue:function(e){return this.queue.unshift(e),this.run()},next:function(){var e=this,t=this.queue.pop();return ur((function(){var e=j.resolve(t.func(t.params.rule,t.params.parameters,t.params.type));return t.postAction?t.postAction(e):e})).catch((function(e){we.log("ActionQueue: Error thrown while executing action, "+t.label+"; "+e.message+"; "+e.stack)})).finally((function(){return e.done()}))},run:function(){var e=this;return!e.isRunning&&e.queue.length>0&&(e.isRunning=!0,e.whenDone=new j((function(t){e.finishedRunning=t})),setTimeout((function(){return e.isRunning?e.next().catch(pa):null}))),this.whenDone}};var Oa=["onafterprint","onbeforeprint","onbeforeunload","onerror","onhashchange","onload","onmessage","onoffline","ononline","onpagehide","onpageshow","onpopstate","onresize","onstorage","onunload","onblur","onchange","oncontextmenu","onfocus","oninput","oninvalid","onreset","onsearch","onselect","onsubmit","onkeydown","onkeypress","onkeyup","onclick","ondblclick","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onwheel","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","onscroll","oncopy","oncut","onpaste","onabort","oncanplay","oncanplaythrough","oncuechange","ondurationchange","onemptied","onended","onerror","onloadeddata","onloadedmetadata","onloadstart","onpause","onplay","onplaying","onprogress","onratechange","onseeked","onseeking","onstalled","onsuspend","ontimeupdate","onvolumechange","onwaiting","ontoggle"];function _a(e){return e===Zn||e===ei}function Ia(e){return _a(ya(e,"parameters","rule","source"))}var xa={status:!1},Ta="free-floating";function Da(e){return"kbot"===e}function Aa(e){return function(e){return"chat"===e}(e)||Da(e)}function Na(e){return function(e){return"kbot"===e||e==ri}(e)?"chat":e}function La(e){var t=1e3*e.rulesEngine.minTimeBetween();return!(t<=0)&&Date.now()<function(e){var t=Number(e.cacheManager.getClientCache("lastNotified"));return isNaN(t)?0:t}(e)+t}function Ma(e){return!!e.engagementWidgets.globalSettings.singleChannelMode}function Wa(e,t){var n=Xa(e,t.spot);return!n||(!n.widget||t!==n.widget&&(!So(e,n.widget)&&(!!t.parameters&&!!function(e,t){if(!e||!t)return!0;var n=e.parameters,i=t.parameters;if(!n||!i)return!1;if(e.name!==t.name)return!0;switch(e.name){case"chat":if(parseInt(n.portalId,10)!==parseInt(i.portalId,10))return!0;break;case"kb":if(parseInt(n.portalId,10)!==parseInt(i.portalId,10))return!0;if(""+n.searchText!=""+i.searchText)return!0;if(""+n.articleId!=""+i.articleId)return!0;break;case"cxone-expert":if(parseInt(n.siteId,10)!==parseInt(i.siteId,10))return!0;if(""+n.searchText!=""+i.searchText)return!0;if(""+n.articleUrl!=""+i.articleUrl)return!0;if(""+n.touchpointId!=""+i.touchpointId)return!0;break;case"email":if(parseInt(n.mailboxId,10)!==parseInt(i.mailboxId,10))return!0}return!1}(n.widget,t))))}function Ra(e){return cn('#concierge-widgets ul li[data-spot="'+e+'"]')}function Pa(e){if(void 0!==e){var t,n;try{t=e.width.animVal.value,n=e.height.animVal.value}catch(e){return!1}be(e,"viewBox")||Se(e,"viewBox","0 0 "+t+" "+n),Se(e,"height",25),Se(e,"width",25)}}function Fa(e,t){var n=j.resolve(),i=e.wmState.open;if(!i)return n;var r=cn("#concierge-widget-area");r.removeClass("con-open"),e.widgetsType.closeWidgets&&e.widgetsType.closeWidgets();var a=i.name;return e.$concierge.find("#concierge-widgets li[data-widget="+a+"] .con-icon").attr("aria-expanded","false"),e.device===Nn&&(r.hasClass("con-animating")&&(n=n.then((function(){return r.promise()}))),n=n.then((function(){e.makePositionFixed(),e.forceBlur()}))),e.$concierge.removeClass("con-open-widget"),e.openWidget=!1,e.wmState.open=null,n.then((function(){if(e.widgetsType.focusWidgetButton(a),t)return or("widgetClosed",{widgetName:a})})).catch((function(e){we.log("Error Closing Widget:"+e)}))}function ja(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{var n=new DOMParser;e=n.parseFromString(t,"text/html")}catch(e){return we.error("DomParser failed to parse:",t,"with error:",e),""}return wn(e.getElementsByTagName("*")).forEach((function(e){"SCRIPT"===e.nodeName?e.parentElement.removeChild(e):Oa.forEach((function(t){e.removeAttribute(t)}))})),e.documentElement.outerHTML}function Ba(e){var t="other";return 2===e?t="widgetMessage":1===e&&(t="proactiveOffer"),t}function Va(e,t){return function(n){return!e._disabled&&n&&n.status?t(n):n&&!n.status?n:xa}}function Ha(e,t){var n=e.wmState,i=cn("#concierge-widgets ul"),r=i.children("li");if(!(r.length<=1)){var a=t?1:-1;r.sort((function(e,t){var i=e.getAttribute("data-spot"),r=t.getAttribute("data-spot"),o=Xa(n,i).widget.sortKey,s=Xa(n,r).widget.sortKey;return o>s?1*a:o<s?-1*a:0})),r.detach().appendTo(i)}}function qa(e,t,n,i,r){if(e&&parseInt(t,10)>n&&!i&&!r)throw new Error("queue wait time is too long");return!0}var Ua="single",$a="chat",Ja="kb",Ga="email";function za(e){var t,n=this;(n.wm=e,n.concierge=e.concierge,Ma(e))?n.spots=q({},Ua,new Ka(Ua)):n.spots=(q(t={},$a,new Ka($a)),q(t,Ja,new Ka(Ja)),q(t,Ga,new Ka(Ga)),t);n.offer=null,n.notification=null,n.open=null,n.active=[],n.alive=[]}function Ka(e){this.name=e,this.reactive=null,this.widget=null,this.twiddled=!1}function Xa(e,t){return e.spots[t]}function Qa(e,t){var n=t.preferredSpotName();return n?Ma(e.wm)?Ua:oe(e.spots,n)?n:null:null}function Ya(e){return e.name===ri}function Za(e){return!!e.active.find(Ya)}function eo(e,t){if(e.wm.notificationDisplayed())return!1;if(no(e))return!1;if(to(e))return!1;if(io(e))return!1;if(Za(e))return we.log("wmStateCanMakeOffer false because DFO chat is active"),!1;var n=Qa(e,t);if(n){var i=ya(Xa(e,n),"widget");if(i&&!i.hasFinished&&0!==i.state)return!1}return!0}function to(e){return!!e.offer}function no(e){return!!e.open}function io(e){return!!e.notification}function ro(e,t){return Ia(t)?function(e,t){if(null===t.preferredSpotName())return!0;var n=Xa(e,t.spot);if(n){if(!n.widget)return!0;if(So(e,n.widget))return!1;if(n.widget.hasFinished)return!0;if(n.widget.priority<t.priority)return!0;if(0===n.widget.state)return!0}return!1}(e,t):t.parameters.proactive||!1?function(e,t){if(to(e))return!1;if(null===t.preferredSpotName())return!0;var n=Xa(e,t.spot);if(n){if(!n.widget)return!0;if(n.widget.priority<t.priority)return!0;if(n.widget.hasFinished)return!0;if(0===n.widget.state)return!0}return!1}(e,t):function(e,t){var n=Xa(e,t.spot);if(n){if(!n.reactive)return!0;if(n.reactive.priority<t.priority)return!0}return!1}(e,t)}function ao(e,t){t&&(e.open===t&&Fa(e.wm,!1),t.unload())}function oo(e,t){var n=Xa(e,t.spot);n&&n.widget!==t&&(ao(e,n.widget),n.widget=t,e.wm.engagementWidgets.widgets[t.name]=t,e.wm.widgetsType.updateWidgetElement(t),e.notification&&e.wm.widgetsType.updateNotification(),t.name===ri&&t.setCaseCustomFields())}function so(e,t){var n=Xa(e,t);return n&&n.widget?n.widget:null}function co(e,t,n){var i=t.spot;if(t.parameters.proactive&&!e.wm.loadingActiveWidgets)return e.offer=t,void function(e,t,n){var i=Xa(e,t);i&&!i.widget&&oo(e,n)}(e,i,t);var r=Xa(e,i);r&&(Ia(t)||(r.reactive=t),(n||function(e,t,n){return!t||!So(e,t)&&(!!t.hasFinished||n.priority>t.priority||0===t.state)}(e,r.widget,t))&&oo(e,t))}function uo(e,t){var n=Xa(e,t);null!=n&&(n.widget&&n.widget.name!=ri&&"undefined"!=typeof brandembassy?(e.wm.concierge.cacheManager.setWidgetCache(ri,"minimized",!0,!0),document.getElementById("concierge-widget-area").classList.remove("be-guide-frame")):e.wm.concierge.cacheManager.setWidgetCache(ri,"minimized",!1,!0),we.log('wmState twiddling spot: "'+t+'"'),n.twiddled=!0)}function lo(e){var t=e.offer;t&&(e.offer=null,"None"!==t.parameters.offer_type&&e.wm.broadcastCloseProactiveNotification(t,"accepted"),oo(e,t),0===t.state&&t.execute(e.wm),null!==t.spot&&e.wm.widgetsType.openWidgetMenu&&e.wm.widgetsType.openWidgetMenu(),uo(e,t.spot))}function go(e){if(to(e)){var t=e.offer;!function(e,t){if(t){var n=t.engagementId,i=e.getEngagementRecord(n),r=t.parameters;if("chat"===t.name){if(i.proactive&&r.rule){var a=new Date(i.time).getTime();i.chat.time_to_decide=Math.round(((new Date).getTime()-a)/1e3),i.decision_type="Declined",e.setEngagementRecord(n,i)}}else null!==i&&i.proactive&&(i.decision_type="Declined",e.setEngagementRecord(n,i))}}(e.wm,t),fo(e),e.wm.broadcastCloseProactiveNotification(t,"declined")}}function fo(e){if(to(e)){var t=e.offer,n=Xa(e,t.spot);e.offer=null,n&&n.widget===t?n.reactive&&n.reactive!==t&&oo(e,n.reactive):ao(e,t)}}function ho(e){if(io(e)){var t=e.notification;or("notification",{widgetName:Na(t.name),rule:t.parameters.rule,engagementId:t.engagementId,notificationType:Ba(t.notificationType),status:"closed"}),e.wm.setNotificationType(0);var n=e.wm.widgetsType.closeNotification();return e.notification=null,n}}function vo(e){if(io(e)){var t=e.notification;ho(e),to(e)?lo(e):e.wm.showWidget(t),e.wm.widgetsType.notificationAccepted()}}function po(e){io(e)&&(ho(e),to(e)&&go(e))}function mo(e){io(e)&&(ho(e),to(e)&&function(e){to(e)&&fo(e)}(e))}function yo(e,t){var n=t.label();return bo(e,t).then((function(i){return i.status?(wo(e,t),t.autoOpen?j.resolve(e.wm.widgetsType.openConcierge(t)).then((function(){return i})):i):(we.log("WidgetManager.addWidget("+n+"): did not add widget"),i)})).catch((function(e){return we.log("WidgetManager.addWidget("+n+"): failed: "+e),we.log(e.stack),xa}))}function wo(e,t){var n=e.wm,i=t.name,r=t.spot;if(co(e,t,!1),r){var a=Ra(r);if(0===a.length)n.widgetsType.addWidget(t);else{var o=a.find("button");t.buttonEnabled?o.removeAttr("disabled"):o.attr("disabled","")}}t.shouldDisplayBell()&&(n.shouldDisplayBell=!0),cn("#concierge").show();var s=cn("#concierge-tab");Ma(n)&&n.isMobile()&&n.shouldDisplayBell||n.shouldDisplayBell&&!Ma(n)?s.show():s.hide(),we.log("wmStateAddWidget(".concat(t.label(),"): complete OK")),or("widgetAdded",{widgetName:Na(i),rule:{id:ya(t,"parameters","rule","id"),name:ya(t,"parameters","rule","name")}})}function bo(e,t){t.parameters=t.parameters||{};var n=t.parameters,i=e.wm,r=t.engagementId;if(we.log("wmStatePrepareToAddWidget called with:",n,r),n.proactive=n.proactive||!1,n.rule=n.rule||{},Ia(t)&&(t.priority=2),t.spot=Qa(e,t),!ro(e,t))return j.resolve(xa);var a=t.label();we.log("wmStatePrepareToAddWidget(".concat(a,"): invoked.'"));var o={status:!0,ref:t,parameters:n,proactive:n.proactive,engagementId:r,ruleSettings:i.concierge.rulesEngine.getSiteSettings()};return t.beforeAdd(o).then(Va(i,(function(e){return void 0!==t.prepareToLoad&&(t.prepareToLoadPromise=t.prepareToLoad(e).then((function(e){return e&&e.autoOpen?i.widgetsType.openConcierge(t):e}))),e})))}function So(e,t){return t.name!=ri?ie(e.active,t)>=0:Za(e)}function Co(e,t){ie(e.alive,t)<0&&e.alive.push(t)}function ko(e,t){var n=ie(e.alive,t);n>=0&&e.alive.splice(n,1)}function Eo(e,t){var n=e.wm.concierge.cacheManager.getClientCache(ni,!0);return n&&n.left&&n.top&&n.initialElemData&&n.initialConfigData&&t.name!=ri&&(e.wm.isDragConfigDataEqualToCurrent(n.initialConfigData)?(e.wm.widgetAreaDragData.x=n.left,e.wm.widgetAreaDragData.y=n.top,e.wm.widgetAreaDragData.initialElemData=n.initialElemData,e.wm.widgetAreaDragData.draggedByUser=!0):e.wm.concierge.cacheManager.removeClientCache(ni,!0)),So(e,t)?j.resolve(null):(t.active=!0,e.active.push(t),or("widgetActivated",{widgetName:t.name}),_o(e))}function Oo(e,t){if(t.name!=ri){var n=ie(e.active,t);n>=0&&(t.active=!1,e.active.splice(n,1),_o(e))}else t.active=!1,e.active=e.active.filter((function(e){return e.name!=ri})),_o(e);0===e.active.length&&e.wm.concierge.cacheManager.removeClientCache(ni,!0)}function _o(e){var t=e.active.map((function(e){return{widgetName:e.name,loadParams:e.parameters}}));return e.wm.concierge.cacheManager.setClientCache("activeWidgets",t)}var Io=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.hasFinished=!1,this.autoOpen=!1,this.skipAnimation=!1,bn(this,i),this.parameters={},this.configuration=this.configuration||{},this.configuration.connectorUrl=n.serviceUrl.connector,xo(this,n)}return n(t,[{key:"handleMessage",value:function(e,t,n){return!1}},{key:"assignParameters",value:function(e){this.parameters=bn({},e)}},{key:"preferredSpotName",value:function(){return this.name}},{key:"getSpotName",value:function(){return this.spot}},{key:"getWidgetCodeName",value:function(){return this.name}},{key:"label",value:function(){var e=ya(this,"parameters","rule","name");return e?"".concat(this.name,":").concat(e):this.name}},{key:"checkAvailability",value:function(){return j.resolve({status:!0})}},{key:"shouldDisplayBell",value:function(){return!0}},{key:"beforeNotify",value:function(e){return j.resolve(To(e,!0))}},{key:"beforeAdd",value:function(e){return j.resolve(To(e,!0))}},{key:"getRemoteURL",value:function(){if(this.remoteURL)return this.remoteURL}},{key:"beforeLoad",value:function(){}},{key:"destroy",value:function(e){}},{key:"execute",value:function(e){return function(e,t){return e.concierge.cacheManager.removeWidgetCache(t.name,"widget-closed").then((function(){e.showWidget(t)}))}(e,this)}},{key:"getParametersForWidget",value:function(){return this.parameters}}]),t}();function xo(e,t){var n=t.widgetManager;e.priority=1,e.state=0,e.buttonEnabled=!0,e.hideWidget=function(){n.wmState.open===this&&n.hideWidget(!1)},e.closeWidget=function(){if(this.spot){var e=Xa(n.wmState,this.spot);this.hasFinished=!0,e.widget===this&&e.reactive&&e.reactive!==this&&oo(n.wmState,e.reactive)}},e.unload=function(){0!==this.state&&(n.widgetAreaForWidget(this.name).remove(),this.state=0)}}function To(e,t){return bn({},e,{status:t})}function Do(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Ao=function(t){X(r,t);var i=Do(r);function r(t,n,a,o){var s;return e(this,r),(s=i.call(this,t,n)).name=a,s.engagementHandler=o,s}return n(r,[{key:"customChannelName",value:function(){return this.parameters.customChannelName}},{key:"assignParameters",value:function(e){K($(r.prototype),"assignParameters",this).call(this,e),this.channelParams=Po(e,"customChannel:"),this.engagementHandler.init&&this.engagementHandler.init(this.channelParams)}},{key:"getParametersForWidget",value:function(){return this.channelParams}},{key:"beforeNotify",value:function(e){return qo({engagementType:this.name,parameters:this.channelParams},this.engagementHandler).then((function(t){return j.resolve(To(e,t.canShow))}))}},{key:"beforeAdd",value:function(e){return qo({engagementType:this.name,parameters:this.channelParams},this.engagementHandler).then((function(t){return j.resolve(To(e,t.canShow))}))}}]),r}(Io);function No(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Lo=function(t){X(r,t);var i=No(r);function r(t,n,a,o){return e(this,r),i.call(this,t,n,a,o)}return n(r,[{key:"shouldDisplayBell",value:function(){return!1}},{key:"preferredSpotName",value:function(){return null}},{key:"destroy",value:function(e){ko(e.wmState,this)}},{key:"execute",value:function(e){var t,n=(t=this.parameters,{engagementStarted:function(){we.debug("[CustomActions] Concierge Code: concierge internal logic fired for engagement started",{parameters:t})},engagementEnded:function(){we.debug("[CustomActions] Concierge Code: concierge internal logic fired for engagement ended",{parameters:t})}});return function(e,t,n){n?n.showEngagement(e,t):we.warn("[CustomActions] unable to find custom engagement type, ".concat(e.engagementType,". It must be registered with concierge before use."))}({engagementType:this.customChannelName(),parameters:this.channelParams},n,this.engagementHandler),j.resolve(null)}}]),r}(Ao);function Mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Wo=function(t){X(r,t);var i=Mo(r);function r(t,n,a,o){return e(this,r),i.call(this,t,n,a,o)}return n(r,[{key:"preferredSpotName",value:function(){return this.engagementHandler.preferredSpotName}},{key:"getWidgetCodeName",value:function(){return this.engagementHandler.managedWidgetName}},{key:"handleMessage",value:function(e,t,n){return!!this.engagementHandler.handleMessage(e,t,n)||K($(r.prototype),"handleMessage",this).call(this,e,t,n)}}]),r}(Ao);function Ro(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}function Po(e,t){return Object.keys(e).filter((function(e){return e.match(t)})).reduce((function(t,n){return t[n.split(":")[1]]=e[n],t}),{})}var Fo={},jo={};function Bo(e,t){if(!t||!t.showOffer)throw new Error("InvalidArgument: handler must have showOffer function");Fo[e]=t}function Vo(e,t){if(!t||!t.showEngagement)throw new Error("InvalidArgument: handler must have showEngagement function");jo[e]=t}function Ho(e){var t=void 0!==Fo[e];return t||we.warn("[CustomActions] unable to find custom offer type, ".concat(e,". It must be registered with concierge before use.")),t}function qo(e,t){return t?j.resolve(t.canShowEngagement?t.canShowEngagement(e):{canShow:!0}):(we.warn("[CustomActions] unable to find custom engagement type, ".concat(e.engagementType,". It must be registered with concierge before use.")),j.resolve({canShow:!1,code:0,reason:"Handler not registered with concierge."}))}function Uo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return wn(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function $o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Jo(e){this.siteRules=null,this.isTestMode=e.isTestMode,this.concierge=e,this.actionQueue=new va,this.rulesSucceeded={},this.categorySucceeded={},this.categorySucceeded[1]={},this.categorySucceeded[2]={},this.categorySucceeded[3]={},this.categorySucceeded[4]={},this.categorySucceeded[5]={},this.categorySucceeded[6]={}}Jo.prototype.ActionLibrary=ma,Jo.prototype.CriteriaLibrary=wa;var Go=function(e,t){return void 0===e?e:t?!e:e},zo=function(e,t,n){return e?[n,t]:[t,n]},Ko=function e(t,n,i){var r=i[0],a=i[2],o=i[5];if(1e3===r){for(var s=!0,c=0;c<a.length;c++)if(!e(t,n,a[c])){s=!1;break}return o?!s:s}if(1001===r){for(var u=!1,l=0;l<a.length;l++)if(e(t,n,a[l])){u=!0;break}return o?!u:u}var d,g,f,h,v=i[1],p=i[3],m=i[4];try{switch(v){case 21:g=Date.now();var y=H(zo(p,g,60*a*1e3),2);return f=y[0],h=y[1],d=li(f,ci(r,v),h),Go(d,o);case 19:g=t.conciergeItem("url");var w=H(zo(p,g,a),2);return f=w[0],h=w[1],d=li(f,ci(r,v),h),Go(d,o);case 20:g=t.conciergeItem("pageTitle");var b=H(zo(p,g,a),2);return f=b[0],h=b[1],d=li(f,ci(r,v),h),Go(d,o);case 1:return(g=t.visitorProfileGetTags())&&g.length?(d=-1!==g.indexOf(a),Go(d,o)):Go(!1,o);case 2:g=t.visitsToSite();var S=H(zo(p,g,a),2);return f=S[0],h=S[1],d=li(f,ci(r,v),h),Go(d,o);case 3:g=t.currentCartValue();var C=H(zo(p,g,a),2);return f=C[0],h=C[1],d=li(f,ci(r,v),h),Go(d,o);case 4:g=t.productsInCart(),d=!1;for(var k=0;k<g.length;k++){var E=g[k],O=ci(r,v),_=H(zo(p,a,E.name),2),I=_[0],x=_[1],T=H(zo(p,a,E.skuOrId),2),D=T[0],A=T[1],N=H(zo(p,a,E.sku_or_id),2),L=N[0],M=N[1];if(li(I,O,x)||"string"==typeof D&&"string"==typeof A&&li(D,O,A)||"string"==typeof L&&"string"==typeof M&&li(L,O,M)){d=!0;break}}return Go(d,o);case 5:g=t.userDeviceName();var W=H(zo(p,g,a),2);return f=W[0],h=W[1],d=li(f,ci(r,v),h),Go(d,o);case 7:g=t.secondsOnCurrentPage();var R=H(zo(p,g,a),2);return d=li(f=R[0],r,h=R[1]),Go(d,o);case 8:if(g=t.secondsFromLastVisit()){if(a>0){var P=H(zo(p,g,a),2);return f=P[0],h=P[1],d=li(f,ci(r,v),h),Go(d,o)}return!0}return!1;case 9:g=t.numberOfPagesVisited();var F=H(zo(p,g,a),2);return f=F[0],h=F[1],d=li(f,ci(r,v),h),Go(d,o);case 10:g=t.geographicLocationItem("city");var j=H(zo(p,g,a),2);return f=j[0],h=j[1],d=li(f,ci(r,v),h),Go(d,o);case 11:g=t.geographicLocationItem("state");var B=H(zo(p,g,a),2);return f=B[0],h=B[1],d=li(f,ci(r,v),h),Go(d,o);case 12:g=t.geographicLocationItem("country");var V=H(zo(p,g,a),2);return f=V[0],h=V[1],d=li(f,ci(r,v),h),Go(d,o);case 13:g=t.numberOfTimesPageViewed();var q=H(zo(p,g,a),2);return f=q[0],h=q[1],d=li(f,ci(r,v),h),Go(d,o);case 14:g=t.referralURL();var U=H(zo(p,g,a),2);return f=U[0],h=U[1],d=li(f,ci(r,v),h),Go(d,o);case 15:g=t.lastPageVisitedItem("url");var $=H(zo(p,g,a),2);return f=$[0],h=$[1],d=li(f,ci(r,v),h),Go(d,o);case 16:g=t.lastPageVisitedItem("title");var J=H(zo(p,g,a),2);return f=J[0],h=J[1],d=li(f,ci(r,v),h),Go(d,o);case 17:case 18:if((g=18===v?t.previouslyVisitedItems("title"):t.previouslyVisitedItems("url"))&&g.length){d=!1;for(var G=0;G<g.length;G++){var z=H(zo(p,g[G],a),2);if(f=z[0],h=z[1],li(f,ci(r,v),h)){d=!0;break}}return Go(d)}return!1;case 22:g=t.secondsOnSite();var K=H(zo(p,g,a),2);return f=K[0],h=K[1],d=li(f,ci(r,v),h),Go(d,o);case 1e3:return g=t.elementCount(m),Go(d=g>=1,o);case 1001:if(g=t.elementValue(m),ui(r=ci(r,v,a))&&isNaN(gn(g.value))&&(g.value="",g.text&&(isNaN(gn(g.text))||(g.value=g.text,delete g.text))),""!==g.value){var X=H(zo(p,g.value,a),2);if(!(d=li(f=X[0],r,h=X[1]))&&g.text){var Q=H(zo(p,g.text,a),2);d=li(f=Q[0],r,h=Q[1])}return Go(d,o)}return!1;case 1002:if(null==(g=t.customValue(m))||""===g)return!1;var Y=H(zo(p,g,a),2);return f=Y[0],h=Y[1],void 0!==(d=li(f,ci(r,v,a),h))&&Go(d,o);default:return we.error("Unknown Scope/Criteria input value:",v),!1}}catch(e){var Z=n[0];return we.error('Moxie Concierge Client: Scope/Criteria Eval Error ("'+Z+'" input:'+v+"): "+e.message),!1}},Xo=function(e,t){var n=t[3];return null===n||Ko(e,t,n)},Qo=function(e){var t=e[6];return{name:e[0],id:e[1],source:"offer",monitor:e[2],action:{success:e[5]},criteria:e[6],ruleArray:e,hasEvent:!!t}},Yo=function(e,t,n){var i=this,r=function(t){i.evalRule(e,!0)&&i.queueActions(e)};ie(n,"click")>=0&&this.eventListenerUnsubs.push(function(e,t,n){var i=t.selector,r=Je(i),a=vn(e,n,"none",[]);if(r.length>0)return te(r,Nt,pn,a),te(r,Nt,mn,a),un((function(){te(r,Lt,pn,a),te(r,Lt,mn,a)}));var o=Rt(Wt,pn,Bt(i),a,!0),s=Rt(Wt,mn,Bt(i),a,!0);return un((function(){Pt(Wt,pn,o),Pt(Wt,mn,s)}))}(e,{selector:t},r)),ie(n,"change")>=0&&this.eventListenerUnsubs.push(function(e,t,n,i,r){var a=t.selector,o=Je(a),s=vn(e,n,i,r);if(o.length>0)return te(o,Nt,yn,s),un((function(){te(o,Lt,yn,s)}));var c=Rt(Wt,yn,Bt(a),s,!0);return un((function(){Pt(Wt,yn,c)}))}(e,{selector:t},r,"none",[]))};function Zo(e,t){var n=e.getDataClone(Vn),i=n.session.visits.length-1,r=n.session.visits[i].journey.length-1;n.session.visits[i].journey[r].engagements||(n.session.visits[i].journey[r].engagements=[]),n.session.visits[i].journey[r].engagements.push(t),e.setData(Vn,JSON.stringify(n))}function es(e,t,n){for(var i=e.getData(Vn),r=i.session.visits[i.session.visits.length-1].journey,a=r.length-1,o=JSON.stringify(n),s=a;s>=0;s--){var c=r[s].engagements;if(c)for(var u=c.length-1;u>=0;u--){var l=c[u];if(l.id===t){if(JSON.stringify(l)===o)return j.resolve();if(n.dirty=!0,s===a)c[u]=n;else{c.splice(u,1),0===c.length&&delete r[s].engagements;var d=r[a];d.engagements?d.engagements.push(n):d.engagements=[n]}return e.setData(Vn,JSON.stringify(i))}}}return j.resolve()}function ts(e,t){for(var n=e.getDataObject(Vn),i=n.session.visits.length-1,r=0;r<n.session.visits[i].journey.length;r++)if(n.session.visits[i].journey[r].engagements)for(var a=0;a<n.session.visits[i].journey[r].engagements.length;a++)if(n.session.visits[i].journey[r].engagements[a].id===t)return fi(n.session.visits[i].journey[r].engagements[a]);return null}function ns(e,t){t=t||{},this.concierge=e,this.isValid=this.validateParams(t),this.config=t}function is(t,i,r){!function(t,i,r){Vo(i,r);var a=function(t){X(o,t);var a=Ro(o);function o(t,n){return e(this,o),a.call(this,t,n,i,r)}return n(o)}(Wo);a.actualName=r.managedWidgetName,t.widgetManager.simpleWidgets[i]=a}(t,i,new rs(r))}Jo.prototype.removeAllEventListeners=function(){var e,t=Uo(this.eventListenerUnsubs);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}},Jo.prototype.init=function(e){this.siteRules=e,this.actionLibrary=new ma(this.concierge),this.criteriaLibrary=new wa(this.concierge),this.bodyEventListeners={},this.ruleObjectsByIndex=[],this.eventListenerUnsubs=[];for(var t=0;t<this.siteRules.rules.length;t++){var n=this.siteRules.rules[t],i=Qo(n);if(Xo(this.criteriaLibrary,n)){this.ruleObjectsByIndex[t]=i;var r=n[6];if(r&&r.length)for(var a=0;a!==r.length;a++){var o=r[a],s=o[0],c=o[1];c&&c.length&&Yo.bind(this)(i,s,c)}}i.monitor&&!i.hasEvent&&this.concierge.contextMonitor.register(i)}},Jo.prototype.getSiteRules=function(){return this.siteRules||{}},Jo.prototype.getSiteSettings=function(){return this.siteRules.settings||{}},Jo.prototype.queueWaitTime=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.queue_wait_time>=0?this.siteRules.settings.queue_wait_time:5},Jo.prototype.minTimeBetween=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.min_time_between>=0?this.siteRules.settings.min_time_between:60},Jo.prototype.hideWhenServiceLineClosed=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.hide_on_demand_chat_when_service_line_is_closed},Jo.prototype.checkQueueWaitTimeForReactive=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.use_min_time_between_for_on_demand_chat},Jo.prototype.checkQueueWaitTimeForProactive=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.use_min_time_between_for_proactive_chat},Jo.prototype.run=function(){var e,t,n;for(e=[],t=0;t<this.siteRules.rules.length;t++){var i=this.siteRules.rules[t],r=Qo(i);n=this.evalRule(r),e.push({ruleset:r,success:n}),n&&ya(r,"action","success")&&this.queueActions(r)}return e},Jo.prototype.evalRule=function(e,t){if(t=!!t,e.hasEvent&&!t)return!1;var n=e.ruleArray,i=n[1];if(this.rulesSucceeded[i])return!1;var r=Xo(this.criteriaLibrary,n);return!!r&&(r=function(e,t){var n=t[4];return null===n||Ko(e,t,n)}(this.criteriaLibrary,n),!!r&&(n[5]&&(this.rulesSucceeded[i]=!0),!0))},Jo.prototype.isRedundantAction=function(e,t,n,i){return 4!==e&&5!==e&&(!i&&((!n||!n.length)&&(this.categorySucceeded[e][t]||this.categorySucceeded[2][t])))},Jo.prototype.isRemoveOk=function(e){return this.categorySucceeded[1][e]||this.categorySucceeded[3][e]},Jo.prototype.queueActions=function(e){var t,n,i,r,a,o,s,c=e.criteria,u=void 0!==e.monitorId||e.hasEvent,l=this.concierge.cacheManager.getDataClone(Vn),d=[1,3,4,5,6];if(e.action&&e.action.success)for(var g=0;g<e.action.success.length;g++)if(n=(t=e.action.success[g])[0],i=t[1],r=t[2],null!==i&&(r.widget=si(i)),!(this.isRedundantAction(n,i,c,u)||2===n&&this.isRemoveOk(i))){a=-1!==d.indexOf(n)&&function(t,n,i,r,a,o){return o.then((function(i){if(i&&i.status)if(1===n||3===n){var o=null;i.parameters&&(i.parameters.serviceLineId||i.parameters.channel_id)&&(o=i.parameters.serviceLineId||i.parameters.channel_id);var s=null;i.parameters&&i.parameters.widget&&(s=i.parameters.widget);var c="reactive";3===n&&(c="None"==i.parameters.offer_type?"none":"proactive"),nr(t,r,a,o,s,c)}else if(6==n)console.log("[CustomActions] postActionFunc: rule:",e);else if(4===n||5===n){tr(4===n,t,i.tags,r,a)}return null}))}.bind(void 0,this.concierge,n,l,e.id,g);try{var f=this.concierge.contextMonitor.parseMappedContext(r),h="customOffer"===f.offer_type,v=8===i,p=!0;h&&!Ho(f.customOfferName)&&(p=!1),!v||(o=f.customChannelName,s=void 0,(s=void 0!==jo[o])||we.warn("[CustomActions] unable to find custom channel type, ".concat(o,". It must be registered with concierge before use.")),s)||this.concierge.widgetManager.knownWidgets[f.customChannelName]||(p=!1),p&&(this.actionQueue.enqueue({label:e.name+":"+g+":"+n,func:this.actionLibrary[n],params:{rule:e,parameters:f,type:"success"},postAction:a}),this.categorySucceeded[n][i]=!0)}catch(t){we.log('Moxie Concierge Client: Action Function Error ("'+e.name+'" action:'+g+"): "+t.message)}}},ns.prototype.startEngagement=function(){if(!this.isValid)return we.log("GoMoxie.concierge.startTrackingEngagement: unable to start engagement that had an invalid configuration"),!1;var e=function(e){var t={chat:null,decision_type:"",email:null,id:wr(),kb:null,name:e.engagementType,proactive:!1,rule:{name:e.ruleName,source:Zn,id:-2,ruleAction:"success"},time:Date.now(),type:2};for(var n in e)"engagementType"!==n&&"ruleName"!==n&&oe(e,n)&&(t[n]=e[n]);return t}(this.config);return Zo(this.concierge.cacheManager,e),!0},ns.prototype.validateParams=function(e){var t,n;for(t in n=!0,"object"===i(e)&&e.engagementType&&e.ruleName||(we.log("GoMoxie.concierge.TrackingEngagement.validateParams: missing required configuration parameter"),n=!1),e)oe(e,t)&&"string"!=typeof e[t]&&(we.log("GoMoxie.concierge.TrackingEngagement.validateParams: invalid engagement parameter: "+t),n=!1);return n};var rs=function(){function t(n){e(this,t),this.managedWidgetName="kb-like",this.preferredSpotName=Ja,this.definition=n}return n(t,[{key:"init",value:function(e){this.definition.init&&this.definition.init(e)}},{key:"showEngagement",value:function(e,t){}},{key:"handleMessage",value:function(e,t,n){switch(n.type){case"articleSearch":return this.articleSearch(e,t,n);case"articleFetch":return this.articleFetch(e,t,n);case"onUrlClicked":return this.onUrlClicked(e,t,n);case"onArticleViewed":return this.onArticleViewed(e,t,n);default:return!1}}},{key:"articleSearch",value:function(e,t,n){return we.debug("[KbLike] articleSearch: query=".concat(n.parameters.query)),this.definition.search(n.parameters.query,n.parameters.limit).then((function(i){e.doPostMessage(t,{type:"articleSearchResponse",replyForMsgId:n.msgId,parameters:{searchId:i.searchId,results:i.results}})})).catch((function(e){we.error("[KbLike] articleSearch: Error",e)})),!0}},{key:"articleFetch",value:function(e,t,n){return we.debug("[KbLike] articleFetch: ".concat(n.parameters.articleId)),this.definition.fetchArticle(n.parameters.articleId).then((function(i){e.doPostMessage(t,{type:"articleFetchResponse",replyForMsgId:n.msgId,parameters:{articleContent:i}})})).catch((function(e){we.error("[KbLike] articleFetch: Error",e)})),!0}},{key:"onUrlClicked",value:function(e,t,n){we.debug("[KbLike] onUrlClicked: ",n.parameters.urlClickedData.href);var i=this.definition.onUrlClicked?this.definition.onUrlClicked(n.parameters.urlClickedData):{type:"nav-external"};return e.doPostMessage(t,{type:"onUrlClickedResponse",replyForMsgId:n.msgId,parameters:{urlClickedAction:i}}),!0}},{key:"onArticleViewed",value:function(e,t,n){return we.debug("[KbLike] onArticleViewed:",n.parameters.articleId),this.definition.onArticleViewed&&this.definition.onArticleViewed(n.parameters.articleId),!0}}]),t}();function as(t,i){i&&(i.conciergeV2=this,t.isTestMode&&(this.root=t)),this.broadcast=as.broadcast,this.transactionComplete=function(e){return t.ready.then((function(){var n,i,r,a;return n=t.cacheManager,(r=n.getDataClone(Vn)).last_updated=Date.now(),r.session.transaction_completed=!0,void 0!==e&&(r=sr(r,e,t),a=e.vendorTxnId),i=di(gi(r,1),1),t.contextMonitor.stop(),n.setData(Vn,JSON.stringify(r),!0).then((function(){return or("transactionCompleted",{transactionTotal:r.session.end_cart_value,cart:{value:i.current_cart_value,items:i.current_cart_items}}),Hi(t,r.session.end_cart_value,a),t.contextMonitor.initTracking().then((function(){t.contextMonitor.start()}))}))}))},this.updateSession=function(e){return t.ready.then((function(){var n,i;return e=e||{},i=sr((n=t.cacheManager).getDataClone(Vn),e,t),n.setData(Vn,JSON.stringify(i))}))},this.startEngagement=function(e){return t.ready.then((function(){var n=t.widgetManager;if(!e||"string"!=typeof e.widget)throw we.log("GoMoxie.concierge.startEngagement: missing required configuration parameter"),new Error("GoMoxie.concierge.startEngagement: missing required configuration parameter");if(cr(e.widget))return j.reject(new Error("The engagement type is not allowed: "+e.widget));if(!n.isValidEngagementConfig(e))throw we.log("GoMoxie.concierge.startEngagement: invalid widget configuration"),new Error("GoMoxie.concierge.startEngagement: invalid widget configuration");return n.startExternal(Zn,e)}))},this.closeNotification=function(e){return t.ready.then((function(){var n=t.widgetManager;return e?po(n.wmState):mo(n.wmState)}))},this.startTrackingEngagement=function(e){return t.ready.then((function(){new ns(t,e).startEngagement()}))},this.updatePage=function(e,n){var i=null;return t.ready.catch((function(){return!1})).then((function(){return t.eventService.clearHistoryStub||(i=t.eventService),t.rulesEngine.removeAllEventListeners(),t.contextMonitor.stop(),t.cacheManager&&t.cacheManager.cleanup(),t.widgetManager.destroy(),null})).then((function(){return t.prepare(e,n,{eventService:i}),t.init()})).then((function(){return function(e){delete e._clearingHistoryPromise}(t),null}))},this.clearHistory=function(){var e=t.loadState;if("READY"!==e&&"LOADING"!==e)return j.reject(new Error("Invalid State: "+e+". Can only be invoked in READY or LOADING states."));function n(){return t.loadState="CLEARING",Pr(t)}return t.loadState="CLEARING",("READY"===e?n():t.apiReady.then(n)).then((function(){return t.loadState="CLEARED",null}))};var r={},a=function(e){return e.status},o=function(e){return we.log("checkAvailability error thrown: "+e.message),!1};this.checkAvailability=function(e,n){return t.ready.then((function(){return"chat"===e&&void 0===n.portalId?t.rulesEngine.actionQueue.whenDone:"dfo-live"!==e||n.base_chat_service_url&&n.brand_id&&n.brand_hash?void 0:t.rulesEngine.actionQueue.whenDone})).then((function(){var i={parameters:n},s=t.widgetManager,c="availability";if("chat"===e){var u;if(s.engagementWidgets.widgets.chat&&(u=s.engagementWidgets.widgets.chat.portalId),void 0===n.portalId){if(!u)throw new Error("No Moxie portal/mailbox ID specified for engagement.");i.parameters.portalId=u}i.ruleSettings=t.rulesEngine.getSiteSettings(),c+="|"+n.portalId+"|"+s.device}var l=s.engagementWidgets.widgets[e];l||(l=s.createWidget(e));var d=Date.now(),g=r[c];return g&&g.timeout>d||(g={timeout:d+5e3,value:l.checkAvailability(i).then(a,o)},r[c]=g),g.value}))},this.customData=function(e){return t.ready.then((function(){var n=t.cacheManager,i=n.getDataClone(Vn);if(void 0===i)throw new Error("Could not find visitor profile.");if(void 0===e)return i.customData;if(!JSON.stringify(e))throw new Error("Could not stringify customData");return i.customData=e,n.setData(Vn,JSON.stringify(i)).then((function(){return e}))}))},this.channelsData=function(e){return t.ready.then((function(){var n=t.cacheManager;if(void 0===e)return n.getVolatileData(Un);return n.setVolatileData(Un,e).then((function(e){var n=t.widgetManager.findWidget(ri);return n&&n.setCaseCustomFields(),e}))}))},this.channelsFormData=function(e){return t.ready.then((function(){var n=t.cacheManager;return void 0===e?n.getVolatileData($n):n.setVolatileData($n,e)}))},this.onQuestionnaireLoaded=function(e){t.onQuestionnaireLoadedCallbacks.add(e)},this.onQuestionnaireSubmit=function(e){t.onQuestionnaireSubmitCallbacks.add(e)},this.registerKbLikeWidget=function(e,n){is(t,e,n)},this.engagementHandlers=jo,this.registerEngagementHandler=function(i,r){!function(t,i,r){Vo(i,r);var a=function(t){X(o,t);var a=Ro(o);function o(t,n){return e(this,o),a.call(this,t,n,i,r)}return n(o)}(Lo);t.widgetManager.simpleWidgets[i]=a}(t,i,r)},this.offerHandlers=Fo,this.registerOfferHandler=Bo}function os(){function e(e){return e.status}function t(e){return we.log("checkAvailability error thrown: "+e.message),"false"}this.broadcast=os.broadcast,this.transactionComplete=function(e,t){var n,i,r;return n=e.cacheManager,(r=n.getDataClone(Vn)).last_updated=Date.now(),r.session.transaction_completed=!0,void 0!==t&&(r=sr(r,t,e)),i=di(gi(r,1),1),e.contextMonitor.stop(),n.setData(Vn,JSON.stringify(r),!0).then((function(){return os.broadcast("transactionCompleted",{transactionTotal:r.session.end_cart_value,cart:{value:i.current_cart_value,items:i.current_cart_items}}),Hi(e,r.session.end_cart_value),ar(e,"transactionComplete"),e.contextMonitor.initTracking().then((function(){e.contextMonitor.start()}))}))},this.updateSession=function(e,t){var n,i;t=t||{},i=sr((n=e.cacheManager).getDataClone(Vn),t,e),n.setData(Vn,JSON.stringify(i))},this.startEngagement=function(e,t){var n,i,r={};if(i=e.widgetManager,t&&"string"==typeof t.widget){if(cr(t.widget))throw new Error("The engagement type is not allowed: "+t.widget);if(i.isValidEngagementConfig(t)){for(n in oe(t,"enableChatDeflection")&&!0===t.enableChatDeflection&&(t.widget="kbot"),t)oe(t,n)&&(r[n]=t[n]);var a,o={name:t.ruleName,source:Zn,id:-2,action:"success"};return r.rule=o,a=i.addWidget(t,o).then((function(e){!1!==i.openWidget&&i.openWidget!==t.widget&&i.hideWidget(!0),po(i.wmState),i.showWidget(e.ref),i.showConcierge(),i.widgetsType.openConcierge()})),ar(e,"startEngagement"),a}we.log("GoMoxie.concierge.startEngagement: invalid widget configuration")}else we.log("GoMoxie.concierge.startEngagement: missing required configuration parameter")},this.closeNotification=function(e,t){var n=e.widgetManager;return ar(e,"closeNotification"),t?po(n.wmState):mo(n.wmState)},this.startTrackingEngagement=function(e,t){new ns(e,t).startEngagement(),ar(e,"startTrackingEngagement")},this.updatePage=function(e,t,n){var i;return e.ready.catch((function(){return!1})).then((function(){return e.eventService.stub||(i=e.eventService),e.rulesEngine.removeAllEventListeners(),e.contextMonitor.stop(),e.cacheManager.cleanup(),e.widgetManager.destroy(),null})).then((function(){return ar(e,"updatePage"),e.init(t,n,{eventService:i})}))},this.checkAvailability=function(n,i,r,a){var o,s,c,u,l,d,g,f,h,v,p;if(o={parameters:r},s=n.cacheManager,c=n.widgetManager,f=r.portalId,u="availability",l="availability-timestamp","chat"===i){if(c.engagementWidgets.widgets.chat&&(g=c.engagementWidgets.widgets.chat.portalId),void 0===f){if(void 0===g)return void we.log("No Moxie portal/mailbox ID specified for engagement.");f=g,o.parameters.portalId=f}o.ruleSettings=n.rulesEngine.getSiteSettings(),u+="|"+f+"|"+c.device,l+="|"+f+"|"+c.device}return(d=c.engagementWidgets.widgets[i])||(d=c.createWidget(i)),v=1e5,(h=s.getWidgetCache(i,l,!1))&&(v=(Date.now()-h)/1e3),p=h&&v<=5&&s.getWidgetCache(i,u,!1)?j.resolve(s.getWidgetCache(u)):d.checkAvailability(o).then(e,t).then((function(e){return j.all([s.setWidgetCache(i,u,e,!1),s.setWidgetCache(i,l,Date.now(),!1)]).then((function(){return e}))})),ar(n,"checkAvailability"),p.then((function(e){return a(e),e}))},this.customData=function(e,t){var n,i;return i=(n=e.cacheManager).getDataClone(Vn),void 0===t?void 0!==i?i.customData:void 0:JSON.stringify(t)?(i.customData=t,n.setData(Vn,JSON.stringify(i)),!0):(ar(e,"customData"),!1)},this.channelsData=function(e,t){var n=e.cacheManager;if(void 0===t)return n.getVolatileData(Un);try{n.setVolatileData(Un,t)}catch(e){return we.log("channelsData: "+e),!1}return ar(e,"channelsData"),!0},this.channelsFormData=function(e,t){var n=e.cacheManager;if(void 0===t)return n.getVolatileData($n);try{n.setVolatileData($n,t)}catch(e){return we.log("Error: "+e),!1}return ar(e,"channelsFormData"),!0},this.onQuestionnaireLoaded=function(e,t){e.onQuestionnaireLoadedCallbacks.add(t)},this.onQuestionnaireSubmit=function(e,t){e.onQuestionnaireSubmitCallbacks.add(t)},this.registerMethods=function(e,t){void 0!==t&&void 0!==t.concierge&&(t.concierge.updateSession=this.updateSession.bind(void 0,e),t.concierge.transactionComplete=this.transactionComplete.bind(void 0,e),t.concierge.startEngagement=this.startEngagement.bind(void 0,e),t.concierge.checkAvailability=this.checkAvailability.bind(void 0,e),t.concierge.customData=this.customData.bind(void 0,e),t.concierge.closeNotification=this.closeNotification.bind(void 0,e),t.concierge.channelsData=this.channelsData.bind(void 0,e),t.concierge.channelsFormData=this.channelsFormData.bind(void 0,e),t.concierge.startTrackingEngagement=this.startTrackingEngagement.bind(void 0,e),t.concierge.onQuestionnaireLoaded=this.onQuestionnaireLoaded.bind(void 0,e),t.concierge.onQuestionnaireSubmit=this.onQuestionnaireSubmit.bind(void 0,e),t.concierge.updatePage=this.updatePage.bind(void 0,e),e.isTestMode&&(t.concierge.root=e))}}function ss(e){return e.signature="moxie_concierge",e}as.broadcast=or,os.broadcast=or;var cs=[" ","\n","\t"];function us(){this.outputRaw=[],this.outputSub=[],this.currentSub=null,this.state=1,this.compiled=[],this.actions=[]}function ls(e){var t=new us;return t.compile(e),function(e){return t.evaluate(e)}}us.prototype.compile=function(e){var t,n;for(t=0;t!==e.length;t++)switch(n=e[t],this.state){case 1:this.handleStateInput(n);break;case 2:this.handleStateOpen(n);break;case 4:this.handleStateSubOperator(n);break;case 3:this.handleStateSubInit(n);break;case 5:this.handleStateSub(n);break;case 6:this.handleStateSubFinal(n);break;case 7:this.handleStateClose(n)}var i=[],r=null;for(t=0;t!==this.outputRaw.length;t++)null===(n=this.outputRaw[t])?null!==r&&(i.push([r,t]),r=null):null===r&&(r=t);null!==r&&i.push([r,this.outputRaw.length]),this.outputSub.reduce((function(e,t){return null!==t&&e.push(t),e}),[]);var a=0;for(t=0;t!==i.length;t++){r=i[t][0];for(var o=i[t][1];a!==r;a++)this.actions.push(2),this.compiled.push(this.outputSub[a]);this.compiled.push(this.outputRaw.slice(r,o).join("")),a=o,this.actions.push(1)}this.outputRaw=null,this.outputSub=null},us.prototype.evaluate=function(e){for(var t,n=[],i=0;i!==this.actions.length;i++){switch(this.actions[i]){case 1:n.push(this.compiled[i]);break;case 2:null!=(t=e[this.compiled[i]])&&n.push(t)}}return n.join("")},us.prototype.handleStateInput=function(e){"<"===e?this.state=2:(this.outputRaw.push(e),this.outputSub.push(null))},us.prototype.handleStateOpen=function(e){"%"===e?this.state=4:(this.outputRaw.push("<"),this.outputRaw.push(e),this.outputSub.push(null),this.outputSub.push(null),this.state=1)},us.prototype.handleStateSubOperator=function(e){if("="!==e)throw new Error("Operator for the template must be '=', not '"+e+"'");this.state=3},us.prototype.handleStateSubInit=function(e){-1===cs.indexOf(e)&&(this.currentSub=[e],this.state=5)},us.prototype.handleStateSub=function(e){if(-1===cs.indexOf(e))return"%"===e?(this.finishSub(),void(this.state=7)):void this.currentSub.push(e);this.finishSub(),this.state=6},us.prototype.finishSub=function(){this.outputSub.push(this.currentSub.join("")),this.outputRaw.push(null),this.currentSub=null},us.prototype.handleStateSubFinal=function(e){if(-1===cs.indexOf(e)){if("%"!==e)throw new Error("Stray character '"+e+"' after substitution");this.state=7}},us.prototype.handleStateClose=function(e){if(">"!==e)throw new Error("Invalid sequence '"+e+"' after closing percent sign");this.state=1};var ds=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},gs=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},fs="_animations",hs=new(function(){function t(){e(this,t),this.duration=300,this.aniCount=0,this.frameCount=0,this.timeCount=0,this.animations={},this.frames={},this.timeouts={}}return n(t,[{key:"count",value:function(){return this.aniCount+this.frameCount+this.timeCount}},{key:"animationIds",value:function(){return Object.keys(this.animations)}},{key:"frameIds",value:function(){return Object.keys(this.frames)}},{key:"timeoutIds",value:function(){return Object.keys(this.timeouts)}}]),t}());function vs(e){!function(e,t){var n=Gt(e,fs);void 0===n?Jt(e,fs,[t]):n.push(t)}(e.element,e.id),hs.animations[e.id]=e,hs.aniCount+=1}function ps(e){hs.frames[e]&&(hs.frameCount-=1,delete hs.frames[e])}function ms(e){hs.timeouts[e]&&(hs.timeCount-=1,delete hs.timeouts[e])}function ys(e){var t;!function(e,t){var n=Gt(e,fs);if(void 0!==n){var i=n.indexOf(t);0===i?zt(e,fs):i>=0&&n.splice(i,1)}}(e.element,e.id),function(e){hs.animations[e.id]&&(delete hs.animations[e.id],hs.aniCount-=1)}(e),e.curAniFrame&&((t=e.curAniFrame)&&(ps(t),gs(t)),e.curAniFrame=!1),e.doneTimeout&&(ms(e.doneTimeout),window.clearTimeout(e.doneTimeout),e.doneTimeout=!1)}var ws=0,bs=function(){function t(n,i,r,a){e(this,t),ws+=1,this.id=ws,this.element=n,this.duration=i,this.doneHandler=r,this.label=a,this.startTime=null,this.doneTimeout=!1,this.curAniFrame=!1,this.animator=null,this.doneFunction=null}return n(t,[{key:"finish",value:function(){if(ys(this),this.animator){var e=Date.now();this.startTime=e-this.duration,this.animator(e)}}},{key:"done",value:function(){if(ys(this),this.doneHandler)try{this.doneHandler.call(this.element)}catch(e){we.error("ERROR in animation done handler",e)}}},{key:"cancel",value:function(){ys(this)}}]),t}();function Ss(e,t){var n=Gt(e,fs);if(n&&n.length){n=wn(n);for(var i=0;i<n.length;i++){var r=hs.animations[n[i]];r&&(t?r.done():r.cancel())}}zt(e,fs)}function Cs(e,t,n){var i,r=Ot(e),a={},o=["left","top"];for(var s in t)"auto"===r[s]&&-1!==o.indexOf(s)?(i||(i=Et(e)),a[s]=Number(Ct(s,i[s]))):a[s]=Number(Ct(s,r[s]));var c=(n=n||{}).duration||hs.duration,u=n.label||"css.animate",l=new bs(e,c,n.done,u);l.animator=function(e){this.curAniFrame=!1,this.startTime||(this.startTime=e);var n=e-this.startTime,i=n>=c?1:n/c,r={};for(var o in t){var s=Number(Ct(o,t[o]))-a[o];r[o]=St(o,a[o]+s*i)}Yt(this.element,r),n>=this.duration?this.done():this.curAniFrame=ks(this.animator,this.label)}.bind(l),c>0?(l.curAniFrame=ks(l.animator,l.label),l.doneTimeout=window.setTimeout(function(){ms(l.doneTimeout),l.doneTimeout=!1,ys(l);var e=Date.now();l.startTime=e-c,l.animator(e)}.bind(l),c),function(e,t){hs.timeCount+=1,hs.timeouts[e]=t||"unknown"}(l.doneTimeout,l.label),vs(l)):l.animator(Date.now())}function ks(e,t){var n=ds((function(t){ps(n),e(t)}));return function(e,t){hs.frameCount+=1,hs.frames[e]=t||"unknown"}(n,t),n}var Es=function(){function t(){e(this,t)}return n(t,[{key:"offerShown",value:function(e,t){e.concierge.currentOfferCreatedAt=Date.now(),Ui(e.concierge,t.name,t.parameters.rule)}}]),t}();function Os(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var _s=function(t){X(r,t);var i=Os(r);function r(){var t;return e(this,r),(t=i.call(this)).type="default",t}return n(r,[{key:"showNotification",value:function(e,t){e.showNotification(t),this.offerShown(e,t)}}]),r}(Es);function Is(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var xs=function(t){X(r,t);var i=Is(r);function r(t){var n;return e(this,r),(n=i.call(this)).type="custom",n.guideOffer={offerType:t.customOfferName,parameters:Po(t,"customOffer:")},n}return n(r,[{key:"showNotification",value:function(e,t){var n,i,r=this,a=t.parameters.rule,o=this.guideOffer.parameters,s=t.parameters.rule.action;this.offerCallbacks={offerShown:function(){r.offerShown(e,t),we.debug("[CustomActions] Concierge Code: concierge internal logic fired for offer shown.",{rule:a,parameters:o,actionType:s})},offerNotShown:function(){we.debug("[CustomActions] Concierge Code: concierge internal logic fired for offer NOT shown.",{rule:a,parameters:o,actionType:s})},offerAccepted:function(){we.debug("[CustomActions] Concierge Code: concierge internal logic fired for offer accepted.",{rule:a,parameters:o,actionType:s}),lo(e.wmState)},offerDeclined:function(){we.debug("[CustomActions] Concierge Code: concierge internal logic fired for offer declined.",{rule:a,parameters:o,actionType:s}),go(e.wmState)}},e.concierge.currentOfferCreatedAt=Date.now(),n=this.guideOffer,i=this.offerCallbacks,Ho(n.offerType)&&Fo[n.offerType].showOffer(n,i)}}]),r}(Es);function Ts(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Ds=function(t){X(r,t);var i=Ts(r);function r(){var t;return e(this,r),(t=i.call(this)).type="none",t}return n(r,[{key:"showNotification",value:function(e,t){lo(e.wmState)}}]),r}(Es),As="tab",Ns="tab-widgets",Ls="tab-widgets-content";var Ms=function(e){e.$notifAnimate&&(te(e.$notifAnimate,Ss,!0,!0),delete e.$notifAnimate),e.$areaAnimate&&(te(e.$areaAnimate,Ss,!0,!0),delete e.$areaAnimate)},Ws=function(e){return 0===e.tabStyle.cascade},Rs=function(e,t){var n=t.index();if(n<0)return 0;Ws(e)||(n=t.parent().children("li").length-(n+1));return n+1};function Ps(e,t,n){e&&(n.classList.remove("con-closed"),n.classList.add("con-open")),t&&(n.classList.remove("con-open"),n.classList.add("con-closed"))}function Fs(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"animate__";return new j((function(a){var o="".concat(r).concat(t),s=document.querySelector(e),c=document.getElementById("concierge");s.classList.add("".concat(r,"animated"),o),s.addEventListener("animationend",(function(e){e.stopPropagation(),s.classList.remove("".concat(r,"animated"),o),Ps(n,i,c),a("Animation ended")}),{once:!0})}))}var js=function(e){var t=e.widgetsType.getNotification();if(Ws(e)?Fs("#concierge-widgets-ul","fadeInDown",!0,!1):Fs("#concierge-widgets-ul","fadeInUp",!0,!1),io(e.wmState)){var n={},i=Ra(e.wmState.notification.spot),r=65*Rs(e,i);1===i.length&&(n[Ws(e)?"top":"bottom"]=r),ne(t,Cs,n,{label:"desktopNotificationSlideOpen",done:function(){delete self.$notifAnimate}}),self.$notifAnimate=t}},Bs=function(e){var t=e.widgetsType.getNotification();if(Ws(e)?Fs("#concierge-widgets-ul","fadeOutUp",!1,!0):Fs("#concierge-widgets-ul","fadeOutDown",!1,!0),e.widgetsType.notificationDisplayed){Ms(self);var n={};n[Ws(e)?"top":"bottom"]=0,ne(t,Cs,n,{label:"desktopNotificationSlideClosed"})}},Vs=function(e,t,n){var i=t.find(".con-notch"),r={},a=Rs(e,n);return r[Ws(e)?"top":"bottom"]=function(e,t){return Ma(e)?13:65*t+13}(e,a),e.state===Ls?(ne(i,Cs,r,{label:"adjustNotch"}),!1):(i.css(r),!0)},Hs=function(e){var t=e.$concierge;e.engagementWidgets.globalSettings.hideMoxieBranding&&t.addClass("hide-moxie")},qs=function(e,t,n){var r=e.$concierge.find("#concierge-widget-area");if(Vs(e,r,t)&&!n){r.hasClass("con-animating")?r.stop():r.css({opacity:0,right:50,display:"inline-block"}),Hs(e);var a={opacity:1};void 0!==e.widgetAreaDragData.x&&void 0!==e.widgetAreaDragData.y?(r.addClass(Ta),a.left=e.widgetAreaDragData.x,a.top=e.widgetAreaDragData.y):a.right=75,r.addClass("con-animating").addClass("con-open"),ne(r,Cs,a,{label:"desktopOpenArea",done:function(t,n){delete e.widgetsType.$areaAnimate,function(e,t){for(var n in t)Zt(e,t[n])}(r[0],["display","opacity","right"]),r.removeClass("con-animating"),n||"object"!==i(window.visualViewport)||e.widgetsType.applyKeyboardOffset(),e.widgetAreaDragData&&e.widgetAreaDragData.draggedByUser&&e.widgetAreaDragData.resizedWhileMinimized&&e.dragFixAfterResize()}})}e.state=Ls,e.widgetsType.$areaAnimate=r},Us=function(e,t){"object"===i(window.visualViewport)&&e.widgetsType.resetKeyboardOffset();var n=e.$concierge.find("#concierge-widget-area");e.state===Ls&&(n.hasClass("con-animating")?n.stop():n.css({opacity:1,right:75,display:"block"}),t.css({display:"block"}),n.addClass("con-animating").removeClass("con-open"),ne(n,Cs,{opacity:0,right:50,display:"none"},{label:"desktopCloseArea",done:function(){delete e.widgetsType.$areaAnimate,n.removeAttr("style"),n.removeClass("con-animating"),t.removeAttr("style")}}),e.state=Ns,e.widgetsType.$areaAnimate=n)},$s=function(e){e.$concierge.find("#concierge-widgets");var t=e.$concierge.find("#concierge-tab");e.state!==As||e.$concierge.hasClass("with-widgets")?e.state===Ls?(e.$concierge.find("#concierge-widget-area").removeClass("con-open"),t.removeClass("con-pressed"),t.attr("aria-expanded","false"),e.$concierge.removeClass("with-widgets"),Gs(e),e.state=As,Bs(e),e.$concierge.addClass("con-closed")):(t.removeClass("con-pressed"),t.attr("aria-expanded","false"),e.$concierge.removeClass("with-widgets"),e.state=As,Bs(e),e.$concierge.addClass("con-closed")):(e.$concierge.addClass("with-widgets").removeClass("con-closed"),t.addClass("con-pressed"),t.attr("aria-expanded","true"),e.state=Ns,js(e))};function Js(e){e.$concierge.find("#concierge-widgets");var t=e.$concierge.find("#concierge-tab");e.$concierge.addClass("with-widgets").removeClass("con-closed"),t.addClass("con-pressed"),t.attr("aria-expanded","true"),e.state=Ns,document.getElementById("concierge").classList.contains("with-widgets")||js(e)}var Gs=function(e){var t=e.$concierge.find("#concierge-widgets li.con-active");t.removeClass("con-active").removeClass("con-pressed"),t.find(".con-notch").remove(),t.find(".con-icon").attr("aria-expanded","false");var n=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active"),i=j.resolve(null);return e.openWidget&&(i=i.then((function(){return e.hideWidget(!1)}))),i.then((function(){return Us(e,n)}))},zs=function(e,t){var n=t.parameters,i=t.engagementId,r=Ra(t.spot);if(r.hasClass("con-active"))return e.openWidget&&e.openWidget!==t.name?e.hideWidget(!1):j.resolve(null);r.addClass("con-active").addClass("con-pressed"),r.find(".con-icon").attr("aria-expanded","true");var a=n.rule.source;return i&&"offer"!==a&&"notification"!==a&&"button"!==a&&(n.rule.source="internal"),t.execute(e)},Ks=function(){var e=cn(this);e.addClass("con-pressed"),e.data("pressing",1),"concierge-tab"===e.attr("id")&&e.attr("aria-expanded","true"),e.find(".con-icon")&&e.find(".con-icon").attr("aria-expanded","true")},Xs=function(){var e=cn(this);1===e.data("pressing")&&(e.data("pressing",0),e.removeClass("con-pressed"),e.find(".con-icon")&&e.find(".con-icon").attr("aria-expanded","false"),"concierge-tab"===e.attr("id")&&e.attr("aria-expanded","false"))},Qs=function(){return'<div id="concierge" class="con-right con-closed<%= CON_CLOSED %>">\n  <button id="concierge-tab" type="button" aria-label="<%= CONCIERGE %>" aria-expanded="false" aria-haspopup="true">\n    <%= CONCIERGE_TAB_ICON_SVG %>\n  </button>\n  <div id="concierge-widgets"><ul id="concierge-widgets-ul"<%= CON_ROLE_ATTRIBUTE %>></ul></div>\n  <div id="concierge-widget-area" tabindex="0" role="dialog" aria-live="assertive" aria-label=""><div class="con-notch"><div class="con-notch-inner"></div></div></div>\n\n  <div id="con-notification" class="con-inactive" role="alert" aria-live="assertive">\n  \x3c!--\n    CON-5221: Don\'t include (causes JAWS and NVDA to read twice):\n    aria-labelledby="con-notification-title" aria-describedby="con-notification-body"\n  --\x3e\n    <div class="con-notch"><div class="con-notch-inner"></div></div>\n    <h2 id="con-notification-title" class="concierge-notification-title" aria-hidden="true" tabindex="0">Live Chat</h2>\n    <div class="con-notification-content">\n      <div class="con-notification-icon" aria-live="off" aria-hidden="true"></div>\n      <div id="con-notification-body" aria-hidden="true">\n      \x3c!--\n        CON-5221: Don\'t include (causes JAWS to skip reading):\n        aria-live="polite" aria-atomic="true"\n      --\x3e\n        <div class="con-notification-body" tabindex="0"></div>\n        <div class="con-notification-helptext"><%=NOTIFICATION_ANNOUNCE%></div>\n      </div>\n      <div class="con-notification-calltoaction" role="link" tabindex="0"></div>\n    </div>\n    <button class="con-x" aria-label="<%= CLOSE_ICON %>">\n      <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20" stroke-width="0">\n        <title><%= CLOSE_ICON %></title>\n        <polygon points="17.3,1.1 10.2,8.3 3.1,1.1 1.3,2.9 8.4,10 1.3,17.1 3.1,18.9 10.2,11.8 17.3,18.9 19.1,17.1 11.9,10 19.1,2.9 "/>\n      </svg>\n    </button>\n  </div>\n</div>\n'};function Ys(e){this.html=Qs,this.cssType="desktop",this.notificationDisplayed=!1,this.visualViewportHasScroll=!1,this.visualViewportHasResize=!1;var t=this;this.start=function(){var n=e.$concierge.find("#concierge-tab"),i=e.$concierge.find("#concierge-widgets");n.on("mousedown",Ks),n.onPassive("touchstart",Ks),n.on("mouseleave",Xs);var o=function(i){("click"===i.type||Sa(i.which))&&("click"===i.type&&n.removeClass("highlight"),cn(this).removeClass("con-pressed").data("pressing",0).attr("aria-expanded","false"),Xi(e.concierge,!1),or("bellClicked",{}),t.toggleWindow())};n.on("click",o),n.on("keypress",o),n.on("keyup",(function(e){ba(e.which)?cn(this).addClass("highlight"):ka(e.which)?r(cn(this)):Ea(e.which)&&a(cn(this))})),n.on("blur",(function(){cn(this).removeClass("highlight")})),Rt(i,"mousedown",jt("li"),Ks),Rt(i,"touchstart",jt("li"),Ks,!0),Rt(i,"mouseleave",jt("li"),Xs);var s=function(t){("click"===t.type||Sa(t.which))&&(cn(this).removeClass("con-pressed").data("pressing",0),cn(this).find(".con-icon").attr("aria-expanded","false"),ur((function(){return function(e,t){var n=cn(t.target).closest("li"),i=n.data("spot"),r=so(e.wmState,i);if(r){if(r.buttonEnabled){var a=r.name,o=Na(a),s=r.parameters;return n.removeClass("highlight"),(s=s||{}).rule=s.rule||{},s.rule.source="button",ur((function(){return n.hasClass("con-active")?e.hideWidget(!1):zs(e,r)})).then((function(){return Xi(e.concierge,!0,a),or("buttonClicked",{buttonName:o}),null}))}}else we.log("DesktopWidgets: widgetsClicked: could not find widget for spot, "+i)}(e,t)})).catch((function(e){we.log((e.stack,e.stack))})))};Rt(i,"click",jt("li"),s),Rt(i,"keypress",jt("li"),s);var c=function(t){if("click"===t.type||Sa(t.which)||Ca(t.which)){var n=cn(t.target);n.hasClass("con-x")||n.closest(".con-x").length>0?po(e.wmState):vo(e.wmState)}};e.$concierge.find("#con-notification").on("click",c).on("keypress",c)},this.notificationAccepted=function(){var n=e.wmState.notification;n&&n.shouldDisplayBell()&&e.$concierge.hasClass("con-closed")&&(t.toggleWindow(),e.state=Ns)},this.toggleWindow=function(){$s.call(this,e)},this.openWidgetMenu=function(){Js.call(this,e)},this.focusWidgetButton=function(t){e.$concierge.find("#concierge-widgets li[data-widget="+t+"] .con-icon").focus()};function n(e,t,n){if(io(e.wmState)){n=n||{};var i=0,r=e.wmState.notification,a=Ra(r.spot);a.length>0&&!Ma(e)&&e.$concierge.hasClass("with-widgets")&&(i=65*Rs(e,a)),n[Ws(e)?"top":"bottom"]=i,t.css(n);var o=!0;if(r.spot){var s=Xa(e.wmState,r.spot);s.widget&&s.widget.preferredSpotName()===r.preferredSpotName()&&(o=!1)}o?function(e){e.addClass(Ta)}(t):function(e){e.removeClass(Ta)}(t)}}this.makeWidgetActive=function(e){e.addClass("con-active")},this.makeWidgetInactive=function(e){e.removeClass("con-active")},this.openWidget=function(t){var n=t.name,i=e.$concierge.find("#concierge-widget-area");!function(e,t){var n={kb:"K B Engagement Widget",chat:"Live Chat",kbot:"Live Chat",email:"Email Engagement Widget","cxone-expert":"CXone Expert Widget"}[e]||"";t.attr("aria-label",n)}(n,i);var r=e.widgetAreaForWidget(n),a=i.children(".concierge-widget.con-active").not(r);function o(){cn(this).removeAttr("style")}this.makeWidgetInactive(a),this.makeWidgetActive(r),e.$concierge.find("#concierge-widgets li.con-active").removeClass("con-active").removeClass("con-pressed"),e.$concierge.find("#concierge-widgets li.con-active .con-icon").attr("aria-expanded","false"),e.device===Nn&&r.find("iframe.widget-content").css({overflow:"auto"});var s=e.$concierge.find("#concierge-widgets li[data-widget="+n+"]");s.addClass("con-active").addClass("con-pressed"),s.find(".con-icon").attr("aria-expanded","true"),e.state===Ls&&a.length>0&&(we.log("openWidget(): invoked and willHide sent to already opened widget -"+a.data("widget")),Hs(e),e.postMessageToWidget(a.data("widget"),"willHide"),r.css({opacity:.3}),ne(r,Cs,{opacity:1},{label:"desktopOpenWidget",done:o}),a.css({display:"block",position:"absolute",top:2,height:"calc(100% - 4px)",width:"100%","padding-right":"4px",opacity:1,"z-index":100}),ne(a,Cs,{opacity:0},{label:"desktopCloseWidget",done:o}));var c=t.skipAnimation;qs(e,s,c)},this.closeWidgets=function(){e.$concierge.find("#concierge-widgets li.con-active").removeClass("con-active").removeClass("con-pressed"),e.$concierge.find("#concierge-widgets li.con-active .con-icon").attr("aria-expanded","false");var t=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active");this.makeWidgetInactive(t),t.removeAttr("style"),Us(e,t),e.$concierge.find("#concierge-widget-area").removeClass("con-open"),e.state=As},this.getNotification=function(){return e.$concierge.find("#con-notification")},this.getNotificationBody=function(){return e.$concierge.find("#con-notification-body")},this.getNotificationTitle=function(){return e.$concierge.find("#con-notification-title")},this.setAriaHidden=function(e){this.getNotificationBody().attr("aria-hidden",e),this.getNotificationTitle().attr("aria-hidden",e)},this.canDisplayNotification=function(){return!this.notificationDisplayed&&!e.$concierge.hasClass("con-open-widget")},this.maybeHandleOffset=function(){var t;0===e.tabStyle.verticalAnchor?t=window.visualViewport.offsetTop:(t=0,pt()&&(t=window.visualViewport.height-ht()+window.visualViewport.offsetTop,t=Math.min(t,0))),this.conciergePrevOffset!==t&&(this.conciergePrevOffset=t,this.conElem.style.transform="translateY("+t+"px) scale("+1/window.visualViewport.scale+")",e.dragResizeHandler())},this.viewportHandler=function(e){this.conElem&&this.maybeHandleOffset()},this.applyKeyboardOffset=function(){this.conElem=We("concierge"),window.visualViewport&&(this.visualViewportHasScroll||(this.visualViewportHasScroll=!0,Dt(window.visualViewport,"scroll",this.viewportHandler.bind(this))),this.visualViewportHasResize||(this.visualViewportHasResize=!0,Dt(window.visualViewport,"resize",this.viewportHandler.bind(this))))},this.resetKeyboardOffset=function(){this.conElem=null,window.visualViewport&&(this.visualViewportHasScroll&&(this.visualViewportHasScroll=!1,Lt(window.visualViewport,"scroll",this.viewportHandler.bind(this))),this.visualViewportHasResize&&(this.visualViewportHasResize=!1,Lt(window.visualViewport,"resize",this.viewportHandler.bind(this))))},this.updateNotification=function(){var t=this.getNotification();n(e,t,{})},this.displayNotification=function(){var t=this;this.notificationDisplayed=!0;var r=this.getNotification();r.addClass("con-active").removeClass("con-inactive"),this.setAriaHidden("false"),r.removeAttr("style");n(e,r,{opacity:0}),ne(r,Cs,{opacity:1},{label:"desktopShowNotification",done:function(e,n){delete t.$notifAnimate,n||"object"!==i(window.visualViewport)||t.applyKeyboardOffset()}}),t.$notifAnimate=r},this.closeNotification=function(){"object"===i(window.visualViewport)&&this.resetKeyboardOffset();var e=this;this.notificationDisplayed=!1;var t=this.getNotification();t&&(ne(t,Cs,{opacity:0},{label:"desktopHideNotification",done:function(){delete e.$notifAnimate,t.addClass("con-inactive").removeClass("con-active").removeAttr("style"),e.setAriaHidden("true")}}),e.$notifAnimate=t)},this.openConcierge=function(t){e.state!==Ls&&(e.state=Ns);var n=e.$concierge.find("#concierge-widgets");e.$concierge.addClass("with-widgets").removeClass("con-closed");var i=e.$concierge.find("#concierge-tab");if(i.addClass("con-pressed"),i.attr("aria-expanded","true"),n.addClass("con-visible"),t)return zs(e,t)};var r=function(t){if(!Ma(e)){var n=null;1===(n="concierge-tab"===t.attr("id")?cn("#concierge-widgets-ul li").last():t.prev()).length?(n.find(".con-icon").focus(),n.addClass("highlight")):cn("#concierge-tab").focus().addClass("highlight")}},a=function(t){if(!Ma(e)){var n=null;1===(n="concierge-tab"===t.attr("id")?cn("#concierge-widgets-ul li").first():t.next()).length?(n.find(".con-icon").focus(),n.addClass("highlight")):cn("#concierge-tab").focus().addClass("highlight")}};this.createWidgetElement=function(t){var n=Ma(e)?"":' role="menuitem"',i=e.concierge.getTranslation(Na(t.name),"title"),o="";t.buttonEnabled||(o="disabled");var s=cn('<li data-spot="'+t.spot+'" data-widget="'+t.name+'"'+n+'><button type="button" aria-expanded="false" class="con-icon" '+o+' aria-label="'+i+'">'+t.icon.svg+"</button></li>"),c=s.find("svg");c.length>0&&Pa(c[0]);var u=s.find(".con-icon");return u.on("keyup",(function(e){ba(e.which)?s.addClass("highlight"):ka(e.which)?r(s):Ea(e.which)&&a(s)})),u.on("blur",(function(){s.removeClass("highlight")})),s},this.updateWidgetElement=function(t){var n=Ra(t.spot);if(n.length>0){n.attr("data-widget",t.name);var i=e.concierge.getTranslation(Na(t.name),"title"),r=n.find("button");r.attr("aria-label",i),r.html(t.icon.svg);var a=n.find("svg");a.length>0&&Pa(a[0])}},this.addWidget=function(t){we.log("DesktopWidgets: addWidget:",t.name,t);var i=cn("#concierge-widgets ul"),r=this.createWidgetElement(t);return i.append(r[0]),Ha(e,Ws(e)),n(e,this.getNotification()),Ma(e)&&e.$concierge.removeClass("con-closed"),r};var o=function(t){var n={right:e.tabStyle.horizontalOffset,bottom:""},i=window.pageYOffset;0===e.tabStyle.verticalAnchor?n.top=e.tabStyle.verticalOffset+i:n.top=i+ht()-(e.tabStyle.verticalOffset+50),t.css(n)},s=function(t){var n={right:e.tabStyle.horizontalOffset};0===e.tabStyle.verticalAnchor?n.top=e.tabStyle.verticalOffset:n.bottom=e.tabStyle.verticalOffset,t.css(n)};this.fixPosition=function(e,t){"javascript"===e?(t.addClass("position-method-javascript"),we.log("Concierge Client: PositionMethod - Javascript"),this.scrollHandler||(this.scrollHandler=function(){o(t)},Dt(window,"scroll",this.scrollHandler)),o(t)):s(t)},this.beforeAppend=function(t){var n=[],i={right:e.tabStyle.horizontalOffset};s(t),Ws(e)?n.push("con-top"):n.push("con-bottom"),t.addClass(n.join(" ")),t.css(i)},this.destroy=function(){Ms(this),this.scrollHandler&&Lt(window,"scroll",this.scrollHandler),cn("#concierge-style-desktop").remove(),this.resetKeyboardOffset()}}function Zs(e){this.html=function(){return'<div id="concierge" class="con-right con-closed /DEVICE/">\n    <div id="concierge-backdrop"></div>\n    <button id="concierge-tab" type="button" aria-label="<%= CONCIERGE %>" aria-expanded="false">\n        <%= CONCIERGE_TAB_ICON_SVG %>\n    </button>\n    <div id="concierge-widgets">\n      <div class="con-widgets"><ul id="concierge-widgets-ul"<%= CON_ROLE_ATTRIBUTE %>></ul></div>\n      <div class="con-notch con-notch1"></div>\n      <div class="con-notch con-notch2"></div>\n    </div>\n    <div id="concierge-widget-area" role="dialog" aria-live="assertive" aria-label=""></div>\n\n    <div id="con-notification" role="alert" aria-live="assertive" class="con-inactive">\n    \x3c!--\n      CON-5221: Don\'t include (causes JAWS and NVDA to read twice):\n      aria-labelledby=" con-notification-title" aria-describedby="con-notification-body"\n    --\x3e\n      <h2 id="con-notification-title" class="concierge-notification-title" aria-hidden="true" tabindex="0">Notification</h2>\n      <div class="con-notification-content">\n        <div class="con-notification-icon" aria-live="off" aria-hidden="true"></div>\n        <div id="con-notification-body" class="con-notification-body" tabindex="0" aria-hidden="true"></div>\n        \x3c!--\n          CON-5221: Don\'t include (causes JAWS to skip reading):\n          aria-live="polite" aria-atomic="true"\n        --\x3e\n        <div class="con-notification-calltoaction" role="link" tabindex="0"></div>\n      </div>\n      <button class="con-x" aria-label="<%= CLOSE_ICON %>">\n        <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20" stroke-width="0">\n          <title><%= CLOSE_ICON %></title>\n          <polygon points="17.3,1.1 10.2,8.3 3.1,1.1 1.3,2.9 8.4,10 1.3,17.1 3.1,18.9 10.2,11.8 17.3,18.9 19.1,17.1 11.9,10 19.1,2.9 "/>\n        </svg>\n      </button>\n    </div>\n</div>\n'},this.cssType="mobile",this.openWidgetCount=0,this.bodyOrigStyle="",this.bodyOrigClasses="",this.htmlOrigStyle="",this.htmlOrigClasses="",this.start=function(){var t=this;navigator.userAgent.match(/instagram/i)&&navigator.userAgent.match(/iphone/i)&&(e.$concierge.addClass("instagram"),e.$concierge.find("#concierge-widget-area").css("height",window.innerHeight+"px")),window.addEventListener("scroll",(function(){window.clearTimeout(t.$delayedDOMUpdate),t.$delayedDOMUpdate=window.setTimeout((function(){we.debug("User scrolling stopped.");var e=document.getElementById("concierge-tab");if(e){var t=parseInt(getComputedStyle(e).getPropertyValue("z-index"));e.style["z-index"]="".concat(100001===t?t+1:100001)}}),50)}),!1),e.$concierge.find("#concierge-tab").onPassive("touchstart",(function(){cn(this).addClass("con-pressed").attr("aria-expanded","true"),function(e){var t=e.$concierge.find("#concierge-widgets");if(ec(e,t),Ma(e)){var n=Xa(e.wmState,"single").widget;we.log("widget "+n.name+" clicked");var r=Na(n.name);Xi(e.concierge,!0,n.name),or("buttonClicked",{buttonName:r}),n.parameters.rule.source="button",n.execute(e)}else!function(e){e.$concierge.hasClass("con-open")||!e.shouldDisplayBell?tc(e):function(e){var t=e.$concierge.find("#concierge-widgets");e.$concierge.find("#concierge-tab").attr("aria-expanded","true"),ec(e,t),t.data("animation","opening"),e.$concierge.removeClass("con-pressed").removeClass("con-closed");var n=t.attr("style");t.removeAttr("style");var r=t.height();"undefined"===i(n)||!1===n?t.css({overflow:"hidden",opacity:0,height:0}):t.attr("style",n);te(t,Cs,{height:r,opacity:1},{label:"mobileOpenMenu",done:function(){t.data("animation",!1),t.removeAttr("style"),e.$concierge.addClass("con-open")}})}(e)}(e)}(e)})).on("touchend",(function(){cn(this).removeClass("con-pressed")})),e.$concierge.onPassive("touchstart",".con-widgets li",(function(){cn(this).addClass("con-pressed"),cn(this).find(".con-icon").attr("aria-expanded","true")})).on("touchend",".con-widgets li",(function(){var t=cn(this);t.removeClass("con-pressed"),t.find(".con-icon");var n=t.data("spot"),i=so(e.wmState,n);if(i){var r=i.name;return i.parameters.rule.source="button",we.log("widget "+r+" clicked"),i.execute(e).then((function(){return Xi(e.concierge,!0,r),or("buttonClicked",{buttonName:Na(r)}),!1}))}we.log("MobileWidgets: widgetsClicked: could not find widget for spot, "+n)})),e.$concierge.find("#concierge-backdrop").on("click",(function(){mo(e.wmState),tc(e)}));var n=function(t){if("click"===t.type||Sa(t.which)||Ca(t.which)){var n=cn(t.target);n.hasClass("con-x")||n.closest(".con-x").length>0?po(e.wmState):vo(e.wmState)}};e.$concierge.find("#con-notification").on("click",n),e.$concierge.find("#con-notification").on("keypress",n);var r=!1;this.orientationListener=function(){if(t.notificationDisplayed){var e=t.getNotification();r&&clearTimeout(r),r=setTimeout((function(){r=!1,e.css({width:vt()})}),500)}},window.addEventListener("orientationchange",this.orientationListener)},this.notificationAccepted=function(){},this.focusWidgetButton=function(t){Ma(e)?e.$concierge.find("#concierge-tab").focus():e.$concierge.find("#concierge-widgets li[data-widget="+t+"]").focus()};this.addScrollFix=function(){var e=cn("html");this.htmlOrigStyle=e.attr("style"),this.htmlOrigClasses=e.attr("class"),e.attr("style",""),e.attr("class",""),e.addClass("concierge-modal-displayed");var t=cn("body");this.bodyOrigStyle=t.attr("style"),this.bodyOrigClasses=t.attr("class"),t.attr("style",""),t.attr("class",""),t.addClass("concierge-modal-displayed"),this.scrollFixApplied=!0},this.removeScrollFix=function(){if(this.scrollFixApplied){var e=cn("html");e.removeClass("concierge-modal-displayed"),e.attr("style",this.htmlOrigStyle),delete this.htmlOrigStyle,e.attr("class",this.htmlOrigClasses),delete this.htmlOrigClasses;var t=cn("body");t.removeClass("concierge-modal-displayed"),t.attr("style",this.bodyOrigStyle),delete this.bodyStyleRemoved,t.attr("class",this.bodyOrigClasses),delete this.bodyOrigClasses,cn("#concierge-widget-area").css({top:""}),delete this.scrollFixApplied}},this.makeWidgetActive=function(e){e.length>0&&(0===this.openWidgetCount&&this.addScrollFix(),e.addClass("con-active"),this.openWidgetCount+=e.length)},this.makeWidgetInactive=function(e){e.length>0&&(e.removeClass("con-active"),this.openWidgetCount-=e.length,0===this.openWidgetCount&&this.removeScrollFix())};this.openWidget=function(t){var n=t.name;!function(e,t){var n={kb:"K B Engagement Widget",chat:"Live Chat",kbot:"Live Chat",email:"Email Engagement Widget","cxone-expert":"CXone Expert Widget"}[e]||"";t.attr("aria-label",n)}(n,e.$concierge.find("#concierge-widget-area"));var i=e.widgetAreaForWidget(n),r=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active").not(i),a=this;this.makeWidgetActive(i),this.$widgetAnimating=i,function(e){var t=e.$concierge;e.engagementWidgets.globalSettings.hideMoxieBranding&&t.addClass("hide-moxie")}(e),i.attr("aria-expanded","true"),i.css({"z-index":1,opacity:0}),ne(i,Cs,{opacity:1},{label:"mobileOpenWidget",done:function(){delete a.$widgetAnimating,a.makeWidgetInactive(r),r.attr("aria-expanded","false"),i.removeAttr("style")}}),tc(e)},this.closeWidgets=function(){var t=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active"),n=this;t.css({opacity:1}),te(t,Cs,{opacity:0},{label:"mobileCloseWidgets",done:function(){we.log("close complete"),n.makeWidgetInactive(t),t.removeAttr("style").attr("aria-expanded","false")}})},this.getNotification=function(){return e.$concierge.find("#con-notification")},this.getNotificationBody=function(){return e.$concierge.find("#con-notification-body")},this.getNotificationTitle=function(){return e.$concierge.find("#con-notification-title")},this.setAriaHidden=function(e){this.getNotificationBody().attr("aria-hidden",e),this.getNotificationTitle().attr("aria-hidden",e)},this.canDisplayNotification=function(){return!this.notificationDisplayed&&!e.$concierge.hasClass("con-open-widget")},this.fixPosition=function(e,t){if("javascript"===e){t.addClass("position-method-javascript"),we.log("Concierge Client: PositionMethod - Javascript");var n=function(){var e=ht();t.css({top:e})};window.addEventListener("scroll",n),n()}};var t=!1,n=this;this.fixNotificationsUsingVisualViewport=function(){var e=We("con-notification");e&&(t=!1,e.style.transform="translateY("+window.visualViewport.offsetTop+"px) scale("+1/window.visualViewport.scale+")")},this.viewportHandler=function(){t||(t=!0,ks(n.fixNotificationsUsingVisualViewport,"mobileNotifScrollFix"))},this.applyNotificationKeyboardOffset=function(){window.visualViewport.addEventListener("scroll",this.viewportHandler),window.visualViewport.addEventListener("resize",this.viewportHandler),this.viewportHandler()},this.resetNotificationKeyboardOffset=function(){window.visualViewport.removeEventListener("scroll",this.viewportHandler),window.visualViewport.removeEventListener("resize",this.viewportHandler)},this.updateNotification=function(){},this.displayNotification=function(t){var n=this;this.notificationDisplayed=!0,we.log("opening notification.");var r=this.getNotification();r.data("parameters",t.parameters),r.addClass("con-active").removeClass("con-inactive"),this.setAriaHidden("false");var a="0px";e.engagementWidgets.globalSettings.notificationMobileVerticalOffset&&(a=e.engagementWidgets.globalSettings.notificationMobileVerticalOffset.toString()+"px"),n.$notifAnimating=r,r.css({top:"-150px"}),te(r,Cs,{top:a},{label:"mobileShowNotification",done:function(){n.$notifAnimating=!1;var e=vt();r.css({width:e}),"object"===i(window.visualViewport)&&n.applyNotificationKeyboardOffset()}})},this.closeNotification=function(){"object"===i(window.visualViewport)&&this.resetNotificationKeyboardOffset();var e=this;this.notificationDisplayed=!1;var t=this.getNotification();t&&te(t,Cs,{opacity:0},{label:"mobileHideNotification",done:function(){t.addClass("con-inactive").removeClass("con-active").removeAttr("style"),e.setAriaHidden("true")}})},this.openConcierge=function(){},this.destroy=function(){this.$notifAnimating&&(te(this.$notifAnimating,Ss,!0,!0),delete this.$notifAnimating),this.$widgetAnimating&&(te(this.$widgetAnimating,Ss,!0,!0),delete this.$widgetAnimating),this.orientationListener&&(window.removeEventListener("orientationchange",this.orientationListener),delete this.orientationListener),this.removeScrollFix(),cn("#concierge-style-mobile").remove(),window.clearTimeout(n.$delayedDOMUpdate)},this.createWidgetElement=function(t){var n=Ma(e)?"":' role="menuitem"',i=e.concierge.getTranslation(Na(t.name),"title");return cn('<li data-spot="'+t.spot+'" data-widget="'+t.name+'"'+n+'><button type="button" aria-expanded="false" class="con-icon" aria-label="'+i+'">'+t.icon.svg+'</button><span class="con-mobile-primary-menu">'+i+"</span></li>")},this.updateWidgetElement=function(t){var n=Ra(t.spot),i=n.find("button");if(Ma(e)){var r=cn("#concierge-tab");i.pushAll(r),n.pushAll(r)}n.attr("data-widget",t.name),n.attr("data-spot",t.spot);var a=e.concierge.getTranslation(Na(t.name),"title");n.find(".con-mobile-primary-menu").text(a),i.attr("aria-label",a),i.html(t.icon.svg);var o=i.find("svg");o.length>0&&Pa(o[0])},this.addWidget=function(t){we.log("MobileWidgets: addWidget:",t.name,t);var n=cn("#concierge-widgets ul"),i=this.createWidgetElement(t);if(n.append(i[0]),Ha(e,!0),Ma(e)){var r=cn("#concierge-tab");return r.html(t.icon.svg),r.attr("data-widget",t.name),r.attr("data-spot",t.spot),r}return i}}function ec(e,t){var n=t.data("animation");return n&&("opening"===n?(t.stop(),e.$concierge.addClass("con-open")):"closing"===n&&t.stop(),t.data("animation",!1)),n}function tc(e){var t=e.$concierge.find("#concierge-widgets");(e.$concierge.find("#concierge-tab").attr("aria-expanded","false"),e.$concierge.hasClass("con-closed"))||"closing"!==t.data("animation")&&(ec(e,t),t.data("animation","closing"),e.$concierge.removeClass("con-pressed").removeClass("con-open"),t.css({overflow:"hidden"}),te(t,Cs,{opacity:0,height:0},{label:"mobileCloseMenu",done:function(){t.data("animation",!1),t.removeAttr("style"),e.$concierge.addClass("con-closed")}}))}function nc(){}nc.prototype.markChat=function(e,t,n){var i=Date.now();return e.transient_data?(e.transient_data.vp_data.chat.session_id=Math.abs(parseInt(t)),"start"===n&&(e.transient_data.vp_data.chat.start_time=i),"end"===n&&(e.transient_data.vp_data.chat.end_time=i)):e.transient_data={vp_data:{chat:{session_id:t,start_time:i}}},we.log("Marking chat "+t+" as "+n),e};var ic,rc=Object.prototype.propertyIsEnumerable;function ac(e){if(null==e)throw new TypeError("Sources cannot be null or undefined");return Object(e)}function oc(e,t,n){var i=t[n];if(null!=i)if(oe(e,n)){if(void 0===e[n]||null===e[n])throw new TypeError("Cannot convert undefined or null to object ("+n+")");se(i)?e[n]=sc(Object(e[n]),i):e[n]=i}else se(i)?e[n]=sc(Object({}),i):e[n]=i}function sc(e,t){if(e===t)return e;for(var n in t=Object(t))oe(t,n)&&oc(e,t,n);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(t),r=0;r<i.length;r++)rc.call(t,i[r])&&oc(e,t,i[r]);return e}function cc(e){var t;return e.getAllResponseHeaders().indexOf("x-trace-id")>=0&&(t=e.getResponseHeader("x-trace-id")),t}function uc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var lc=function(t){X(r,t);var i=uc(r);function r(t,n){var a;return e(this,r),vc(Q(a=i.call(this,t,n)),t),function(e,t){var n=t.widgetManager,i=t.cacheManager;e.beforeAdd=function(e){var r,a,o=e.ref,s=e.parameters,c=gc(n.device),u=o.name,l=o.getEngagmentId(),d=o.getSuspendedSession(),g=o.getActiveSession();if(!e.ruleSettings)throw new Error("obj.ruleSettings is missing");return a=e.ruleSettings.skip_chat_queue_status_check?t.serviceUrl.connector+"/connector/channels/portal_with_service_line/"+s.portalId+"/device/"+c:t.serviceUrl.connector+"/connector/channels/portals_with_queue_status/"+s.portalId+"/device/"+c,t.httpGetXMLHttpRequest(a).then((function(a){var c,f=JSON.parse(a.responseText);if(s.traceId=cc(a),e.ruleSettings.skip_chat_queue_status_check)s.serviceLineId||(s.serviceLineId=f.response.serviceLineId,s.serviceLine=f.response.serviceLineName),t.serviceLines.setName(s.serviceLineId,s.serviceLine),c=f.response;else{if(s.serviceLineId||(s.serviceLineId=f.response.queueStatus.id,s.serviceLine=f.response.queueStatus.name),t.serviceLines.setName(s.serviceLineId,s.serviceLine),!f.response)throw new Error("status.response evaluates to false");var h=s.rule&&s.rule.source?s.rule.source:"internal";if(!_a(h)&&e.ruleSettings.hide_on_demand_chat_when_service_line_is_closed&&"true"!==f.response.queueStatus.queueopen)throw new Error("service line is closed");if(r="true"===f.response.queueStatus.slotavailable,!_a(h)&&e.ruleSettings.hide_on_demand_chat_when_no_available_agent_slots&&!r&&!d&&!g&&!e.engagementId)throw new Error("spot not available");qa(e.ruleSettings.check_queue_wait_time_for_on_demand_chat,ya(f,"response","queueStatus","holdtime"),e.ruleSettings.queue_wait_time,d,g),c=f.response.portalData}s.widgetpath=t.scriptLocationWithBrand+"/widgets/chat/"+t.assetVersion.widgets+"/",s.langOptions=t.langOptions;var v=0;c.deviceList.length>1&&(v=gc(n.device));var p="<%=host %>/netagent/cimlogin.aspx?questid=<%=questId %>&portid=<%=portalId %>&defaultStyleId=<%=styleId %>&widgetpath=<%=widgetpath %>&nareferer=<%=nareferer %>&flyout=1";p=ls(p)({host:s.host,questId:c.deviceList[v].questid,styleId:c.deviceList[v].styleid,portalId:c.deviceList[v].styleid,widgetpath:t.scriptLocationWithBrand+"/widgets/chat/"+t.assetVersion.widgets+"/",nareferer:encodeURIComponent(window.location.href)}),("string"==typeof o.remoteURL||o.remoteURL instanceof String)&&(o.remoteURL={}),o.portalId=s.portalId,o.remoteURL[s.portalId]=p,o.oldRemoteUrl=p,navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?o.remoteURL[s.portalId]+="&fullScreen=false":n.device!==Ln&&n.device!==Nn||(o.remoteURL[s.portalId]+="&fullScreen=true"),e.engagementId&&e.engagementId!==l&&(l=!1);var m=0!==n.notificationType;return s.questId=c.deviceList[v].questid,s.styleId=c.deviceList[v].styleid,o.shouldReplaceIframeSrc=!0,d&&l?(m&&n.widgetsType.closeNotification(),i.removeWidgetCache(u,"suspended_session",!0),void(o.autoOpen=!0)):n.loadingActiveWidgets&&g&&l?(o.origRemoteURL=o.remoteURL,o.oldRemoteUrl=o.remoteURL[s.portalId],o.remoteURL[s.portalId]=ls(g)({host:s.host,widgetpath:t.scriptLocationWithBrand+"/widgets/chat/"+t.assetVersion.widgets+"/"}),navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?o.remoteURL[s.portalId]+="&fullScreen=false":n.device!==Ln&&n.device!==Nn||(o.remoteURL[s.portalId]+="&fullScreen=true"),t.cacheManager.getWidgetCache(u,"widget-closed")||m?n.loadWidget(o):void(o.autoOpen=!0)):void 0})).then((function(){return e.status=!0,e}))},e.beforeNotify=function(i){var r=t.rulesEngine,a=gc(n.device),o=60;r.queueWaitTime&&(o=r.queueWaitTime());var s=i.rule,c=null;s&&s.id?c=s.id:we.log("Chat Widget:beforeNotify: rule id missing from obj:",i);var u=i.parameters,l=t.serviceUrl.connector+"/connector/channels/queue_status/"+u.portalId+"/device/"+a;return t.httpGetXMLHttpRequest(l).then((function(r){var a=JSON.parse(r.responseText);u.traceId=cc(r);var s=u.offer_type,l=a.response.id;if(u.serviceLineId=a.response.id,u.serviceLine=a.response.name,t.serviceLines.setName(u.serviceLineId,u.serviceLine),t.cacheManager.getWidgetCache(e.name,"suspended_session",!0))return i.status=!1,function(e,t){for(var n=e.getData(Vn),i=n.session.visits.length-1,r=0;r<n.session.visits[i].journey.length;r++)if(n.session.visits[i].journey[r].engagements)for(var a=0;a<n.session.visits[i].journey[r].engagements.length;a++)if(n.session.visits[i].journey[r].engagements[a].id===t)return n.session.visits[i].journey[r].engagements.splice(a,1),e.setData(Vn,JSON.stringify(n));return j.resolve()}(t.cacheManager,i.engagementId).then((function(){return i}));var d=parseInt(a.response.holdtime||"0",10);if("true"===a.response.slotavailable&&"true"===a.response.queueopen&&"true"===a.response.agentavailable&&d<o)i.status=!0;else{var g=function(e){e=ac(e);for(var t=1;t<arguments.length;t++)sc(e,arguments[t]);return e}({},n.getEngagementRecord(i.engagementId));"false"===a.response.queueopen?(g.chat.missed_reason=2,Ki(t,"service-line-closed",l,c,"None"==s?"none":"proactive",u.traceId)):d>=o?(g.chat.missed_reason=3,Ki(t,"wait-too-long",l,c,"None"==s?"none":"proactive",u.traceId)):"false"===a.response.agentavailable?(g.chat.missed_reason=1,Ki(t,"no-agent-available",l,c,"None"==s?"none":"proactive",u.traceId)):"true"!==a.response.slotavailable&&Ki(t,"no-agent-slots-available",l,c,"None"==s?"none":"proactive"),n.setEngagementRecord(i.engagementId,g),i.status=!1}return i}))},e.startNewSession=function(){var n=t.widgetManager,r=gc(n.device),a=t.serviceUrl.connector+"/connector/channels/queue_status/"+e.parameters.portalId+"/device/"+r;return t.httpGet(a).then((function(r){if(e.shouldReplaceIframeSrc){var a=e.getRemoteURL();"true"!==r.response.slotavailable&&(a=hc(i,e.oldRemoteUrl)),navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?a+="&fullScreen=false":n.device!==Ln&&n.device!==Nn||(a+="&fullScreen=true"),cn("#concierge-widget-chat .widget-content").attr("src",a)}else cn("#concierge-widget-chat iframe.widget-content").replaceWith('<iframe frameborder="no" class="widget-content" sandbox="allow-scripts allow-forms allow-same-origin allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-top-navigation-by-user-activation"></iframe>'),t.widgetManager.writeSrcToIframe(e.name)}))},e.checkAvailability=function(e){var i=e.parameters,r=gc(n.device);if(!e.ruleSettings)return j.resolve({status:!1});var a=t.serviceUrl.connector+"/connector/channels/queue_status/"+i.portalId+"/device/"+r;return t.httpGet(a).then((function(t){return t.response?e.ruleSettings.hide_on_demand_chat_when_service_line_is_closed&&"true"!==t.response.queueopen||e.ruleSettings.hide_on_demand_chat_when_no_available_agent_slots&&"true"!==t.response.slotavailable||e.ruleSettings.check_queue_wait_time_for_on_demand_chat&&parseInt(t.response.holdtime,10)>e.ruleSettings.queue_wait_time?{status:!1}:{status:!0}:{status:!1}})).catch((function(e){return we.log("checkAvailability error thrown: "+e),{status:!1}}))},e&&e.titleBar&&(e.titleBar.onclick=function(){n.hideWidget(!1),or("widgetMinimized",{widgetName:e.name})})}(Q(a),t),a}return n(r)}(Io),dc=(q(ic={},Ln,1),q(ic,Nn,2),q(ic,An,3),ic);function gc(e){var t=dc[e];return t||(t=0),t}var fc=function(e){return parseInt(e)};function hc(e,t){var n,r=e.getVolatileData(Un);if(function(e,t){if(e)for(var n=t.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");0===i&&((r=r[0].split("?"))[0]=r[1]),e&&oe(e,r[0])&&delete e[r[0]]}}(r,t),r){if("object"!==i(r))try{r=JSON.parse(r)}catch(e){we.log("Error parsing "+r+": err")}"object"===i(r)&&(n=r,0!==Object.keys(n).length)&&(t=t+"&"+function(e){for(var t=[],n=Object.keys(e),i=0;i<n.length;i++){var r=n[i];if(Array.isArray(e[r])){var a=e[r],o=void 0,s=[];for(o=0;o<a.length;o++)s.push(Ht(r+"[]")+"="+Ht(e[r][o]));t.push(s.join("&"))}else{var c=e[r];t.push(Ht(r)+"="+Ht(c))}}return t.join("&")}(r))}return t}function vc(e,t){var n=t.widgetManager,r=t.cacheManager;e.getEngagmentId=function(){return r.getWidgetCache(this.name,zn,!0)},e.getActiveSession=function(){return r.getWidgetCache(this.name,"active_session")},e.getSuspendedSession=function(){return r.getWidgetCache(this.name,"suspended_session",!0)},e.closeWidget=function(){},e.getRemoteURL=function(){var e,t=this.remoteURL,n=this.parameters.portalId;return e="object"===i(t)?t[n]:t,hc(r,e)},e.updateBroadcastPayload=function(e,n){if(this.parameters){var i=this.parameters;if(i.portalId&&(n.portalId=i.portalId),i.serviceLineId){var r=i.serviceLineId;return n.serviceLineId=r,t.serviceLines.getName(r).then((function(e){return n.serviceLine=e,n}))}}return j.resolve(n)},e.createNewIframe=function(e,t){var n=document.getElementById("concierge-widget-"+t);Ge(n.getElementsByTagName("iframe")[0]);var i=document.createElement("iframe");i.setAttribute("src",e),i.setAttribute("frameborder","no"),i.setAttribute("aria-live","polite"),i.setAttribute("aria-atomic","true"),i.classList.add("widget-content"),n.appendChild(i)},e.handleChannelsMessage=function(t,a){var o=this.name;switch(we.log("Event: "+t.call+" URL: "+t.url+" DATA: "+a.data),t.call){case"openSurvey":if(Si(t.url)){var s=function(e){if(!e)return"";var t=e.match(/(https?:\/\/)([^/:]+)/);return t?t[0]:""}(t.url);s&&s.length&&n.registerChatHost(s),n.handleBroadcast(o,"surveyLoaded",{sessionId:fc(n.concierge.cacheManager.getWidgetCache(o,"sessionId"))}),r.setWidgetCache(o,"surveyOpen",!0),n.widgetAreaIFrameForWidget(o).attr("src",t.url)}break;case"setReturnFromSurvey":n.handleBroadcast(o,"surveyCompleted",{sessionId:fc(n.concierge.cacheManager.getWidgetCache(o,"sessionId"))}),n.hideWidget(!1);break;case"setFlyoutContent":Si(t.url)&&e.createNewIframe(t.url,o);break;case"chatFocus":n.device===Nn&&"object"!==i(window.visualViewport)&&(n.makePositionAbsolute(),n.needsForceBlur=!0);break;case"chatBlur":break;case"getTabInfo":n.handleGetTabInfo(a,o);break;case"setChatInProgress":var c=parseInt(t.sessionId);0===t.sessionId&&n.device===Nn&&"object"!==i(window.visualViewport)&&(n.makePositionAbsolute(),n.needsForceBlur=!0),n.handleSetChatInProgress(c,o,this.parameters),c>0&&n.handleBroadcast(o,"chatSessionStarted",{sessionId:c})}},e.beforeLoad=function(){t.widgetManager.channelsWidget=this}}function pc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var mc=function(t){X(r,t);var i=pc(r);function r(t,n){var a;return e(this,r),(a=i.call(this,t,n)).baseHideWidget=a.hideWidget,a.hideWidget=function(){this.baseHideWidget(),this.closeWidget()},a}return n(r)}(Io);function yc(e,t,n,i,r,a,o,s){Object.defineProperty(this,"name",{value:t,enumerable:!0,writable:!1}),Object.defineProperty(this,"maxLength",{value:n,enumerable:!0,writable:!1}),Object.defineProperty(this,"required",{value:i,enumerable:!0,writable:!1}),Object.defineProperty(this,"label",{value:r,enumerable:!0,writable:!1}),Object.defineProperty(this,"type",{value:a,enumerable:!0,writable:!1}),Object.defineProperty(this,"defaultvalue",{value:o,enumerable:!0,writable:!1}),Object.defineProperty(this,"options",{value:s,enumerable:!0,writable:!1}),this.hide=e}function wc(){this.hide=!1,this.questions=[]}function bc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}yc.prototype.setAnswer=function(e){var t=void 0!==e.hide?e.hide:this.hide;if("16"===this.type||"15"===this.type||"4"===this.type||"6"===this.type){for(var n=0;n<this.options.length;n++)if(this.options[n].value===e.value){this.answer=e.value,this.hide=t;break}}else this.answer=e.value,this.hide=t},wc.prototype.getQuestionByName=function(e){for(var t=0;t<this.questions.length;t++)if(this.questions[t].name===e)return this.questions[t];return null},wc.prototype.loadQuestions=function(e){for(var t=0;t!==e.length;t++){var n=e[t],i=new yc(!1,n.formatParameters.elementname,n.formatParameters.elementmaxlength,n.formatParameters.elementrequired,n.actualquestion,n.type,n.formatParameters.elementdefaultvalue||n.formatParameters.elementchecked,n.options);"14"===i.type?i.answer="true"===n.formatParameters.elementchecked:i.answer=i.defaultvalue,this.questions.push(i)}},wc.load=function(e){var t=new wc;t.hide=!0===e.hide;for(var n=e.questions?e.questions.length:0,i=0;i<n;i++){var r=e.questions[i],a=new yc(r.hide,r.name,r.maxLength,r.required,r.label,r.type,r.defaultvalue,r.options);a.answer=r.answer,t.questions.push(a)}return void 0!==e.sendChatTranscript&&(t.sendChatTranscript=e.sendChatTranscript),t},wc.prototype.toJson=function(){return JSON.stringify(this)};var Sc=function(t){X(r,t);var i=bc(r);function r(t,n){var a;return e(this,r),vc(Q(a=i.call(this,t,n)),t),function(e,t){var n=t.widgetManager,i=t.cacheManager;e.preferredSpotName=function(){return $a},e.titleBar.onclick=function(){sessionStorage.getItem("kbot-disableTitleClick")||(n.hideWidget(!1),or("widgetMinimized",{widgetName:"kbot"}),i.setWidgetCache("kbot","shouldReopen",!1,!1))},e.sendSearchGuid=function(e,n){var r={chat_session_id:e},a=n.kbPortalId,o=i.getWidgetCache("kbot","search-guid",!1);if(a&&o&&e){var s=new XMLHttpRequest,c=t.serviceUrl.connector+"/connector/kb/suggestions/"+a+"/"+o;s.open("PUT",c,!0),s.setRequestHeader("Content-Type","application/json"),s.withCredentials=!1,s.onerror=function(){we.log("Received failure response from connector endpoint for kb search_guid")},s.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&(we.log("Sent to kb: "+JSON.stringify(r)),i.removeWidgetCache("kbot","search-guid",!1))},s.send(JSON.stringify(r))}},e.prepareToLoad=function(r){var a,o=r.parameters,s="questionnaire-"+r.parameters.questId,c=t.serviceUrl.connector+"/connector/channels/questionnaire/"+o.questId+"/"+o.styleId;return t.httpGetXMLHttpRequest(c).then((function(e){var n=JSON.parse(e.responseText);return r.parameters.parameters=n.response.parameters,r.parameters.traceId=cc(e),(a=new wc).loadQuestions(n.response.questions),t.onQuestionnaireLoadedCallbacks.doCallbacksAsync(a)})).then((function(){return i.setWidgetCache("kbot",s,a.toJson())})).then((function(){var t=i.storagePlugin.get("MoxieChat.chatInProgress",!0);return(t||i.getWidgetCache("kbot","shouldReopen",!1)&&"null"===t)&&(e.autoOpen=!0),e})).catch((function(t){return we.log("kbot failed in prepare to load:"+JSON.stringify(t)),n.removeWidget(e),null}))},e.shouldRebuildIframe=function(){var e=this.getActiveSession(),t=i.getWidgetCache(this.name,"rebuildIframe",!1),n=i.getWidgetCache(this.name,"surveyOpen",!1);return t&&!e&&!n},e.beforeAdd=function(r){var a,o,s=r.ref,c=r.parameters,u=gc(n.device),l=this.getEngagmentId(),d=this.getSuspendedSession(),g=this.getActiveSession(),f=i.getWidgetCache("kbot","active_kb_session");if(!r.ruleSettings)throw new Error("obj.ruleSettings is missing");return o=r.ruleSettings.skip_chat_queue_status_check?t.serviceUrl.connector+"/connector/channels/portal_with_service_line/"+c.portalId+"/device/"+u:t.serviceUrl.connector+"/connector/channels/queue_status/"+c.portalId+"/device/"+u,t.httpGetXMLHttpRequest(o).then((function(e){var n=JSON.parse(e.responseText);if(c.traceId=cc(e),r.ruleSettings.skip_chat_queue_status_check)c.serviceLineId||(c.serviceLineId=n.response.serviceLineId,c.serviceLine=n.response.serviceLineName),t.serviceLines.setName(c.serviceLineId,c.serviceLine);else{if(c.serviceLineId||(c.serviceLineId=n.response.id,c.serviceLine=n.response.name),t.serviceLines.setName(c.serviceLineId,c.serviceLine),c.serviceLineStatus={open:"true"===n.response.queueopen,slotAvailable:"true"===n.response.slotavailable},!n.response)throw new Error("status.response evaluates to false");if(!_a(c.rule.source)&&r.ruleSettings.hide_on_demand_chat_when_service_line_is_closed&&"true"!==n.response.queueopen)throw new Error("service line is closed");if(a="true"===n.response.slotavailable,!_a(c.rule.source)&&r.ruleSettings.hide_on_demand_chat_when_no_available_agent_slots&&!a&&!d&&!g&&!r.engagementId)throw new Error("slot not available");qa(r.ruleSettings.check_queue_wait_time_for_on_demand_chat,ya(n,"response","holdtime"),r.ruleSettings.queue_wait_time,d,g)}if(c.widgetpath=t.scriptLocationWithBrand+"/widgets/kbot/"+t.assetVersion.widgets+"/",c.langOptions=t.langOptions,r.ruleSettings.skip_chat_queue_status_check)return n;var i=t.serviceUrl.connector+"/connector/channels/portals/"+c.portalId;return t.httpGetXMLHttpRequest(i).then((function(e){var t=JSON.parse(e.responseText);return c.traceId=cc(e),t}))})).then((function(a){var o=0;a.response.deviceList.length>1&&(o=gc(n.device));var u="<%=host %>/netagent/cimlogin.aspx?questid=<%=questId %>&portid=<%=portalId %>&defaultStyleId=<%=styleId %>&widgetpath=<%=widgetpath %>&flyout=1";(!s.remoteURL||"string"==typeof s.remoteURL||s.remoteURL instanceof String)&&(s.remoteURL={}),s.portalId=c.portalId,s.remoteURL[c.portalId]=ls(u)({host:c.host,questId:a.response.deviceList[o].questid,styleId:a.response.deviceList[o].styleid,portalId:a.response.deviceList[o].styleid,widgetpath:t.scriptLocationWithBrand+"/widgets/kbot/"+t.assetVersion.widgets+"/"}),s.hashedQuestId=a.response.deviceList[o].questid,s.hashedPortalId=a.response.deviceList[o].styleid,navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?(c.fullScreen=!1,s.remoteURL[c.portalId]+="&fullScreen=false"):n.device!==Ln&&n.device!==Nn||(c.fullScreen=!0,s.remoteURL[c.portalId]+="&fullScreen=true"),r.engagementId&&r.engagementId!==l&&(l=!1);var d=0!==n.notificationType;if(c.questId=a.response.deviceList[o].questid,c.styleId=a.response.deviceList[o].styleid,i.getWidgetCache("kbot","suspended_session",!0)&&l)return d&&n.widgetsType.closeNotification(),e.shouldReplaceIframeSrc=!0,i.removeWidgetCache("kbot","suspended_session",!0),void(e.autoOpen=!0);var h=i.getWidgetCache("kbot","widget-closed");if(n.loadingActiveWidgets&&g&&l)return e.shouldReplaceIframeSrc=!0,s.origRemoteURL=s.remoteURL,s.oldRemoteUrl=s.remoteURL[c.portalId],s.remoteURL[c.portalId]=ls(g)({host:c.host,widgetpath:t.scriptLocationWithBrand+"/widgets/kbot/"+t.assetVersion.widgets+"/"}),h||d?n.loadWidget(e):void(e.autoOpen=!0);if(n.loadingActiveWidgets&&f&&l){var v=i.getWidgetCache("kbot","shouldReopen",!1);return h||d||!v?n.loadWidget(e):void(e.autoOpen=!0)}})).then((function(){return r.status=!0,r}))},e.beforeNotify=function(e){return j.resolve(To(e,!1))},e.startNewSession=function(){var e=t.widgetManager.createEngagementRecord(this,"kb");i.setWidgetCache("kbot",zn,e,!0),i.removeWidgetCache("kbot","active_session"),i.removeWidgetCache("kbot","surveyOpen"),cn("#concierge-widget-kbot iframe.widget-content").replaceWith('<iframe frameborder="no" class="widget-content" ></iframe>'),t.widgetManager.writeSrcToIframe("kbot"),delete this.shouldReplaceIframeSrc},e.createChatEngagementRecord=function(){var e=t.widgetManager.createEngagementRecord(this,"chat");return i.setWidgetCache("kbot",zn,e,!0),{id:e,data:t.widgetManager.getEngagementRecord(e)}}}(Q(a),t),a}return n(r)}(Io);function Cc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var kc=function(t){X(r,t);var i=Cc(r);function r(t,n){var a;return e(this,r),function(e,t){e.beforeAdd=function(n){if(n.parameters.langOptions=t.langOptions,!n.ruleSettings)throw new Error("obj.ruleSettings is missing");return e.parameters.ruleSettings=n.ruleSettings,n.status=!0,j.resolve(n)}}(Q(a=i.call(this,t,n)),t),a}return n(r)}(Io);function Ec(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Oc=function(t){X(r,t);var i=Ec(r);function r(t,n){var a;return e(this,r),function(e,t){e.preferredSpotName=function(){return Ja},e.beforeAdd=function(n){if(n.parameters.langOptions=t.langOptions,!n.ruleSettings)throw new Error("obj.ruleSettings is missing");return e.parameters.ruleSettings=n.ruleSettings,n.status=!0,j.resolve(n)}}(Q(a=i.call(this,t,n)),t),a}return n(r)}(Io);function _c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ic(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_c(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Tc=function(t){X(r,t);var i=xc(r);function r(t,n){var a;return e(this,r),function(e,t){var n=t.widgetManager,i=t.cacheManager,r=0,a=!1,o="";function s(e){if(!n.isMobile()){var t=n.tabStyle.verticalOffset+"px";brandembassy("setOffsetX",77+n.tabStyle.horizontalOffset);var i=We(Ac);if(!i)return;e?(Zt(i,"top"),Qt(i,"bottom",t=n.tabStyle.verticalOffset+3+"px")):(Qt(i,"top",t),Zt(i,"bottom"))}}e.skipAnimation=!0,e.preferredSpotName=function(){return $a},e.icon={svg:t.configuration.widgets.widgets.chat?t.configuration.widgets.widgets.chat.icon.svg:""},e.execute=function(t){return we.debug("DFO execute."),e.setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass(),e.showDFOWidget().then((function(){return we.debug("DFO execute: calling showWidget."),t.showWidget(e)}))},e.beforeNotify=function(n){return!Fc.params||Fc.params.brand_id==n.parameters.brand_id&&Fc.params.brand_hash==n.parameters.brand_hash?Fc.state===Pc&&r>0?(we.warn("DFO has already been loaded, cannot make offer."),j.resolve(Ic(Ic({},n),{},{status:!1}))):(Fc.lastWidgetParams=e.parameters,e.getChatStatus(n.parameters.base_chat_service_url,n.parameters.brand_id,n.parameters.brand_hash,t).then((function(r){var a;if(r!==ai){var o="None"===n.parameters.offer_type?"none":n.parameters.proactive;Ki(t,"service-line-closed",n.parameters.channel_id,n.parameters.rule.id,o),a=Ic(Ic({},n),{},{status:!1})}else{var s=i.getWidgetCache(e.name,Lc,!0);a=Ic(Ic({},n),{},{status:"false"!==s})}return a}))):(we.warn("DFO Parameters do not match already loaded brandembassy, cannot make offer"),j.resolve(Ic(Ic({},n),{},{status:!1})))},e.determineDFOState=function(t){if(we.debug("DFO determineDFOState. invoked."),"undefined"==typeof brandembassy)return e.addDFOToPage(t.parameters.brand_id,t.parameters.brand_hash,t.parameters.chat_file_url),t.status=!0,we.debug("DFO determineDFOState. finished. called add to page and return status=true"),j.resolve(t);var r=i.getWidgetCache(e.name,Lc,!0);return"false"!==r&&!1!==r&&null!==r||(we.debug("DFO determineDFOState. activate widget"),Eo(n.wmState,e),t.parameters.proactive?t.status=!1:t.status=!0),we.debug("DFO determineDFOState. finished. already added and return status",t.status),j.resolve(t)},e.beforeLoad=function(){we.debug("DFO beforeLoad. invoked."),e.setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass()},e.beforeAdd=function(a){if(we.debug("DFO beforeAdd invoked:",a),Fc.params&&(Fc.params.brand_id!=a.parameters.brand_id||Fc.params.brand_hash!=a.parameters.brand_hash))return we.warn("DFO Parameters do not match already loaded brandembassy, cannot add widget."),j.resolve(Ic(Ic({},a),{},{status:!1}));if(Fc.state===Pc&&r>0){if(!n.loadingActiveWidgets)return we.warn("DFO has already been loaded, so cannot add another."),j.resolve(Ic(Ic({},a),{},{status:!1}));we.debug("DFO beforeAdd existing brandembassy will be reconnected.")}return r+=1,e.addDFOToPage(a.parameters.brand_id,a.parameters.brand_hash,a.parameters.chat_file_url),e.setUpListenerForActiveChatRecovery(),"undefined"!=typeof brandembassy&&brandembassy("hideChatWindow"),Fc.lastWidgetParams=e.parameters,e.getChatStatus(a.parameters.base_chat_service_url,a.parameters.brand_id,a.parameters.brand_hash,t).then((function(r){if(r===ai){var o=!1;if(s||c||(o=!0),n.loadingActiveWidgets){var s=i.getWidgetCache(e.name,"widget-closed"),c=0!==n.notificationType;if(!o)return we.debug("DFO beforeAdd caling loadWidget:",a),n.loadWidget(e);e.autoOpen=!0}return Ic(Ic({},a),{},{status:o})}if(a.parameters.proactive){var u="None"===a.parameters.offer_type?"none":a.parameters.proactive;Ki(t,"service-line-closed",a.parameters.channel_id,a.parameters.rule.id,u)}throw new Error("There are No Agents")}))},e.destroy=function(){e.clearActiveSessionPoll(),e.observer&&(e.observer.disconnect(),delete e.observer),e.initObserver&&(e.initObserver.disconnect(),delete e.initObserver),e.addHiddenObserver&&(e.addHiddenObserver.disconnect(),delete e.addHiddenObserver),Lt(window,"message",e.processEventFromDFO)},e.getChatStatus=function(e,t,n,i){return i.httpGet("".concat(e,"/chat/1.0/brand/").concat(t,"/channel/").concat(n)).then((function(e){return e.availability.status})).catch((function(e){return we.warn(e),"offline"}))},e.checkAvailability=function(n){var i=bn({},n.parameters,e.parameters,Fc.lastWidgetParams),r=i.base_chat_service_url,a=i.brand_id,o=i.brand_hash;return e.getChatStatus(r,a,o,t).then((function(e){return{status:e===ai}}))},e.setCaseCustomFields=function(){return t.publicApiV2.channelsData().then((function(e){for(var t in e)brandembassy("setCaseCustomField",t,e[t])}))},e.injectCSS=function(){var e=n.engagementWidgets.conciergeTab.tabStyle.tabColor;brandembassy("setCustomCss",'\n        [data-selector="HEADER"] {background-color: '.concat(e,' !important;}\n        [data-selector="PRIMARY_BUTTON"][type="submit"] div {background-color: ').concat(e," !important;}"))},e.showDFOWidget=function(){if(we.debug("DFO showDFOWidget invoked."),!n.isMobile()){var t=We("concierge");Te(t,"con-open"),De(t,"con-closed");var r=We(ii);Te(r,Nc),Ce(r,"style"),De(r,"free-floating")}return i.setWidgetCache(e.name,Lc,!0,!0),n.showWidget(e).then((function(){})).then((function(){brandembassy("openChatWindow"),Eo(n.wmState,e),s(n.tabStyle.verticalAnchor)}))},e.handlePushUpdate=function(i){var r=i.data.case.id,a=e.parameters.channel_name,o=e.parameters.channel_id,s="closed"===i.data.case.status;switch(i.eventType){case"CaseCreated":Pi(t,!0,e.name,r,a,o),Eo(n.wmState,e),e.setupActiveSessionPolling();break;case"CaseInboxAssigneeChanged":s||(i.data.inboxAssignee&&Li(t,!0,e.name,i.data.inboxAssignee.id,"".concat(i.data.inboxAssignee.firstName," ").concat(i.data.inboxAssignee.surname),r,a,o,o),i.data.previousInboxAssignee&&Li(t,!1,e.name,i.data.previousInboxAssignee.id,"".concat(i.data.previousInboxAssignee.firstName," ").concat(i.data.previousInboxAssignee.surname),r,a,o,o));break;case"CaseStatusChanged":s&&(Pi(t,!1,e.name,r,a,o,o),Oo(n.wmState,e),e.clearActiveSessionPoll())}},e.addDFOToPage=function(t,n,i){we.debug("DFO addDFOToPage. invoked."),Fc.state===Wc&&(we.debug("DFO addDFOToPage. actually loading DFO."),Fc.state=Rc,Fc.params={brand_id:t,brand_hash:n},e.setUpBrandEmbassyObserver(),function(e,t,n,i,r,a,o,s){r=a?r+"?v="+a:r,e.BrandEmbassy=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=+new Date,o=t.createElement(n),s=t.getElementsByTagName(n)[0],o.async=1,o.src=r+"?"+Math.round(Date.now()/1e3/3600),s.parentNode.insertBefore(o,s)}(window,document,"script","brandembassy",i),brandembassy("init",parseInt(t),n),brandembassy("setAllowedExternalMessageTypes",["CHAT_SESSION_RECOVERED","MESSAGE_RECEIVED"]),brandembassy("onPushUpdate",Mc,(function(t){return e.handlePushUpdate(t)})),e.injectCSS(),e.setCaseCustomFields())},e.setUpBrandEmbassyObserver=function(){if(Fc.state===Rc)if(e.addHiddenObserver)we.debug("DFO setUpBrandEmbassyObserver was already setup.");else{we.debug("DFO setUpBrandEmbassyObserver. invoked.");var t=new MutationObserver((function(){var n=We(Dc);null!=n&&(we.debug("DFO setUpBrandEmbassyObserver. addHiddenObserver done."),Te(n,"be-hidden"),t.disconnect(),e.addHiddenObserver===t&&delete e.addHiddenObserver)}));e.addHiddenObserver=t,t.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}else we.debug("DFO setUpBrandEmbassyObserver skipping: is not in the loading state:",Fc.state)},e.setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass=function(){if(Fc.state!==Rc)return we.debug("DFO setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass skipping: is not in the loading state."),void e.addListenersForBEFrame();if(e.initObserver)we.debug("DFO setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass was already setup.");else{we.debug("DFO setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass. invoked.");var t=new MutationObserver((function(){var i=We(Dc);null!=i&&null!=We(Ac)&&(we.debug("DFO setUpBrandEmbassyObserverThatAlsoRemovesHiddenClass. initObserver done."),De(i,"be-hidden"),Te(i,"init"),Fc.state=Pc,e.addListenersForBEFrame(),s(n.tabStyle.verticalAnchor),t.disconnect(),e.initObserver===t&&delete e.initObserver)}));e.initObserver=t,t.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}},e.addListenersForBEFrame=function(){if(e.observer)we.debug("DFO addListenersForBEFrame skiping: observer already registered.");else{we.debug("DFO addListenersForBEFrame invoked");var t=We(Ac);t&&(xe(t,"be-frame-minimized")&&(we.debug("DFO addListenersForBEFrame: currently minimized, set minimized true"),i.setWidgetCache(ri,Lc,!0,!0)),e.observer=new MutationObserver(n),e.observer.observe(t,{attributes:!0,attributeFilter:["class"]}))}function n(){xe(t,"be-frame-minimized")?(we.debug("DFO addListenersForBEFrame: classChanged: multiWidgetLogic",t.classList),e.multipleWidgetLogic(),Fc.visible=!1):(we.debug("DFO addListenersForBEFrame: classChanged: set minimized false",t.classList),Fc.visible=!0,i.setWidgetCache(ri,Lc,"false",!0),Te(We(Dc),"init"))}},e.multipleWidgetLogic=function(){var t,r,a=!0,o=je(We("concierge-widgets-ul"),"li.con-active");(o.length>0&&(t=o[0],r=ri,be(t,"data-widget")!=r)&&(a=!1),a)&&(De(We(ii),Nc),n.hideWidget(),i.setWidgetCache(ri,Lc,!0,!0),brandembassy("hideChatWindow"),e.hasFinished=!0,null==brandembassy("getOngoingContact")&&Oo(n.wmState,e))},e.processEventFromDFO=function(t){if(t.isTrusted){var r=t.data.actionType,s=n.wmState;if("CHAT_SESSION_RECOVERED"!==r||a||t.origin!=window.location.origin){if("MESSAGE_RECEIVED"===r){if(!t.data||!t.data.action)return;var c=t.data.action;if(c.id===o)return;if(o=c.id,we.debug("DFO processEventFromDFO:",r),"outbound"!==c.direction)return;if("TEXT"!==c.messageType)return;if(to(s)||no(s))return;e.parameters.title=c&&c.author&&c.author.name||e.parameters&&e.parameters.title||e.name,e.parameters.icon=e.parameters&&e.parameters.icon||c&&c.author&&c.author.publicImage,e.parameters.message=c.message,e.parameters.notificationType=2,e.notificationType=2,n.showNotification(e)}}else{we.debug("DFO processEventFromDFO:",r);var u=t.data.action.session.status;"OPEN"===u||"ASSIGNING"===u?e.execute(n).then((function(){e.pollActiveSession(1),e.setupActiveSessionPolling()})).catch((function(e){we.warn(e)})):(i.setWidgetCache(ri,Lc,!0,!0),Oo(s,e)),we.debug("DFO removing message listener processEventFromDFO:"),a=!0}}},e.pollActiveSession=function(n){if("undefined"!=typeof brandembassy){var i=brandembassy("getOngoingContact");i?Mi(t,i.contact.id,n,e.name):e.clearActiveSessionPoll()}else e.clearActiveSessionPoll()},e.clearActiveSessionPoll=function(){e.activeSessionPolling&&(clearInterval(e.activeSessionPolling),delete e.activeSessionPolling)},e.setupActiveSessionPolling=function(){e.activeSessionPolling||(e.activeSessionPolling=setInterval((function(){e.pollActiveSession(2)}),6e4))},e.setUpListenerForActiveChatRecovery=function(){Dt(window,"message",e.processEventFromDFO)}}(Q(a=i.call(this,t,n)),t),a}return n(r)}(Io),Dc="be-chat-container",Ac="be-frame",Nc="be-guide-frame",Lc="minimized",Mc=["CaseCreated","CaseInboxAssigneeChanged","CaseStatusChanged"],Wc="unloaded",Rc="loading",Pc="loaded",Fc={state:Wc,params:null,visible:!1,lastWidgetParams:{}};function jc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Bc=function(t){X(r,t);var i=jc(r);function r(t,n){var a;return e(this,r),function(e,t){e.name="bell",e.priority=0,e.buttonEnabled=!1,e.icon=ya(t,"widgetManager","engagementWidgets","conciergeTab","icon"),e.preferredSpotName=function(){return"bell"},e.execute=function(e){return j.resolve(null)}}(Q(a=i.call(this,t,n)),t),a}return n(r)}(Io);function Vc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=$(e);if(t){var r=$(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Y(this,n)}}var Hc=function(t){X(r,t);var i=Vc(r);function r(t,n){var a;return e(this,r),(a=i.call(this,t,n)).engagement_type=5,function(e,t){var n=t.widgetManager;e.priority=0,e.shouldDisplayBell=function(){return!1},e.preferredSpotName=function(){return null},e.beforeAdd=function(e){if(Ma(n)){var i=n.wmState;if(null===i.spots.single.widget)return yo(i,new Bc(t,{rule:{source:"internal"},parameters:{}})).then((function(t){return To(e,t.status)}))}return j.resolve(To(e,!0))},e.execute=function(n){var i=this;if(!i.isExecuting){var r=this.parameters;return i.isExecuting=!0,"_blank"===r.linkStrategy?(qc(t,r),Co(n.wmState,e),i._openTimeout=setTimeout((function(){i.isExecuting=!1,ko(n.wmState,e),delete i._openTimeout}),1e3),window.open(r.url,r.linkStrategy,"noopener")):t.logDisabled?window.open(r.url,r.linkStrategy,"noopener"):(window.addEventListener("GoMoxie:PriorityEvents",(function(){window.open(r.url,r.linkStrategy,"noopener")}),!1),Co(n.wmState,e),this._openTimeout=setTimeout((function(){delete i._openTimeout,window.open(r.url,r.linkStrategy,"noopener")}),3e3),qc(t,r)),j.resolve(null)}},e.destroy=function(t){ko(t.wmState,e),this._openTimeout&&clearTimeout(this._openTimeout)}}(Q(a),t),a}return n(r)}(Io);function qc(e,t){or("linkFollowed",{strategy:t.linkStrategy,url:t.url}),ir(e,t.url,t.linkStrategy,t.rule.id)}function Uc(e){e.bridgeListener=$c.bind(e),window.addEventListener("message",e.bridgeListener,!1)}function $c(e,t){var n=zc,r=!1;null!=t&&(n=t.doPostMessage,r=!0);var a=this;window.test_concierge&&(a=window.test_concierge.widgetManager);var o,s=a.concierge,c=s.cacheManager,u=a.wmState;if("string"==typeof e.data&&"SessionCleared"!==e.data)try{o=JSON.parse(e.data)}catch(t){return we.log("WidgetBridge received invalid JSON: ",t),void we.log("Payload was:"+e.data)}else e.data.messageType&&(e.data.type=e.data.messageType),o=e.data;if(o&&o.call&&a.channelsWidget&&Gc(s,e))a.channelsWidget.handleChannelsMessage(o,e);else{var l=o.widget;if(l){var d=a.engagementWidgets.widgets[l];if(!d){if(!Aa(l)||!a.channelsWidget)return void we.error("WidgetBridge received message for unregistered widget: "+JSON.stringify(o));l=(d=a.channelsWidget).name}var g=d.parameters;if(Gc(s,e)){var f,h=e.data,v=e.data.parameters;if(we.log("["+h.type+"] message accepted from: "+e.origin),!r&&"_multi"===h.type)return f=Kc(a,l,e,h,v),void n(e,f);var p={doPostMessage:n};if(!d.handleMessage(p,e,h)){f={};var m=null,y=null;switch(h.type){case"focusEvent":a.device===Nn&&"object"!==i(window.visualViewport)&&(a.makePositionAbsolute(),a.needsForceBlur=!0);break;case"getChatStore":null!=c.storagePlugin.get("MoxieChat",!0)?c.storagePlugin.get("MoxieChat",!0):c.storagePlugin.set("MoxieChat",{},!0),f={type:"getChatStoreResponse",replyForMsgId:h.msgId,parameters:{data:c.storagePlugin.get("MoxieChat",!0)}},n(e,f);break;case"blurEvent":a.device===Nn&&"object"!==i(window.visualViewport)&&(a.needsForceBlur=!1);break;case"resetConcierge":Fa(a,!0),a.removeWidget(d,!0),a.addWidget(d.parameters,d.parameters.rule);break;case"getVisitorProfile":m=Vn,f={type:"getVisitorProfileResponse",replyForMsgId:h.msgId,parameters:{data:c.getData(m)}},n(e,f);break;case"setVisitorProfile":m=Vn,c.setData(m,JSON.stringify(v.data));break;case"getEngagementRecord":y=c.getWidgetCache(l,zn,!0),f={type:"getEngagementRecordResponse",replyForMsgId:h.msgId,parameters:{id:y,data:ts(c,y)}},n(e,f);break;case"onQuestionnaireSubmit":f={type:"onQuestionnaireSubmitResponse",replyForMsgId:h.msgId},s.onQuestionnaireSubmitCallbacks?s.onQuestionnaireSubmitCallbacks.doCallbacksAsync(wc.load(v.data)).then((function(t){f.parameters=t.toJson(),n(e,f)})):(f.parameters=JSON.stringify(v),n(e,f));break;case"getParameters":f={type:"getParametersResponse",replyForMsgId:h.msgId,parameters:{data:g}},n(e,f);break;case"setEngagementRecord":y=c.getWidgetCache(l,zn,!0),es(c,y,v.data);break;case"createEngagementRecord":y=a.createEngagementRecord(d),c.setWidgetCache(l,zn,y,!0),f={type:"createEngagementRecordResponse",replyForMsgId:h.msgId,parameters:{id:y,data:a.getEngagementRecord(y)}},n(e,f);break;case"getWidgetInitData":f={type:"getWidgetInitDataResponse",replyForMsgId:h.msgId,parameters:{data:{clientHref:window.location.href,parameters:d.getParametersForWidget(),configuration:d.configuration,translation:s.localization.data}}},n(e,f);break;case"getConfiguration":f={type:"getConfigurationResponse",replyForMsgId:h.msgId,parameters:{data:d.configuration}},n(e,f);break;case"getCache":f={type:"getCacheResponse",replyForMsgId:h.msgId,parameters:{key:v.key,value:c.getWidgetCache(l,v.key,v.persist)}},n(e,f);break;case"getCacheData":f={type:"getCacheDataResponse",replyForMsgId:h.msgId,parameters:{key:v.key,value:c.getData(v.key)}},n(e,f);break;case"getTranslation":f={type:"getTranslationResponse",replyForMsgId:h.msgId,parameters:{value:s.localization.data}},n(e,f);break;case"getOtherCache":f={type:"getOtherCacheResponse",replyForMsgId:h.msgId,parameters:{key:v.key,value:c.getWidgetCache(l,v.key,v.persist)}},n(e,f);break;case"getWidgetPath":var w=c.getWidgetCache("chat","widgetpath",!0);w||(w=c.getWidgetCache("kbot","widgetpath",!0)),f={type:"getWidgetPathResponse",replyForMsgId:h.msgId,parameters:{key:"widgetpath",value:w}},n(e,f);break;case"setCache":c.setWidgetCache(l,v.key,v.value,v.persist);break;case"setStoreCache":c.storagePlugin.set(v.key,v.value,!0);break;case"removeStoreCache":c.storagePlugin.del(v.key,v.persist),f={type:"removeStoreCacheResponse",replyForMsgId:h.msgId,parameters:{data:"clearedStore"}},n(e,f);break;case"removeCache":c.removeWidgetCache(l,v.key,v.persist);break;case"notificationMessage":if(to(u)||no(u))return;v.title&&(v.title=s.getTranslation(Na(l),v.title)),d.parameters.title=v.title,d.parameters.message=v.message,d.parameters.icon=v.icon,d.parameters.callToAction=v.callToAction,d.parameters.notificationType=2,d.notificationType=2,a.showNotification(d);break;case"updateWidgetTitle":a.updateWidgetTitle(l,v);break;case"updateTabText":cn("#concierge .con_tab_text").text(v.text);break;case"hideWidget":d.hideWidget();break;case"setServiceLineId":a.setServiceLineId(v,l);break;case"setActive":v.active?Eo(u,d):Oo(u,d);break;case"handleClose":c.setWidgetCache(l,"willHandleClose",v.value,!0);break;case"callFunction":f={type:"callFunctionResponse",replyForMsgId:h.msgId,parameters:{}},d[v.funcName]&&(f.parameters.result=d[v.funcName](v.funcArgs)),f.parameters&&f.parameters.result&&n(e,f);break;case"broadcast":a.handleBroadcast(l,v.eventType,v.data)}}}}}}function Jc(e){if(!e)return"";var t=e.match(/(https?:\/\/)([^/]+)/);return t?t[2]:""}function Gc(e,t){var n=window.location.hostname,i=(e.cacheManager.getClientCache("channelsHosts",!0)||[]).map((function(e){return Jc(e)})),r=Jc(e.scriptLocation),a=Jc(t.origin),o=[n,r].concat(i);if(!a||o.every((function(e){return a!==e}))){var s=['The domain "',document.domain,'" ','rejected message from un-trusted domain: "',a,'"'].join("");return e.isTestMode&&we.log(s),!1}return!0}var zc=function(e,t){e&&e.source&&e.source.postMessage(ss(t),e.origin)},Kc=function(e,t,n,i,r){var a=[],o=[],s={doPostMessage:function(e,t){a.push(t)}};return r.calls.forEach((function(i){i.parameters.signature=r.signature,i.parameters.widget=t,i.widget=t;var c=a.length,u=!1;try{e.bridgeListener({data:i,origin:n.origin},s)}catch(e){u=!0,a.push(null),o.push(e.name)}u||(o.push(null),a.length===c&&a.push(null))})),{type:"_multiResponse",replyForMsgId:i.msgId,parameters:{success:a,failure:o}}},Xc={exports:{}};
/*!
   * displacejs.js 1.3.2 - Tiny javascript library to create moveable DOM elements.
   * Copyright (c) 2019 Catalin Covic - https://github.com/catc/displace
   * License: MIT
   */
!function(e,t){e.exports=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}var r=i(n(1));e.exports=r.default},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){var e=this,t=this.el,n=this.opts||c,i={};if(t.style.position="absolute",this.handle=n.handle||t,n.constrain){for(var r=n.relativeTo||t.parentNode,u=t,l=0,d=0;u!==r;)u=u.parentNode,(0,a.isRelative)(u)&&(l-=u.offsetLeft,d-=u.offsetTop),u===r&&(l+=u.offsetLeft,d+=u.offsetTop);var g=l+r.offsetWidth-t.offsetWidth,f=d+r.offsetHeight-t.offsetHeight;i.xClamp=(0,a.generateClamp)(l,g),i.yClamp=(0,a.generateClamp)(d,f)}this.opts=n,this.data=i,this.events={mousedown:o.mousedown.bind(this),mouseup:o.mouseup.bind(this),touchstart:o.touchstart.bind(this),touchstop:o.touchstop.bind(this),scrollFix:function(t){e.isDragging&&t.preventDefault()}},this.handleMove=s(this.opts.customMove),this.handle.addEventListener("mousedown",this.events.mousedown,!1),this.handle.addEventListener("touchstart",this.events.touchstart,!1),document.addEventListener("touchmove",this.events.scrollFix,{passive:!1})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=n(3),s=(0,a.generateMoveFn)(),c={constrain:!1,relativeTo:null,handle:null,ignoreFn:null,highlightInputs:!1,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchStop:null,customMove:null},u=function(){function e(t,n){if(i(this,e),!t)throw Error("Must include moveable element");this.el=t,this.opts=n,r.call(this)}return e.prototype.reinit=function(){this.destroy(),r.call(this)},e.prototype.destroy=function(){var e=this.events;this.handle.removeEventListener("mousedown",e.mousedown,!1),document.removeEventListener("mousemove",e.mousemove,!1),document.removeEventListener("mouseup",e.mouseup,!1),this.handle.removeEventListener("touchstart",e.touchstart,!1),document.removeEventListener("touchmove",e.touchmove,!1),document.removeEventListener("touchstop",e.touchstop,!1),document.removeEventListener("touchmove",this.events.scrollFix,{passive:!1})},e}();t.default=function(e,t){return new u(e,t)}},function(e,t){function n(e,t){return function(n){return Math.min(Math.max(n,e),t)}}function i(e){return"relative"===window.getComputedStyle(e).position}function r(){return window.requestAnimationFrame?function(e){var t=e||a;return function(e,n,i){window.requestAnimationFrame((function(){t(e,n,i)}))}}:function(e){return function(t,n,i){(e||a)(t,n,i)}}}function a(e,t,n){e.style.left=t+"px",e.style.top=n+"px"}Object.defineProperty(t,"__esModule",{value:!0}),t.generateClamp=n,t.isRelative=i,t.generateMoveFn=r},function(e,t){function n(e){var t=this.opts;if(t.highlightInputs){var n=e.target.tagName.toLowerCase();if("input"===n||"textarea"===n)return}if(!t.ignoreFn||!t.ignoreFn(e)){if(0===e.button){var r=this.el,a=this.events;"function"==typeof t.onMouseDown&&t.onMouseDown(r,e);var o=e.clientX-r.offsetLeft,s=e.clientY-r.offsetTop;a.mousemove=i.bind(this,o,s),document.addEventListener("mousemove",a.mousemove,!1),document.addEventListener("mouseup",a.mouseup,!1)}e.preventDefault()}}function i(e,t,n){var i=this.el,r=this.opts,a=this.data;"function"==typeof r.onMouseMove&&r.onMouseMove(i,n);var o=n.clientX-e,s=n.clientY-t;return r.constrain&&(o=a.xClamp(o),s=a.yClamp(s)),this.handleMove(i,o,s),n.preventDefault(),!1}function r(e){var t=this.el,n=this.opts,i=this.events;"function"==typeof n.onMouseUp&&n.onMouseUp(t,e),document.removeEventListener("mouseup",i.mouseup,!1),document.removeEventListener("mousemove",i.mousemove,!1)}function a(e){var t=this.opts;if(t.highlightInputs){var n=e.target.tagName.toLowerCase();if("input"===n||"textarea"===n)return}if(!t.ignoreFn||!t.ignoreFn(e)){var i=this.el,r=this.events;"function"==typeof t.onTouchStart&&t.onTouchStart(i,e);var a=e.targetTouches[0],s=a.clientX-i.offsetLeft,c=a.clientY-i.offsetTop;r.touchmove=o.bind(this,s,c),this.isDragging=!0,document.addEventListener("touchmove",r.touchmove,!1),document.addEventListener("touchend",r.touchstop,!1),document.addEventListener("touchcancel",r.touchstop,!1)}}function o(e,t,n){var i=this.el,r=this.opts,a=this.data;"function"==typeof r.onTouchMove&&r.onTouchMove(i,n);var o=n.targetTouches[0],s=o.clientX-e,c=o.clientY-t;return r.constrain&&(s=a.xClamp(s),c=a.yClamp(c)),this.handleMove(i,s,c),n.preventDefault(),!1}function s(e){this.isDragging=!1;var t=this.el,n=this.opts,i=this.events;"function"==typeof n.onTouchStop&&n.onTouchStop(t,e),document.removeEventListener("touchmove",i.touchmove,!1),document.removeEventListener("touchend",i.touchstop,!1),document.removeEventListener("touchcancel",i.touchstop,!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.mousedown=n,t.mousemove=i,t.mouseup=r,t.touchstart=a,t.touchmove=o,t.touchstop=s}])}(Xc);var Qc=U(Xc.exports);function Yc(e){this.shouldDisplayBell=!1,this.KNOWN_WIDGETS={chat:{requires:["portalId","host"]},email:{requires:["mailboxId"]},kb:{requires:["articleLimit","portalId","searchText"]},kbot:{requires:["portalId","host"]},"cxone-expert":{requires:["siteId","searchText"]},"dfo-live":{requires:["base_chat_service_url","brand_hash","brand_id","chat_file_url","channel_id","channel_name"]}},this.notificationType=0;var t=navigator;this.concierge=e,this.journeyViewManager=new nc(e),this.stashedConciergeCss={top:"",bottom:""},this.needsForceBlur=!1,this.state="tab",this.device=Wn(t),this.openWidget=!1,this.widgetLoadPromises={},this.windowHasDragResize=!1,we.log("WidgetManager constructor: device="+this.device),this.device===Ln?this.widgetsType=new Zs(this):this.widgetsType=new Ys(this),this.bridgeListener={},this.initDraggableData()}function Zc(e){var t,n=e.concierge.cacheManager;return e.tabStyle=e.tabStyle||{verticalOffset:"100",verticalAnchor:1,horizontalOffset:"20",cascade:1},n&&e.engagementWidgets&&(t=e.engagementWidgets).conciergeTab&&t.conciergeTab.tabStyle&&(void 0!==t.conciergeTab.tabStyle.verticalOffset&&(e.tabStyle.verticalOffset=t.conciergeTab.tabStyle.verticalOffset),void 0!==t.conciergeTab.tabStyle.verticalAnchor&&(e.tabStyle.verticalAnchor=t.conciergeTab.tabStyle.verticalAnchor),void 0!==t.conciergeTab.tabStyle.horizontalOffset&&(e.tabStyle.horizontalOffset=t.conciergeTab.tabStyle.horizontalOffset),void 0!==t.conciergeTab.tabStyle.cascade&&(e.tabStyle.cascade=t.conciergeTab.tabStyle.cascade)),e.tabStyle}function eu(e,t){var n,i,r,a,o,s=t.widget,c={},u=e.engagementWidgets.widgets[s]?e.engagementWidgets.widgets[s].parameters:{};return"email"===s?(r="mailboxId",i="mailbox ID"):(r="portalId",i="portal ID"),u&&(o=u[r],n=u.host),(a=t[r]||o)||we.log("No Moxie "+i+" specified for engagement."),c[r]=a,Aa(s)&&function(e,t,n){var i=e||t;i||we.log("No Moxie chat host specified for engagement.");n.host=i}(t.host,n,c),c}function tu(e){window.MOXIE_CONCIERGE&&delete window.MOXIE_CONCIERGE.startEngagement,e.dataStartListener&&(Pt([document],"click",e.dataStartListener),delete e.dataStartListener),e.windowHasDragResize&&(Lt(window,"resize",e.dragResizeHandler.bind(this)),e.windowHasDragResize=!1),function(e){e.bridgeListener&&(window.removeEventListener("message",e.bridgeListener,!1),delete e.bridgeListener)}(e)}function nu(e){e.initEngagementWidgets(),Uc(e),Zc(e),function(e){var t=e.widgetsType.html();t=t.replace(/\/DEVICE\//g,e.device);var n=!1;if(e.concierge.cacheManager&&e.engagementWidgets&&(n=e.engagementWidgets).conciergeTab&&n.conciergeTab.icon&&n.conciergeTab.icon.svg){var i=n.conciergeTab.icon.svg;t=t.replace(/<!-- replace: ICON -->/g,i)}var r=cn(t=ls(t)({concierge:e.concierge,CONCIERGE_TAB_ICON_SVG:e.engagementWidgets.conciergeTab.icon.svg,CON_CLOSED:Ma(e)?" single-channel":"",CON_ROLE_ATTRIBUTE:Ma(e)?"":' role="menu"',CLOSE_ICON:e.concierge.getTranslation("common","CLOSE_ICON"),CONCIERGE:e.concierge.getTranslation("common","CONCIERGE"),NOTIFICATION_ANNOUNCE:e.concierge.getTranslation("common","NOTIFICATION_ANNOUNCE")})),a=function(t){if("click"===t.type||13===t.which||32===t.which)return e.closeWidget(!1),!1};Rt(r,"click",Ft("con-close-area"),a),Rt(r,"keypress",Ft("con-close-area"),a);var o=Ft("con-widget-title-section");Rt(r,"keyup",o,(function(){return Yt(this,{outline:"-webkit-focus-ring-color auto 5px"}),!1})),Rt(r,"blur",o,(function(){return Yt(this,{outline:"none"}),!1}));var s=function(t){if("click"===t.type&&Yt(this,{outline:"none"}),"click"===t.type||13===t.which||32===t.which){var n=cn(this).closest(".concierge-widget").data("widget");e.postMessageToWidget(n,"titleClicked");var i=e.engagementWidgets.widgets[n];return i&&i.titleBar&&i.titleBar.onclick&&i.titleBar.onclick(e),!1}};Rt(r,"click",o,s),Rt(r,"keypress",o,s),e.widgetsType.beforeAppend&&e.widgetsType.beforeAppend(r),cn("body").append(r[0]),r.hide()}(e);var t=cn("#concierge .con-icon svg");void 0!==t&&t.length>0&&Pa(t[0]),e.$concierge=cn("#concierge"),e.widgetsType.start()}Yc.prototype.startExternal=function(e,t){var n=this,i=!0===t.enableChatDeflection||"true"===t.enableChatDeflection;null!==t.widget&&void 0!==t.widget||(t.widget=t.startEngagement),"chat"===t.widget&&i&&(t.widget="kbot");var r=[];"kbot"===t.widget||"chat"===t.widget?(r.push("kbot"),r.push("chat")):r.push(t.widget);var a,o=null;if(r.forEach((function(e){if(null===o){var t=function(e,t){var n=!1;return Object.keys(e.spots).forEach((function(i){var r=e.spots[i];r.widget&&r.widget.name===t&&(n=r.twiddled)})),n}(n.wmState,e);t&&(o=e)}})),null!==o){var s=j.resolve(null);return we.log('WidgetManager.startExternal not starting widget "'+t.widget+'" because the spot is twiddled'),(null!==(a=this.wmState).open&&void 0!==a.open?a.open.name:null)!==o&&(we.log('WidgetManager.startExternal is showing existing widget "'+o+'"'),"tab"===this.state&&this.widgetsType.openWidgetMenu&&(s=s.then((function(){return n.widgetsType.openWidgetMenu()}))),s=s.then((function(){return n.showWidget(n.findWidget(o))}))),s.then((function(){return{status:!1}}))}delete t.startEngagement,delete t.enableChatDeflection,t.ruleSource=e;var c=[ei,Zn];if(t.ruleId=-1*(1+c.indexOf(e)),t.action="success",null===t.widget||void 0===t.widget||""===t.widget)return we.log("WidgetManager.startExternal invoked with improper widget specification"),j.resolve({status:!1,invalid:!0});var u=this;bn(t,eu(this,t));var l=null;l="kbot"===t.widget?["kbot","chat"]:"chat"===t.widget?["chat","kbot"]:[t.widget];var d=j.resolve(null);return l.forEach((function(e){var t=n.findWidget(e);null!=t&&(we.log('WidgetManager.startExternal Removing widget: "'+e+'"'),d=d.then((function(){return u.removeWidget(t,!0)})))})),d.then((function(){return function(e,t){var n={name:t.ruleName,source:t.ruleSource,id:t.ruleId,action:t.action},i=j.resolve();return i.then((function(){if(e.notificationDisplayed())return we.log("WidgetManager.displayWidget("+t.widget+":"+t.ruleName+"): is closing the notification"),mo(e.wmState)})).then((function(){return e.addWidget(t,n)})).then((function(n){if(n&&void 0!==n.status&&!1===n.status)return we.log("WidgetManager.displayWidget("+t.widget+":"+t.ruleName+"): halted because addWidget failed"),n;var i=j.resolve(null);return!1!==e.openWidget&&e.openWidget!==t.widget&&(i=i.then((function(){return e.hideWidget(!0)}))),i.then((function(){return e.showWidget(n.ref)})).then((function(){return e.showConcierge()})).then((function(){return e.widgetsType.openConcierge()})).then((function(){return{ref:n.ref,status:!0}}))})).catch((function(e){return we.log("WidgetManager.displayWidget("+t.widget+":"+t.ruleName+"): failed: "+e),we.log(e.stack),xa}))}(n,t)}))},Yc.prototype.findWidget=function(e){for(var t in this.wmState.spots){var n=this.wmState.spots[t];if(n.widget&&n.widget.name===e)return n.widget;if(n.reactive&&n.reactive.name===e)return n.reactive}return this.wmState.offer&&this.wmState.offer.name===e?this.wmState.offer:this.engagementWidgets.widgets[e]},Yc.prototype.initDraggableData=function(){this.widgetAreaDragData||(this.widgetAreaDragData={draggedByUser:!1,initialElemData:null,currentElemData:null,parentData:null,resizedWhileMinimized:!1})},Yc.prototype.removeDraggableData=function(){delete this.widgetAreaDragData},Yc.prototype.dragStartHandler=function(e,t){this.$concierge.find("#concierge-iframe-cover").show(),Te(e,"is-dragging"),this.widgetAreaDragData.currentElemData=e.getBoundingClientRect(),this.widgetAreaDragData.parentData=e.parentNode.getBoundingClientRect(),this.widgetAreaDragData.draggedByUser||(cn(e).addClass(Ta),this.widgetAreaDragData.initialElemData=this.widgetAreaDragData.currentElemData,this.widgetAreaDragData.draggedByUser=!0)},Yc.prototype.dragMaxCalculations=function(){var e,t=document.body.getBoundingClientRect().width-this.widgetAreaDragData.parentData.left,n=0-(this.widgetAreaDragData.currentElemData.width-t),i=this.widgetAreaDragData.parentData.right-this.widgetAreaDragData.initialElemData.right-this.widgetAreaDragData.parentData.width,r=this.widgetAreaDragData.currentElemData.width+i,a=0-r;this.widgetAreaDragData.parentData.left>r&&(a=0-this.widgetAreaDragData.parentData.left);var o=window.visualViewport?window.visualViewport.height:window.innerHeight;if(1===this.tabStyle.verticalAnchor){var s=o-this.widgetAreaDragData.parentData.top;e=0-this.widgetAreaDragData.currentElemData.height+s}else e=o-this.widgetAreaDragData.currentElemData.height-this.widgetAreaDragData.initialElemData.top;return{minX:a,maxX:n,minY:0-this.widgetAreaDragData.parentData.top,maxY:e}},Yc.prototype.dragMoveHandler=function(e,t,n){if(this.widgetAreaDragData.currentElemData){var i=this.dragMaxCalculations(),r=i.minX,a=i.maxX,o=i.minY,s=i.maxY;t=Math.min(t,a),t=Math.max(t,r),n=Math.min(n,s),n=Math.max(n,o)}this.widgetAreaDragData.x=t,this.widgetAreaDragData.y=n,Yt(e,{left:this.widgetAreaDragData.x,top:this.widgetAreaDragData.y})},Yc.prototype.dragConfigData=function(){return{moveableWidgets:this.engagementWidgets.globalSettings.moveableWidgets,tabStyle:this.tabStyle}},Yc.prototype.isDragConfigDataEqualToCurrent=function(e){if("object"!==i(e))return!1;var t=this.dragConfigData();if(e.moveableWidgets!==t.moveableWidgets||"object"!==i(e.tabStyle)||"object"!==i(t.tabStyle))return!1;for(var n=["cascade","horizontalOffset","verticalAnchor","verticalOffset"],r=0;r<n.length;r++){var a=n[r];if(e.tabStyle[a]!==t.tabStyle[a])return!1}return!0},Yc.prototype.dragEndHandler=function(e,t){this.$concierge.find("#concierge-iframe-cover").hide(),De(e,"is-dragging"),void 0===this.widgetAreaDragData.initialConfigData&&(this.widgetAreaDragData.initialConfigData=this.dragConfigData()),this.concierge.cacheManager.setClientCache(ni,{left:this.widgetAreaDragData.x,top:this.widgetAreaDragData.y,initialElemData:this.widgetAreaDragData.initialElemData,initialConfigData:this.widgetAreaDragData.initialConfigData},!0)},Yc.prototype.dragCheck=function(e){var t=[];if("function"==typeof e.composedPath)for(var n=e.composedPath(),i=n.length,r=0;r<i&&n[r].id!==ii;r++)t.push(n[r]);else if(e.target){var a=e.target;for(t.push(a);a.parentNode&&(a=a.parentNode).id!==ii;)t.push(a)}for(var o=["con-widget-icon","clickable-title","con-close-area"],s=0;s<o.length;s++)if(Ae(t,o[s]))return!0;return!1},Yc.prototype.dragFixAfterResize=function(){if(this.widgetAreaDragData&&this.widgetAreaDragData.draggedByUser)if(no(this.wmState)){this.widgetAreaDragData.resizedWhileMinimized=!1;var e=this.$concierge.find("#concierge-widget-area");this.dragStartHandler(e[0]),this.dragMoveHandler(e[0],this.widgetAreaDragData.x,this.widgetAreaDragData.y),this.dragEndHandler(e[0])}else t=this.wmState,n=!1,Object.keys(t.spots).forEach((function(e){t.spots[e].widget&&(n=!0)})),n&&(this.widgetAreaDragData.resizedWhileMinimized=!0);var t,n},Yc.prototype.dragResizeHandler=function(e){this.draggableWidgetArea&&this.dragFixAfterResize()},Yc.prototype.addEventListeners=function(){var e=this;if(window.MOXIE_CONCIERGE=window.MOXIE_CONCIERGE||{},window.MOXIE_CONCIERGE.startEngagement=function(t){return e.startExternal(Zn,t)},this.dataStartListener&&Pt([document],"click",this.dataStartListener),this.dataStartListener=Rt([document],"click",Mt(st,"data-moxie-start-engagement"),(function(t){var n=function(e){var t=/^moxie(.*)/,n={};for(var i in e)if(oe(e,i)&&t.test(i)){var r=i.replace(t,"$1");n[r=r.charAt(0).toLowerCase()+r.slice(1)]=e[i]}return n}(cn(this).data());return e.startExternal(ei,n),!1})),!e.isMobile()&&e.engagementWidgets.globalSettings.moveableWidgets){var t=e.$concierge.find("#concierge-widget-area");t.addClass("moveable-widget"),e.draggableWidgetArea=Qc(t[0],{onMouseDown:e.dragStartHandler.bind(e),onTouchStart:e.dragStartHandler.bind(e),customMove:e.dragMoveHandler.bind(e),onMouseUp:e.dragEndHandler.bind(e),onTouchStop:e.dragEndHandler.bind(e),ignoreFn:e.dragCheck}),e.windowHasDragResize||(Dt(window,"resize",e.dragResizeHandler.bind(e)),window.visualViewport&&Dt(window.visualViewport,"resize",e.dragResizeHandler.bind(e)),e.windowHasDragResize=!0)}},Yc.prototype.isMobile=function(){return this.device===Ln},Yc.prototype.createEngagementRecord=function(e,t){var n=function(e,t){var n=e.name,i=e.parameters.proactive,r=e.parameters.rule,a=Da(t=t||e.name)?"kb":t,o={id:wr(),dirty:!0,time:Date.now(),type:ti[t],name:a,proactive:void 0!==i&&i,rule:void 0!==r?r:null,decision_type:"",kb:null,chat:null,email:null};return Aa(n)?o.chat={agents:[],missed_reason:0}:"email"===n&&(o.email={sent:!1}),o}(e,t);return Zo(this.concierge.cacheManager,n),n.id},Yc.prototype.getEngagementRecord=function(e){return ts(this.concierge.cacheManager,e)},Yc.prototype.setEngagementRecord=function(e,t){return es(this.concierge.cacheManager,e,t)},Yc.prototype.toggleWindow=function(){this.widgetsType.toggleWindow(this)},Yc.prototype.knownWidgets={chat:lc,kbot:Sc,kb:kc,email:mc,"cxone-expert":Oc,"dfo-live":Tc},Yc.prototype.simpleWidgets={link:Hc},Yc.prototype.createWidget=function(e){var t,n=this.concierge;this.knownWidgets[e]?t=this.knownWidgets[e]:this.simpleWidgets[e]&&(t=this.simpleWidgets[e]),t||(t=Io);var i=t.actualName||e,r=new t(n,JSON.parse(JSON.stringify(ya(n,"configuration","widgets","widgets",i)||{})));return r.name=e,r},Yc.prototype.initEngagementWidgets=function(){var e=JSON.parse(JSON.stringify(ya(this.concierge,"configuration","widgets")||{}));e.widgets={},this.engagementWidgets=e,this.wmState=new za(this)},Yc.prototype.addWidget=function(e,t,n){var i,r=e.widget;return(i=this.createWidget(r)).widgetParameters=e,i.parameters=e,i.parameters.rule=t,i.parameters.proactive=i.parameters.proactive||!1,i.engagementId=n,yo(this.wmState,i)},Yc.prototype.removeWidget=function(e,t){e&&(we.log('WidgetManager.removeWidget("'+e.name+'"): invoked.'),function(e,t){if(t){we.log('wmStateRemoveWidget called with: "'+t.name+'"'),e.notification===t&&mo(e);var n=t.spot;if(we.log('wmStateRemoveWidget spotName is: "'+n+'"'),n){var i=Xa(e,n);i.widget&&i.widget.name===t.name&&(i.reactive||i.widget.widgetParameters&&i.widget.widgetParameters.rule.id<0)?(we.log("wmStateRemoveWidget: remove reactive widget of same name"),ao(e,i.widget),Ra(n).remove(),i.reactive=i.widget=null):(we.log("wmStateRemoveWidget: remove not reactive"),i.reactive===t&&(i.reactive=null),i.widget===t&&i.reactive&&oo(e,i.reactive))}}}(this.wmState,e),e.destroy(this),t||cn("#concierge-widgets ul li").length||cn("#concierge").hide())},Yc.prototype.updateWidgetTitle=function(e,t){var n=this.widgetAreaForWidget(e),i=n.find(".concierge-widget-header .con-widget-title"),r=t.text;i.text(r&&this.concierge.getTranslation(e,r,""));var a="";switch(t.buttonType||""){case"minimizeIcon":a=this.concierge.getTranslation("common","MINIMIZE_ICON");break;case"searchIcon":a=this.concierge.getTranslation("common","SEARCH_ICON");break;case"backIcon":a=this.concierge.getTranslation("common","BACK_ICON");break;default:a=""}var o=n.find(".concierge-widget-header .con-widget-icon");o.empty();var s=t.graphic||"";if(s.length){if("<"===s.charAt(0))o.html(s);else{var c=this.concierge.scriptLocation+"/widgets/"+e+"/"+s;o.html('<img src="'+c+'" />')}o.attr("title",a),o.attr("aria-label",a)}var u=n.find(".concierge-widget-header .con-widget-title-section");t.hasCallback?u.addClass("clickable-title").addClass(".clickable-title"):u.removeClass("clickable-title").removeClass(".clickable-title")},Yc.prototype.makePositionAbsolute=function(){var e;"absolute"!==this.$concierge.css("position")&&(this.stashedConciergeCss=this.$concierge.css(["top","bottom"]),e=this.$concierge.offset().top,this.$concierge.css({position:"absolute",top:e,bottom:""}))},Yc.prototype.makePositionFixed=function(){var e,t;"fixed"!==this.$concierge.css("position")&&this.stashedConciergeCss&&(t="auto"!==this.stashedConciergeCss.top?"top":"bottom",e=this.$concierge.offset().top-document.body.scrollTop,this.$concierge.css({position:"fixed",top:e,bottom:"auto"}),"top"===t?ne(this.$concierge,Cs,{top:this.stashedConciergeCss.top},{label:"makePositionFixedTop"}):ne(this.$concierge,Cs,{top:ht()-parseInt(this.stashedConciergeCss.bottom,10)-this.$concierge.height()},{label:"makePositionFixedBottom",done:function(){this.$concierge.css({top:"auto",bottom:this.stashedConciergeCss.bottom})}.bind(this)}))},Yc.prototype.handleGetTabInfo=function(e,t){var n=this.concierge.cacheManager.getWidgetCache(t,"cookieId",!0);n||(n=Math.ceil(1e5*Math.random()),this.concierge.cacheManager.setWidgetCache(t,"cookieId",n,!0)),e.source.postMessage(JSON.stringify(ss({origWindowName:window.name,cookieID:n,currentOrigin:window.location.protocol+window.location.host,previousOrigin:window.location.protocol+window.location.host,sessionId:this.concierge.cacheManager.getWidgetCache(t,"sessionId")})),e.origin)},Yc.prototype.handleSetChatInProgress=function(e,t,n){var i=this.engagementWidgets.widgets[t];i&&void 0!==i.sendSearchGuid&&i.sendSearchGuid(e,n),this.concierge.cacheManager.setWidgetCache(t,"sessionId",Math.abs(parseInt(e))),e>0?this.markChat(e,"start"):e<0&&this.markChat(e,"end")},Yc.prototype.setNotificationType=function(e){return e>=0&&e<=2&&(this.notificationType=e,!0)},Yc.prototype.handleBroadcast=function(e,t,n){if(this[e+"HandleBroadcast"]&&this[e+"HandleBroadcast"](e,t,n))return j.resolve(!0);var i=this,r=this.engagementWidgets.widgets[e],a="widget:"+Na(e)+":"+t;return(r&&r.updateBroadcastPayload?r.updateBroadcastPayload(a,n):j.resolve(n)).then((function(t){if(function(e,t,n,i){try{switch(n){case"widget:chat:agentJoinedSession":Li(e.concierge,!0,t,i.agentId,i.agentName,i.sessionId,i.serviceLine,i.serviceLineId,i.currentServiceLineId);break;case"widget:chat:agentLeftSession":i.agentId&&Li(e.concierge,!1,t,i.agentId,i.agentName,i.sessionId,i.serviceLine,i.serviceLineId);break;case"widget:chat:chatSessionActive":Mi(e.concierge,i.sessionId,i.chatState,t);break;case"widget:chat:chatSessionSuspend":Wi(e.concierge,i.sessionId,t);break;case"widget:chat:chatSessionResume":Ri(e.concierge,i.sessionId,t);break;case"widget:chat:articleViewed":case"widget:kb:articleViewed":case"widget:cxone-expert:articleViewed":Fi(e.concierge,t,i.articleId,i.articleTitle);break;case"widget:chat:articleRated":case"widget:kb:articleRated":case"widget:cxone-expert:articleRated":ji(e.concierge,t,i.articleId,i.articleTitle,i.search,i.ratingType,i.rating);break;case"widget:chat:articleCommented":case"widget:kb:articleCommented":case"widget:cxone-expert:articleCommented":Bi(e.concierge,t,i.articleId,i.articleTitle,i.search,i.ratingType,i.rating,i.comment);break;case"widget:chat:chatSessionStarted":Pi(e.concierge,!0,t,i.sessionId,i.serviceLine,i.serviceLineId);break;case"widget:chat:chatSessionEnded":Pi(e.concierge,!1,t,i.sessionId,i.serviceLine,i.serviceLineId),function(e,t){var n=t.sessionId;n&&e.concierge.cacheManager.setWidgetCache("kbot","lastChatSessionEnded",n,!1)}(e,i);break;case"widget:email:emailSent":Vi(e.concierge,t,i.mailboxId);break;case"widget:kb:portalSearched":case"widget:cxone-expert:portalSearched":case"widget:chat:portalSearched":Gi(e.concierge,t,i.searchText,i.portalId,i.articlesList);break;case"widget:chat:prechatQuestionnaireComplete":zi(e.concierge,t,i.serviceLine,i.serviceLineId)}}catch(e){we.log("Error in processBroadcast"+e)}}(i,e,a,t),"widget:chat:agentJoinedSession"===a)t.device=i.concierge.contextMonitor.getLastDevice(),t.type=i.concierge.widgetManager.engagementWidgets.widgets[e].proactive?"PROACTIVE":"REACTIVE",or(a,t);else or(a,t);return null})).catch((function(e){we.log("handleBroadcast Error:"+e)}))},Yc.prototype.markChat=function(e,t){var n=this.concierge.cacheManager.getData(Vn),i=this.journeyViewManager.markChat(n,e,t);this.concierge.cacheManager.setData(Vn,JSON.stringify(i))},Yc.prototype.showNotification=function(e){we.log("WidgetManager.showNotification called:",e.name),this.wmState.notification!==e&&mo(this.wmState),this.wmState.notification=e,function(e,t){var n=t.parameters,i=n.title,r=n.message,a=n.icon,o=n.callToAction,s=e.widgetsType.getNotification();s.attr("data-spot",t.spot),s.attr("data-widget",t.name),s.find(".concierge-notification-title").text(i||""),s.find(".con-notification-body").html(ja(r));var c=s.find(".con-notification-calltoaction");o&&o.length?(c.show(),c.html(ja(o)),c.attr("tabindex","0")):(c.hide(),c.attr("tabindex","-1"));var u=s.find(".con-notification-icon"),l="";if(a){u.show();var d=e.concierge.scriptLocation+"";Ee(d,"/")||(d+="/"),l='<img alt="" tabindex="-1" src="'+(a=(a=a.replace(/\/SCRIPT_LOCATION\//g,d)).replace(/^http:/,""))+'" role="presentation">'}else u.hide();u.html(l)}(this,e),this.widgetsType.displayNotification(e,e.engagementId),this.setNotificationType(e.notificationType);var t,n,i=Na(e.name);or("notification",{engagementId:e.engagementId,notificationType:Ba(e.notificationType),widgetName:i,status:"displayed",rule:e.parameters.rule}),1===e.notificationType&&"None"!==e.parameters.offer_type&&(t=this.concierge,n=Date.now(),t.cacheManager.setClientCache("lastNotified",n),or("proactiveOffer",{widgetName:i,status:"displayed",rule:e.parameters.rule,device:this.concierge.contextMonitor.getLastDevice()}))},Yc.prototype.notificationDisplayed=function(){return io(this.wmState)},Yc.prototype.broadcastCloseProactiveNotification=function(e,t){var n=e.parameters;or("proactiveOffer",{widgetName:n.widget,status:t,rule:n.rule,device:this.concierge.contextMonitor.getLastDevice()}),"accepted"===t?$i(this.concierge,n.widget,n.rule):"declined"===t&&Ji(this.concierge,n.widget,n.rule)},Yc.prototype.postMessageToWidget=function(e,t,n){var r,a,o=this,s=this.engagementWidgets.widgets[e],c=this.concierge.cacheManager.getWidgetCache(e,"active_session");"willClose"!==t&&"willTerminate"!==t||Oo(this.wmState,s),c&&s.remoteURL&&n?(a=Aa(e)&&"object"===i(s.remoteURL)?s.remoteURL[s.portalId]:s.remoteURL,r=a.match(/^https?:\/\/[^/]+/)[0]):r="*";var u=this.widgetAreaIFrameForWidget(e);if(u.length){var l=u[0].contentWindow,d={widget:e,type:t,parameters:n},g=function(){l.postMessage(ss(d),r),we.log(d.type+" message posted to : "+r),"willTerminate"===t&&o.handleBroadcast(e,"widgetTerminated",{})},f=u.data("loadPromise");return f?f.then(g):ur(g)}return"willTerminate"===t&&o.handleBroadcast(e,"widgetTerminated",{}),j.resolve()},Yc.prototype.callWidgetFunction=function(e,t,n){var r,a,o=this.engagementWidgets.widgets[e];o.remoteURL?(a=Aa(e)&&"object"===i(o.remoteURL)?o.remoteURL[o.portalId]:o.remoteURL,r=a.match(/^https?:\/\/[^/]+/)[0]):r="*";var s=this.widgetAreaIFrameForWidget(e),c=s[0].contentWindow,u={widget:e,type:"functionCall",parameters:{functionName:t,functionData:n}},l=function(){c.postMessage(ss(u),r),we.log(u.type+" message posted to : "+r)};return s.data("loaded")?j.resolve(l()):(s.data("loadPromise")||j.resolve()).then(l)},Yc.prototype.writeSrcToIframe=function(e){if(e!=ri){var t=this.widgetAreaIFrameForWidget(e),n=this.engagementWidgets.widgets[e];if(t.length>0){var i=this.concierge.scriptLocationWithBrand+"/widgets/"+n.getWidgetCodeName()+"/"+this.concierge.assetVersion.widgets+"/index.html?widgetName="+e;t.attr("src",i)}}},Yc.prototype.widgetAreaForWidget=function(e){return this.$concierge.find("#concierge-widget-"+e)},Yc.prototype.widgetAreaIFrameForWidget=function(e){return this.widgetAreaForWidget(e).find("iframe")},Yc.prototype.loadWidget=function(e){var t=e.name,n=e.parameters,i=e.engagementId;if(we.log('WidgetManager.loadWidget("'+t+'", "'+JSON.stringify(n)+'", '+i+'"): invoked.'),!this._disabled){var r=i;if(!e.state){n.rule.source!==Zn&&(e.widgetParameters=n);var a=cn("#concierge-widget-area");if(0===this.widgetAreaForWidget(t).length){var o={widget:e,widgetName:t,CLOSE_ICON:this.concierge.getTranslation("common","CLOSE_ICON"),FOOTER:this.concierge.getTranslation("common","FOOTER")},s="";this.engagementWidgets.globalSettings&&!this.engagementWidgets.globalSettings.hideMoxieBranding&&(s=ls('<div class="concierge-widget-footer concierge-drag-handle">\n  <span class="powered" aria-label="<%= FOOTER %>"><%=FOOTER%></span>\n  <?xml version="1.0" encoding="utf-8"?>\n</div>')(o)),o.moxieBranding=s;var c=t==ri?ls('<div d="concierge-widget-<%= widgetName %>" data-widget="<%= widgetName %>"></div>')(o):ls('<div class="concierge-widget" id="concierge-widget-<%= widgetName %>" data-widget="<%= widgetName %>">\n  <header class="concierge-widget-header concierge-drag-handle">\n    <div class="con-widget-title-section">\n      <div class="con-widget-icon"></div>\n      <h2 class="con-widget-title" tabindex="0"><%= widget.title %></h2>\n    </div>\n    <div class="con-close-area">\n      <button type="button" class="con-close-widget" aria-label="<%= CLOSE_ICON %>">\n        <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20" stroke-width="0">\n          <title><%= CLOSE_ICON %></title>\n          <polygon points="17.3,1.1 10.2,8.3 3.1,1.1 1.3,2.9 8.4,10 1.3,17.1 3.1,18.9 10.2,11.8 17.3,18.9 19.1,17.1 11.9,10 19.1,2.9 "/>\n        </svg>\n      </button>\n    </div>\n  </header>\n\n  <div id="concierge-iframe-cover" class="widget-content"></div>\n  <iframe\n    allow="geolocation"\n    frameborder="no"\n    class="widget-content"\n    aria-live="polite"\n    aria-atomic="true">\n  </iframe>\n  <%= moxieBranding %>\n</div>\n')(o);c=c.replace(/\/SCRIPT_LOCATION\//g,this.concierge.scriptLocation+"/"),a.append(c)}void 0===i&&(i=this.createEngagementRecord(e),r=i),e.state=2,e.proactive=n&&n.proactive||!1,we.log("WidgetManager.loadWidget("+t+"): set widget.proactive="+e.proactive),e.beforeLoad();var u=this,l=this.concierge.cacheManager.getWidgetCache(t,"active_session");if(l||e.shouldReplaceIframeSrc){var d=this.widgetAreaIFrameForWidget(t),g=e.getRemoteURL();we.log("WidgetManager.loadWidget("+t+"): requests iframe src="+g,"hasActive:",l,"shouldReplace:",e.shouldReplaceIframeSrc),d.data("loadPromise",i=new j((function(e){d.attr("src",g),d.on("load",(function(){d.data("loaded")||(d.data("loaded",!0),e(r))}))})))}else void 0!==e.prepareToLoadPromise?e.prepareToLoadPromise.then((function(){u.writeSrcToIframe(t)})):this.writeSrcToIframe(t);this.updateWidgetTitle(t,{text:e.titleBar&&e.titleBar.text?"title":"",graphic:e.titleBar&&e.titleBar.graphic?e.titleBar.graphic:null,buttonType:"chat"==t?"minimizeIcon":""})}var f=this.concierge.getTranslation(t,"title","Concierge");return this.widgetAreaIFrameForWidget(t).attr("title",f),i}},Yc.prototype.replaceWidget=function(e){var t=this,n={status:!0,ref:e,parameters:e.parameters,ruleSettings:this.concierge.rulesEngine.getSiteSettings(),engagementId:e.engagementId};return e.beforeAdd(n).then((function(n){return n&&n.status&&co(t.wmState,e,!0),n}))},Yc.prototype.getSeenChannelsHosts=function(){return this.seenChannelsHosts||(this.seenChannelsHosts=this.concierge.cacheManager.getClientCache("channelsHosts",!0)||[]),this.seenChannelsHosts},Yc.prototype.registerChatHost=function(e){var t=this.getSeenChannelsHosts();ie(t,e)<0&&(t.push(e),this.seenChannelsHosts=t,this.concierge.cacheManager.setClientCache("channelsHosts",t,!0))},Yc.prototype.showWidget=function(e){var t=e.name,n=e.parameters,i=e.engagementId,r=this.wmState;we.log("WidgetManager.showWidget("+t+", "+JSON.stringify(e.parameters)+", "+i+"): invoked.");var a=j.resolve();if(e){var o=this,s=cn("#concierge-widget-area");Aa(t)&&n.host&&this.registerChatHost(n.host),a=a.then((function(){return e.spot&&Wa(r,e)?o.replaceWidget(e):"function"==typeof e.shouldRebuildIframe&&e.shouldRebuildIframe()?(o.widgetAreaIFrameForWidget(t).replaceWith('<iframe frameborder="no" class="widget-content" allow="geolocation" sandbox="allow-scripts allow-forms allow-same-origin allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-top-navigation-by-user-activation"></iframe>'),ur((function(){o.writeSrcToIframe(t)})).then((function(){return o.concierge.cacheManager.removeWidgetCache(t,"rebuildIframe",!1)}))):void 0})).then((function(){e.proactive=n&&n.proactive||!1,we.log("WidgetManager.showWidget("+e.label()+"): set widget.proactive="+e.proactive)})).then((function(){return e.state?j.resolve(o.postMessageToWidget(t,"willShow",n)).then((function(){return o.concierge.cacheManager.getWidgetCache(t,zn,!0)})):o.loadWidget(e)})).then((function(n){return n&&null!==o.getEngagementRecord(n)||(n=o.createEngagementRecord(e)),e.engagementId=i=n,o.concierge.cacheManager.setWidgetCache(t,zn,i,!0)})).then((function(){var e,n=o.getEngagementRecord(i);if(Aa(t)){if(null===n)we.log('WidgetManager.showWidget("'+i+'"): was null.');else if(n.proactive&&void 0===n.chat.time_to_decide){var r=new Date(n.time).getTime();n.chat.time_to_decide=Math.round(((new Date).getTime()-r)/1e3),n.chat.missed_reason=0,n.decision_type="Accepted",e=o.setEngagementRecord(i,n)}}else null!==n&&n.proactive&&(n.decision_type="Accepted",e=o.setEngagementRecord(i,n));return e||(e=j.resolve()),e.then((function(){return o.concierge.contextMonitor.recordEngagementValue()}))})).then((function(){if(o.notificationDisplayed())return we.log("WidgetManager.showWidget("+e.label()+"): ignoring the notification"),mo(r)})).then((function(){return s.addClass("con-open"),o.$concierge.addClass("con-open-widget"),r.open=e,uo(o.wmState,e.spot),"undefined"!=typeof brandembassy&&(e.name===ri?brandembassy("openChatWindow"):brandembassy("hideChatWindow")),o.openWidget!==t?(o.widgetsType.openWidget(e),or("widgetOpened",{widgetName:t,source:n.rule.source}),o.openWidget=t):o.widgetsType.makeWidgetActive(o.widgetAreaForWidget(t)),null}))}return a},Yc.prototype.forceBlur=function(){if(this.needsForceBlur){cn("#concierge").append('<input type="text" id="fakefocus" style="width:1px; height:1px" />');var e=cn("#fakefocus");e.focus(),e.blur(),e.remove(),this.needsForceBlur=!1}},Yc.prototype.hideWidget=function(e){var t=this,n=t.postMessageToWidget(t.openWidget,"willHide");return e||(n=n.then((function(){return Fa(t,!1)}))),"undefined"!=typeof brandembassy&&brandembassy("hideChatWindow"),n},Yc.prototype.closeWidget=function(e){var t=this,n=t.postMessageToWidget(t.openWidget,"willClose"),i=this.wmState.open;return e||t.concierge.cacheManager.getWidgetCache(t.openWidget,"willHandleClose",!0)||(n=n.then((function(){return Fa(t,!0)})).then((function(){i&&i.closeWidget()}))),n},Yc.prototype.fixPosition=function(e){this.widgetsType.fixPosition&&this.widgetsType.fixPosition(e,this.$concierge)},Yc.prototype.expandConcierge=function(){we.log("WidgetManager.expandConcierge(): invoked.")},Yc.prototype.collapseConcierge=function(){we.log("WidgetManager.collapseConcierge(): invoked.")},Yc.prototype.preloadCSS=function(){return Zc(this),function(e){var t="concierge-style-"+e.widgetsType.cssType;return 0===cn("#"+t).length?new j((function(n){var i=e.concierge.scriptLocationWithBrand+"/widgets/"+e.concierge.assetVersion.widgets+"/"+e.widgetsType.cssType+".css",r=document.getElementsByTagName("head")[0],a=document.createElement("link");a.onload=function(){n(!0)},a.id=t,a.rel="stylesheet",a.type="text/css",a.href=i,a.media="all",r.appendChild(a)})):j.resolve(!0)}(this)},Yc.prototype.init=function(){we.log("WidgetManager.init(): invoked."),this.$concierge=cn("#concierge"),0===this.$concierge.length&&nu(this)},Yc.prototype.showConcierge=function(){we.log("WidgetManager.showConcierge(): invoked."),cn("#concierge-widgets ul li").length>0&&cn("#concierge").show()},Yc.prototype.hideConcierge=function(){we.log("WidgetManager.hideConcierge(): invoked."),cn("#concierge").hide()},Yc.prototype.getWidgetPath=function(){return this.concierge.cacheManager.getWidgetCache("chat","widgetpath",!0)||this.concierge.cacheManager.getWidgetCache("kbot","widgetpath",!0)},Yc.prototype.setServiceLineId=function(e,t){var n=this;if(t&&t.parameters){var i=t.name,r=t.parameters;r.serviceLineId!==e.serviceLineId&&(r.serviceLineId=e.serviceLineId,this.concierge.serviceLines.getName(e.serviceLineId).then((function(i){return r.serviceLine=i,r.serviceLineId=e.serviceLineId,r.parameters&&r.parameters.queue&&(r.parameters.queue=e.serviceLineId),Eo(n.wmState,t),null})).catch((function(t){we.log('setServiceLineId("'+i+'", '+JSON.stringify(e)+"): ERROR: "+t)})))}},Yc.prototype.loadActiveWidgets=function(){var e=this,t=e.wmState.wm.concierge.cacheManager.getClientCache("activeWidgets")||[],n=null,i=[];e.loadingActiveWidgets=!0;for(var r=0;r<t.length;r++)t[r].loadParams&&(n=this.concierge.cacheManager.getWidgetCache(t[r].widgetName,zn,!0),i.push(this.addWidget(t[r].loadParams,t[r].loadParams.rule,n).then((function(t){if(t&&t.status)return Eo(e.wmState,t.ref).then((function(n){return uo(e.wmState,t.ref.spot),n}))}))));return j.all(i).finally((function(){delete e.loadingActiveWidgets}))},Yc.prototype.notify=function(e,t){we.log("WidgetManager.notify called with:",e,t);var n=e.widget;"customChannel"==n&&this.simpleWidgets[e.customChannelName]&&(n=e.customChannelName);var i=this.createWidget(n);switch(e.rule=t||{},e.proactive=!0,i.assignParameters(e),e.offer_type){case"Default":default:i.notifier=new _s(e);break;case"None":i.notifier=new Ds(e);break;case"customOffer":i.notifier=new xs(e)}return function(e,t){var n=t.parameters;n.rule=n.rule||{},n.proactive=!0;var i=t.label();if(La(e.concierge))return we.log("wmStateMakeOffer(".concat(i,"): notified too soon")),j.resolve(xa);if(!eo(e,t))return we.log("wmStateMakeOffer(".concat(i,"): cannot display notification")),j.resolve(xa);if(function(e){for(var t=e.active,n=t.length,i=0;i<n;i++)if(t[i].configuration.blockOffersWhileActive)return!0;return!1}(e))return we.log("wmStateMakeOffer(".concat(i,"): blockOffersWhileActive true")),j.resolve(xa);we.log("wmStateMakeOffer(".concat(i,"): invoked."));var r=e.wm,a=r.createEngagementRecord(t);t.engagementId=a;var o={status:!0,ref:t,parameters:t.parameters,engagementId:a,rule:t.parameters.rule};return t.beforeNotify(o).then(Va(r,(function(){return bo(e,t)}))).then(Va(r,(function(){return eo(e,t)?(wo(e,t),t.autoOpen?j.resolve(r.widgetsType.openConcierge(t)).then((function(){return xa})):o):(we.log("WidgetManager.notify("+i+"): cannot display notification after beforeNotify is complete"),j.resolve(xa))}))).then(Va(r,(function(){t.notificationType=1,e.notification=t,t.notifier.showNotification(r,t);var n=r.getEngagementRecord(a);return null!==n&&(n.decision_type="Ignored",r.setEngagementRecord(a,n)),o}))).then(Va(r,(function(e){return we.log("wmStateMakeOffer(".concat(i,"): ready to notify.")),e}))).catch((function(e){var t=e.message?e.message:e;return we.log("wmStateMakeOffer(".concat(i,"): error: ").concat(t,"\n").concat(e.stack)),xa}))}(this.wmState,i)},Yc.prototype.terminateWidget=function(e,t){void 0===t&&(t=!1);var n=this,i=e.name;if(!Aa(i))return j.resolve(!0);if(!So(n.wmState,e)||!function(e,t){return t&&0!==t.state}(n.wmState,e))return j.resolve(!0);var r=new j((function(e,r){var a=null;t&&(a=setTimeout((function(){r("willTerminate not answered with widgetTerminated in timely manner")}),1e3)),n[i+"HandleBroadcast"]=function(t,r){return t===i&&"widgetTerminated"===r&&(null!==a&&clearTimeout(a),delete n[i+"HandleBroadcast"],we.log("WidgetManager.clearHistory: widgetTerminated answered. Resolving Promise"),e(!0),!0)}}));return n.postMessageToWidget(i,"willTerminate").then((function(){return r}))},Yc.prototype.disable=function(){this._disabled=!0},Yc.prototype.enable=function(){this._disabled&&delete this._disabled},Yc.prototype.clearHistory=function(){for(var e=this,t={},n=this.getSeenChannelsHosts(),i=0;i!==n.length;i++)t[n[i]]=!0;var r=j.resolve(!0);e.disable();for(var a=function(t){return function(){return e.removeWidget(t)}},o=function(t){var n=e.getWidgetPath();return function(){var i=document.createElement("iframe");i.setAttribute("id","concierge.clear.history"),i.setAttribute("tabindex","-1"),i.style.display="none",i.style.height="400px",i.style.width="300px";var r,a=t+"/netagent/ClearChatSession.aspx?widgetpath="+n;return i.setAttribute("src",a),i.setAttribute("sandbox","allow-scripts allow-same-origin"),e.concierge.cacheManager.storagePlugin.del("MoxieChat",!0),new j((function(e){var a=function t(n){"SessionCleared"===n.data&&(window.removeEventListener("message",t,!1),n.fromTimeout?e(!1):e(!0))};window.addEventListener("message",a,!1),n&&document.body.appendChild(i),r=window.setTimeout((function(){we.log("WidgetManager.clearHistory("+t+'): timeout waiting for "SessionCleared" event. Proceeding with clearHistory process.'),a({data:"SessionCleared",fromTimeout:!0})}),1e3)})).then((function(e){e&&r&&clearTimeout(r),i.remove?i.remove():null!==i.parentNode&&i.parentNode.removeChild(i)}))}},s=Object.keys(e.wmState.spots),c=[],u=0;u<s.length;u+=1){var l=Xa(e.wmState,s[u]);if(l&&l.widget){var d=s[u];l.widget.parameters&&l.widget.parameters.host&&(t[l.widget.parameters.host]=!0),c.push(e.terminateWidget(l.widget,!0).catch((function(e){we.error("Could not terminate widget in spot "+d+": "+e)})).then(a(l.widget)))}}r=r.then(j.all(c)),c=[];for(var g=Object.keys(t),f=0;f<g.length;f+=1)c.push(o(g[f])());return r=r.then(j.all(c))},Yc.prototype.destroy=function(){if(tu(this),this.draggableWidgetArea&&(this.draggableWidgetArea.destroy(),delete this.draggableWidgetArea,this.removeDraggableData()),this.wmState){for(var e in this.removeWidget(this.wmState.notification),this.wmState.spots){var t=Xa(this.wmState,e);this.removeWidget(t.reactive),this.removeWidget(t.widget)}for(var n=wn(this.wmState.alive),i=0;i<n.length;i++)this.removeWidget(n[i])}cn("#concierge-widget-area .concierge-widget iframe").remove(),cn("#concierge-widget-area .concierge-widget").remove(),window.parent.$&&(window.parent.$("#concierge-widget-area").remove(),window.parent.$("#concierge-tab").remove(),window.parent.$("#concierge-widgets").remove(),this.concierge.cacheManager.storagePlugin.del("MoxieChat",!0)),this.widgetsType.destroy&&this.widgetsType.destroy()},Yc.prototype.isValidEngagementConfig=function(e){var t;if(void 0===e||!e.widget||!this.KNOWN_WIDGETS[e.widget])return!1;for(t=0;t<this.KNOWN_WIDGETS[e.widget].requires.length;t++)if(void 0===e[this.KNOWN_WIDGETS[e.widget].requires[t]])return!1;return!0};var iu=function(){function t(){e(this,t),this.enabled=!0,this.processingError=!1}return n(t,[{key:"log",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.enabled&&console.log&&(t=console).log.apply(t,[e].concat(i))}},{key:"debug",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.enabled&&console.debug&&(t=console).debug.apply(t,[e].concat(i))}},{key:"error",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(console.error&&(t=console).error.apply(t,[e].concat(i)),!this.processingError&&window.GoMoxie&&window.GoMoxie.concierge&&window.GoMoxie.concierge.root)try{this.processingError=!0,rr(window.GoMoxie.concierge.root,JSON.stringify([e].concat(i)))}finally{this.processingError=!1}}},{key:"info",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.enabled&&console.info&&(t=console).info.apply(t,[e].concat(i))}},{key:"warn",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.enabled&&console.warn&&(t=console).warn.apply(t,[e].concat(i))}},{key:"table",value:function(e,t){this.enabled&&console.table&&console.table(e,t)}}]),t}();var ru=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),au=function(){return Math.random().toString(36).substring(7).split("").join(".")},ou={INIT:"@@redux/INIT"+au(),REPLACE:"@@redux/REPLACE"+au(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+au()}};function su(e){if("object"!==i(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function cu(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(cu)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var a=e,o=t,s=[],c=s,u=!1;function l(){c===s&&(c=s.slice())}function d(){if(u)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return o}function g(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(u)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return l(),c.push(e),function(){if(t){if(u)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,l();var n=c.indexOf(e);c.splice(n,1),s=null}}}function f(e){if(!su(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(u)throw new Error("Reducers may not dispatch actions.");try{u=!0,o=a(o,e)}finally{u=!1}for(var t=s=c,n=0;n<t.length;n++){(0,t[n])()}return e}function h(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");a=e,f({type:ou.REPLACE})}function v(){var e,t=g;return e={subscribe:function(e){if("object"!==i(e)||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(d())}return n(),{unsubscribe:t(n)}}},e[ru]=function(){return this},e}return f({type:ou.INIT}),(r={dispatch:f,subscribe:g,getState:d,replaceReducer:h})[ru]=v,r}function uu(e,t){var n=t&&t.type;return"Given "+(n&&'action "'+String(n)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function lu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function du(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function gu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?du(n,!0).forEach((function(t){lu(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):du(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fu(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function hu(e){return function(t){var n=t.dispatch,i=t.getState;return function(t){return function(r){return"function"==typeof r?r(n,i,e):t(r)}}}}var vu=hu();vu.withExtraArgument=hu;var pu=function(e,t){var n=function(e){for(var t=Object.keys(e),n=t.length,i=new Array(n);n--;)i[n]=[t[n],e[t[n]]];return i}(t).filter((function(t){var n=H(t,2),i=n[0];return n[1],i!==e}));return n.reduce((function(e,t){var n=H(t,2);return bn(e,q({},n[0],n[1]))}),{})},mu="function"==typeof CustomEvent?function(e,t){return new CustomEvent(e,{detail:t})}:function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n},yu=function(e,t,n){var i=mu("GoMoxie:"+e,t);return i.version=n,i},wu="ADD_EVENT",bu="ADD_PRIORITY_EVENT",Su="SEND_EVENTS",Cu="SEND_PRIORITY_EVENTS",ku="CLEAR_SENT",Eu="RETRY_SENT",Ou="SET_TIMER_STATE",_u="TERMINATING",Iu=["u","w","W","p","q","V","v","$"],xu={events:[],eventsCount:0,sending:[],batchTimerState:"INITIALIZED",lastServerCallOK:!0,priorityEventAdded:!1,prevState:{},terminating:!1,failureStreak:0};var Tu=function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++){var r=t[i];"function"==typeof e[r]&&(n[r]=e[r])}var a,o=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:ou.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:ou.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+ou.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(n)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var i=!1,r={},s=0;s<o.length;s++){var c=o[s],u=n[c],l=e[c],d=u(l,t);if(void 0===d){var g=uu(c,t);throw new Error(g)}r[c]=d,i=i||d!==l}return(i=i||o.length!==Object.keys(e).length)?r:e}}({schemaVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e},eventService:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xu,t=arguments.length>1?arguments[1]:void 0,n=pu("prevState",e),i=JSON.parse(JSON.stringify(n));if(!e.terminating)switch(t.type){case wu:return bn(n,{prevState:i},{events:[].concat(G(e.events),[pu("type",t)]),eventsCount:e.eventsCount+1});case bu:return bn(n,{prevState:i},{events:[].concat(G(e.events),[pu("type",t)]),eventsCount:e.eventsCount+1,priorityEventAdded:!0})}switch(t.type){case Su:return bn(n,{prevState:i},{events:[],eventsCount:0,sending:e.events});case Cu:return bn(n,{prevState:i},{events:[],eventsCount:0,sending:e.events,priorityEventAdded:!1});case ku:return bn(n,{prevState:i},{sending:[],lastServerCallOK:!0,failureStreak:0});case Eu:return bn(n,{prevState:i},{events:[].concat(G(e.sending),G(e.events)),eventsCount:e.eventsCount+e.sending.length,sending:[],lastServerCallOK:!1,failureStreak:e.failureStreak+1});case Ou:var r=t.value||!1;return bn(n,{prevState:i},{batchTimerState:r});case _u:return bn(n,{prevState:i},{terminating:!0})}return e}});function Du(e,t,n){var i=3e4;return n>0&&(i+=1333*Math.pow(n,2),i=Math.min(3e5,i)),new j((function(n,r){var a=new XMLHttpRequest;a.open("POST",t.serverEndpoint),a.timeout=i,a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json"),a.onload=function(e){return n({status:a.status,body:a.response})},a.onerror=function(e){return n({status:a.status,message:"Could not read error response, probably because CORS headers are missing."})},a.send(JSON.stringify(function(e){for(var t={e:[]},n={},i=JSON.parse(JSON.stringify(e)),r=0;r<Iu.length;r++){var a=Iu[r],o=i.map((function(e){return e.payload[a]})),s=Au(o);if(1===s.length&&void 0!==s[0]){n[a]=s[0];for(var c=0;c<i.length;c++){delete i[c].payload[a]}}}return(t=bn(n,t)).e=i.map((function(e){return e.payload})),t.d=Date.now(),t}(e)))})).catch((function(e){return console.error("Concierge encountered a fatal error when trying to send events:",e),{status:-1,message:e.message}}))}function Au(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];-1===Nu(t,i)&&t.push(i)}return t}function Nu(e,t,n){var i=isFinite(n)?Math.floor(n):0,r=e instanceof Object?e:new Object(e),a=isFinite(r.length)?Math.floor(r.length):0;if(i>=a)return-1;if(i<0&&(i=Math.max(a+i,0)),void 0===t){do{if(i in r&&void 0===r[i])return i}while(++i<a)}else do{if(r[i]===t)return i}while(++i<a);return-1}var Lu=function(e,t){if(e===Cu){var n=new yu("PriorityEvents",{status:t});window.dispatchEvent(n)}},Mu=function(e,t){return function(n,i){if(i().eventService.events.length>0){n({type:e});var r=i().eventService.failureStreak;Du(i().eventService.sending,t,r).then((function(t){t&&!i().eventService.terminating&&(t.status>=200&&t.status<300||t.status>=400&&t.status<500?(Lu(e,!0),n(Ru())):r>=8640?(Lu(e,!1),n(Ru())):(Lu(e,!1),n({type:Eu})))}))}}};function Wu(e){return Mu(Su,e)}function Ru(){return{type:ku}}var Pu="INITIALIZED",Fu="RUNNING",ju="CANCELLED",Bu="EXPIRED",Vu=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};e(this,t),this.timeout_in_ms=n,this.stateChangeCallbackFn=i,this.timerState=Pu}return n(t,[{key:"timerInternalState",value:function(){return this.timerState}},{key:"startTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout_in_ms,n=function(){e.timerState=Bu,e.stateChangeCallbackFn(Bu)};this.timer=setTimeout(n,t),this.timerState=Fu,this.stateChangeCallbackFn(Fu)}},{key:"cancelTimer",value:function(){clearTimeout(this.timer),this.timerState=ju,this.stateChangeCallbackFn(ju)}}]),t}(),Hu=[function(e){var t={schemaVersion:1,eventService:bn({},e.eventService,{terminating:!1})};return bn({},e,t)}],qu=function(e){var t=e.serverEndpoint.indexOf("-")+1,n=e.serverEndpoint.indexOf(".")-t;return e.serverEndpoint.substr(t,n)},Uu=function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Hu,n=e.schemaVersion||0,i=t.length;if(n<i){t.slice(n,i).forEach((function(t){return e=t(e)}))}return e}(function(e){var t=Date.now()-864e5;return e.eventService.events=e.eventService.events.filter((function(e){return e.payload.d>t})),e}(JSON.parse(e)))},$u=function(e){var t,n,i="moxie_"+qu(e)+"EventState";try{var r=localStorage.getItem(i);return null===r?(t=i,n=localStorage.getItem("moxieState"),localStorage.removeItem("moxieState"),localStorage.setItem(t,n),null!=(r=n)?Uu(r):void 0):Uu(r)}catch(e){return}};function Ju(e,t,n){e.subscribe((function(){var i=e.getState().eventService.prevState.eventsCount,r=e.getState().eventService.eventsCount;if(i!==r){var a=e.getState().eventService.prevState.lastServerCallOK,o=e.getState().eventService.lastServerCallOK,s=e.getState().eventService.priorityEventAdded,c=0===e.getState().eventService.sending.length;c&&s?(t.cancelTimer(),e.dispatch(function(e){return Mu(Cu,e)}(n))):c&&o&&r>=5?(t.cancelTimer(),e.dispatch(Wu(n))):0===i&&r>=1?(t.cancelTimer(),o?t.startTimer():t.startTimer(1e4)):!0===a&&!1===o&&(t.cancelTimer(),t.startTimer(1e4))}})),e.subscribe((function(){var t=e.getState().eventService.prevState.batchTimerState,i=e.getState().eventService.batchTimerState;t!==i&&"EXPIRED"===i&&e.dispatch(Wu(n))})),e.subscribe((function(){var t=e.getState().eventService.prevState.eventsCount,i=e.getState().eventService.eventsCount,r=e.getState().eventService.prevState.sending,a=e.getState().eventService.sending,o=e.getState().eventService.terminating;(t!==i||r!==a)&&!o&&function(e,t){var n="moxie_"+qu(t)+"EventState";try{var i=JSON.stringify(e);localStorage.setItem(n,i)}catch(e){return}}(e.getState(),n)}))}var Gu=function(){function t(n){if(e(this,t),this.store=null,this.batchTimer=null,this.config=n,this.startEventService(),void 0===this.config.serverEndpoint)throw"serverEndpoint config value is required for the EventService"}return n(t,[{key:"notifyEventService",value:function(e){this.store.dispatch({type:wu,payload:e})}},{key:"notifyEventServiceImmediately",value:function(e){this.store.dispatch({type:bu,payload:e})}},{key:"startEventService",value:function(){var e=$u(this.config);null!=e&&null!==e.eventService&&void 0!==e.eventService&&(e.eventService.failureStreak=0),this.store=cu(Tu,e,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),i=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},r={getState:n.getState,dispatch:function(){return i.apply(void 0,arguments)}},a=t.map((function(e){return e(r)}));return gu({},n,{dispatch:i=fu.apply(void 0,a)(n.dispatch)})}}}(vu));var t,n=(t=this.store,function(e){t.dispatch({type:Ou,value:e})});this.batchTimer=new Vu(5e3,n),Ju(this.store,this.batchTimer,this.config),this.store.dispatch(Ru()),this.batchTimer.startTimer()}},{key:"stopEventService",value:function(){this.store.dispatch({type:_u}),this.batchTimer.cancelTimer(),this.store.dispatch(Ru()),this.store.dispatch(Wu(this.config)),function(e){var t="moxie_"+qu(e)+"EventState";try{localStorage.removeItem(t)}catch(e){return}}(this.config)}}]),t}(),zu="LOADING",Ku=function(){function t(n){e(this,t),this.engagementWidgetsVersion=null,this.engagementRulesVersion=null,this.assetVersion={rules:0,widgets:0},this.loadState="LOADING",this.scriptElement=n,this.engagementWidgetsVersion=null,this.engagementRulesVersion=null}return n(t,[{key:"logError",value:function(e,t){var n=e+": ";t.stack?n+=t.stack:t.message?n+=t.message:n+=t.toString(),we.error(n)}},{key:"getTranslation",value:function(e,t,n){return this.localization.translate(e+".client."+t,n)}},{key:"registerNamespace",value:function(){window.GoMoxie=window.GoMoxie||{concierge:{root:null},console:we};var e=new iu;return e.enabled=this.isTestMode,ye(we,e),window.GoMoxie.console=we,window.GoMoxie}},{key:"prepare",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};cn("#concierge").remove(),this.url=e,this.pageTitle=t,this.scriptLocation=this.scriptElement.getScriptLocation(),this.brandId=this.scriptElement.getBrandId(),this.brandPrefix=this.brandId?"/brands/".concat(this.brandId):"",this.scriptLocationWithBrand=this.scriptLocation+this.brandPrefix,this.isTestMode=this.scriptElement.getTestMode(),this.logDisabled=this.scriptElement.getLogFlag(),this.clientName=this.scriptElement.getClientName(),this.positionMethod=this.scriptElement.getDisplayConfiguration().positionMethod,this.conciergeHost=this.scriptElement.getConciergeHost(),this.separator=this.scriptElement.getConciergeSeparator(),this.protocol=0===this.scriptLocation.indexOf("https:")?"https:":"http:",this.currentOfferCreatedAt=null,this.gomoxie=this.registerNamespace(),this.loadState=zu,this.serviceUrl={connector:this.protocol+"//connector"+this.separator+this.clientName+"."+this.conciergeHost,location:this.protocol+"//location."+this.conciergeHost,events:this.protocol+"//events"+this.separator+this.clientName+"."+this.conciergeHost+"/1.1/events"},this.assetVersion={rules:0,widgets:0},this.onQuestionnaireLoadedCallbacks=new fa,this.onQuestionnaireSubmitCallbacks=new fa,this.httpGet=this.httpGet||(new _n).get,this.httpGetXMLHttpRequest=this.httpGetXMLHttpRequest||(new _n).getXMLHttpRequest,this.localization=n.localization||new da(this),this.rulesEngine=n.rulesEngine||new Jo(this),this.eventService=n.eventService||new Gu({serverEndpoint:this.serviceUrl.events}),this.publicAPI=n.publicAPI||new os,this.publicAPI.registerMethods(this,this.gomoxie),this.publicApiV2=n.publicApiV2||new as(this,this.gomoxie),this.cacheManager=this.cacheManager||n.cacheManager||new Zr(this),this.widgetManager=n.widgetManager||new Yc(this),this.contextMonitor=n.contextMonitor||new la(this),this.serviceLines=n.serviceLines||new ha(this)}},{key:"prepareAndInit",value:function(e,t,n){return this.prepare(e,t,n),this.init()}},{key:"initAPI",value:function(){var e=this,t="config/latest/".concat("2","/web/configuration.json");-1!==this.url.indexOf("MoxieTest=true")&&sessionStorage.setItem("MoxieConfigCacheBust","true"),"true"===sessionStorage.getItem("MoxieConfigCacheBust")&&(t+="?cacheBuster="+Date.now());var n=this.httpGet("".concat(e.scriptLocationWithBrand,"/").concat(t)).catch((function(n){if(""===e.brandPrefix)throw console.error("Concierge could not load configuration.json"),n;return e.scriptLocationWithBrand=e.scriptLocation,e.brandPrefix="",e.brandId=0,console.error("Concierge could not load configuration.json for brand. Retrying with default"),e.httpGet("".concat(e.scriptLocation,"/").concat(t))}));return this.apiReady=j.all([n.then((function(t){return e.configuration=t,e.assetVersion.widgets=t.widgets.version,e.localization.init(),e.widgetManager.preloadCSS()})),e.cacheManager.init()]).then((function(){return e.contextMonitor.initTracking()})).then((function(){return e.widgetManager.init(),e.rulesEngine.init(e.configuration),e.widgetManager.loadActiveWidgets()})).then((function(){return function(e,t){var n=new xn(e,t,"1.0");try{window.dispatchEvent(n)}catch(t){we.log("PublicAPI.broadcastNow("+e+"): error: "+(t.stack?t.stack:t.message))}return n}("apiReady",void 0)})),this.apiReady}},{key:"init",value:function(){var e,t=this;return this.ready=this.initAPI().then((e=function(){var e,n;return t.contextMonitor.start(),t.rulesEngine.run(),t.widgetManager.addEventListeners(),t.widgetManager.showConcierge(),t.widgetManager.fixPosition(t.positionMethod),e=window.navigator.userAgent,n=/MSIE|Trident/.test(e),e.toLowerCase().indexOf("firefox")>-1?window.addEventListener("unload",Xu):n?window.addEventListener("beforeunload",Qu):window.onpageshow=Yu,Zi(t),or("conciergeReady",void 0),t.loadState="READY",!0},function(){return t.loadState===zu?e():null})),this.ready.catch((function(e){t.loadState="FAILED",t.logError("Concierge Unexpected Error",e),or("conciergeFailedToLoad",void 0)})),this.ready}}]),t}();function Xu(){window.removeEventListener("unload",Xu,!1)}function Qu(){we.log("Prevent BF Cache"),window.removeEventListener("beforeunload",Qu,!1)}function Yu(e){we.log("BackButton: Back Button Listener Added."),e.persisted&&(we.log("BackButton: Persisted state detected. Refreshing."),window.removeEventListener("pageshow",Yu,!1),location.reload())}function Zu(){return function(){var e,t=["JxBrowser","MoxieAgentClient","JavaFX"];for(e=0;e!==t.length;e++)if(-1!==window.navigator.userAgent.indexOf(t[e]))return!1;var n=!1,i=Fr(window.navigator);if(-1!==ie(["chrome","firefox","safari","msie","android"],i[0]))if("msie"===i[0]){if(-1!==window.navigator.userAgent.toLowerCase().indexOf("iemobile"))return!1;n=parseInt(i[1])>=11}else n="android"!==i[0]||parseFloat(i[1])>=5;else n=!1;return n}()}function el(){var e="Concierge failed to load: ";if(!Zu())throw or("conciergeFailedToLoad",e+="unsupported browser"),new Error(e);if(!function(){var e=!1;try{e=void 0!==window.localStorage.getItem("MoxieUndefinedKey")}catch(e){we.error(e)}return e}())throw or("conciergeFailedToLoad",e+="localStorage required"),new Error(e);return!0}function tl(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return nl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return wn(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nl(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function nl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var il=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],rl=/^(?:([^:/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?))?((((?:[^?#/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,al=/^(?:(?![^:@]+:[^:@/]*@)([^:/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#/]*\.[^?#/.]+(?:[?#]|$)))*\/?)?([^?#/]*))(?:\?([^#]*))?(?:#(.*))?)/,ol=/(?:^|&)([^&=]*)=?([^&]*)/g;function sl(e,t){if(!t)return[];for(var n,i=new RegExp(e),r=[];null!==(n=i.exec(t));)r.push(n);return r}var cl=function(){function t(n){e(this,t),el(),this.element=n}return n(t,[{key:"getSourceUri",value:function(){return function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?rl.exec(e):al.exec(e),n={query:"",queryKey:{}},i=14;i--;)n[il[i]]=t[i]||"";var r,a=tl(sl(ol,n.query));try{for(a.s();!(r=a.n()).done;){var o=r.value;o[1]&&(n.queryKey[o[1]]=o[2])}}catch(e){a.e(e)}finally{a.f()}return n}(this.element.src,!1)}},{key:"getTestMode",value:function(){var e=this.getSourceUri();return"true"===(e.queryKey.testmode?e.queryKey.testmode:localStorage.getItem("Moxie_testmode"))}},{key:"getLogFlag",value:function(){var e=this.getSourceUri();return"false"===(e.queryKey.log?e.queryKey.log:localStorage.getItem("Moxie_log"))}},{key:"getBrandId",value:function(){var e=this.getSourceUri();return Number(e.queryKey.brand||"0")}},{key:"getBrandPrefix",value:function(){var e=this.getBrandId();return this.getBrandId()?"/brands/".concat(e):""}},{key:"getAttribute",value:function(e){return this.element.getAttribute(e)}},{key:"getScriptLocation",value:function(){var e=this.getAttribute("data-concierge-script-location");if(e)return e;var t=this.getSourceUri(),n=[t.protocol,"://",t.host];"80"!=t.port&&"443"!=t.port&&t.port&&n.push(":"+t.port);var i=t.path?t.path.split("/").slice(0,-2).join("/"):"";return n.push(i),n.join("")}},{key:"getClientName",value:function(){return this.getAttribute("data-client")?this.getAttribute("data-client"):this.getScriptLocation().match(/([^/]+)$/).pop()}},{key:"getConciergeHost",value:function(){return this.getAttribute("data-concierge-host")?this.getAttribute("data-concierge-host"):"gomoxie.solutions"}},{key:"getConciergeSeparator",value:function(){var e="-",t=this.getSourceUri();return t.queryKey.separator&&(e=t.queryKey.separator),e}},{key:"getDisplayConfiguration",value:function(){var e=this.getAttribute("data-display-config");if(e){var t=JSON.parse(e);if(t&&"object"===i(t))return{positionMethod:t.positionMethod||"css"}}return{positionMethod:"css"}}}],[{key:"getScriptElement",value:function(){for(var e=document.getElementsByTagName("script"),n=0;n<e.length;n++)if(e[n].getAttribute("data-concierge")||e[n].getAttribute("concierge"))return new t(e[n]);return null}}]),t}();!function(){var e;try{el();var t=new Ku(cl.getScriptElement()),n=document.location.href,i=document.title;e=t.prepareAndInit(n,i)}catch(t){we.error(t),e=j.reject(t)}window.conciergeReady=window.conciergeReady||e}()}();
