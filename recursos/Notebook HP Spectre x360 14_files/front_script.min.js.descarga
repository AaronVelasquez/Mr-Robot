define(["jquery",'escaper','fireworks','ouibounce'],function($,escaper){var viewPortWidthVelsof=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var viewPortHeightVelsof=Math.max(document.documentElement.clientHeight,window.innerHeight||0);function changeColor(wheel_color){velsofWheelHexCode=wheel_color;var colorRGB=hexToRgb(velsofWheelHexCode);var hslColorCode=rgb2hsb(colorRGB.r,colorRGB.g,colorRGB.b);document.getElementById("velsof_spinner").style.filter='hue-rotate('+hslColorCode.hue+'deg) saturate('+hslColorCode.sat+'%) contrast(1.1)';}
$(function(){if($('#velsof_wheel_main_container').length){if(wheel_design=='2'){changeColor(wheel_color);}else{velsofWheelHexCode="#4497bb";var colorRGB=hexToRgb(velsofWheelHexCode);var hslColorCode=rgb2hsb(colorRGB.r,colorRGB.g,colorRGB.b);$("#velsof_spinner").css('filter','');}
document.getElementById("velsof_wheel_main_container").style.height=document.documentElement.clientHeight+'px';document.getElementById("velsof_wheel_model").style.height=document.documentElement.clientHeight+'px';if(velsofWheelHexCode!=""){var colorRGB=hexToRgb(velsofWheelHexCode);var hslColorCode=rgb2hsb(colorRGB.r,colorRGB.g,colorRGB.b);}}
codeOnWindowLoad();$('.spin_toggle').on('click',function(){$('#pull_out').hide();$('#velsof_wheel_container').show();setTimeout(function(){$('#velsof_wheel_main_container').addClass('transform');},500);});})
window.onresize=function(){if($('#velsof_wheel_main_container').length){document.getElementById("velsof_wheel_main_container").style.height=document.documentElement.clientHeight+'px';document.getElementById("velsof_wheel_model").style.height=document.documentElement.clientHeight+'px';codeOnWindowLoad();if(window.innerHeight>500){}else{}}}
function hexToRgb(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b;});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null;}
function rgb2hsb(r,g,b){r /=255;g /=255;b /=255;var minVal=Math.min(r,g,b),maxVal=Math.max(r,g,b),delta=maxVal-minVal,HSB={hue:0,sat:0,bri:maxVal},del_R,del_G,del_B;if(delta!==0){HSB.sat=delta / maxVal;del_R=(((maxVal-r)/ 6)+(delta / 2))/ delta;del_G=(((maxVal-g)/ 6)+(delta / 2))/ delta;del_B=(((maxVal-b)/ 6)+(delta / 2))/ delta;if(r===maxVal){HSB.hue=del_B-del_G;}else if(g===maxVal){HSB.hue=(1 / 3)+del_R-del_B;}else if(b===maxVal){HSB.hue=(2 / 3)+del_G-del_R;}
if(HSB.hue<0){HSB.hue+=1;}
if(HSB.hue>1){HSB.hue-=1;}}
HSB.hue*=360;HSB.sat*=100;HSB.bri*=100;return HSB;}
function codeOnWindowLoad(){if($('#velsof_wheel_main_container').length){$('#pull_out_tab').on('click',function(){$('#velsof_wheel_container').show();$('#pull_out_tab').hide();setTimeout(function(){$('#velsof_wheel_main_container').addClass('transform');},500);});$('#spinwheel_exit').on('click',function(){$('#velsof_wheel_main_container').removeClass('transform');setTimeout(function(){$('#velsof_wheel_container').hide();if(show_pull_out==1){$('#pull_out').show();}},500);var d1=new Date();d1.setTime(d1.getTime()+(3*24*60*60*1000));var expires="expires="+d1.toUTCString();document.cookie="knowband_spinwheel_nolucky=1;"+expires+";path=/";});var parsed_settings=jQuery.parseJSON(display_settings);applyModuleConfigurations();$('#vss_next_time_button').on('click',function(){$('#velsof_wheel_main_container').removeClass('transform');setTimeout(function(){$('#velsof_wheel_container').hide();},500);});$('#spinwheel_continue_btn').on('click',function(){if(typeof coupon_display_options!='undefined'&&coupon_display_options!=2){$('.tooltiptext').html(coupon_copied);$('.tooltiptext').show();$.fn.fireworks("destroy");setTimeout(function(){$('.tooltiptext').hide();$('#velsof_wheel_main_container').removeClass('transform');setTimeout(function(){$('#velsof_wheel_container').hide();},500);},1000);}else{$.fn.fireworks("destroy");$('#velsof_wheel_main_container').removeClass('transform');setTimeout(function(){$('#velsof_wheel_container').hide();},500);}});applyAllModuleConfigurations(parsed_settings);if(typeof coupon_display_options!='undefined'&&coupon_display_options!=2){document.getElementById("spinwheel_continue_btn").addEventListener("click",function(){copyToClipboard(document.getElementById("vss_combined_input_field"));});}}}
function applyAllModuleConfigurations(parsed_settings){if(typeof parsed_settings.hide_after!='undefined'){if(parsed_settings.hide_after!='1'){setTimeout(function(){hideSpinWheelAndContainer();},(parseInt(parsed_settings.hide_after)-1)*10*1000);}}
if(typeof parsed_settings.screen_size!='undefined'){var screen=parsed_settings.screen_size.split('_');var width=screen[0];var height=screen[1];if(window.screen.width<width){hideSpinWheelAndContainer(false);}}}
function hideSpinWheelAndContainer(with_timeout){var with_timeout=typeof with_timeout!=='undefined'?with_timeout:true;$('#velsof_wheel_main_container').removeClass('transform');if(with_timeout){setTimeout(function(){$("#velsof_wheel_container").hide();$('#pull_out_tab').show();$('.spin_toggle').hide();},500);}else{$("#velsof_wheel_container").hide();$('#pull_out_tab').show();$('.spin_toggle').hide();}}
function showSpinWheelAndContainer(on_exit){var on_exit=typeof on_exit!=='undefined'?on_exit:true;var return_visit_flag=true;var new_visit_flag=true;var parsed_settings=jQuery.parseJSON(display_settings);if(typeof parsed_settings.whom_to_show!='undefined'){if(parsed_settings.whom_to_show=='2'){if(getCookie('knowband_spinwheel_visitor')=='1'){new_visit_flag=false;}else{var d2=new Date();d2.setTime(d2.getTime()+(30*24*60*60*1000));var expires="expires="+d2.toUTCString();document.cookie="knowband_spinwheel_visitor=1;"+expires+";path=/";new_visit_flag=true;}}else if(parsed_settings.whom_to_show=='3'){if(getCookie('knowband_spinwheel_visitor')=='1'){return_visit_flag=true;}else{var d3=new Date();d3.setTime(d3.getTime()+(30*24*60*60*1000));var expires="expires="+d3.toUTCString();document.cookie="knowband_spinwheel_visitor=1;"+expires+";path=/";return_visit_flag=false;}}}
if(return_visit_flag&&new_visit_flag){if(getCookie('knowband_spinwheel_nolucky')!='1'){if(getCookie('knowband_spinwheel_frequency')!='1'){if(getCookie('knowband_spinwheel_interval')!='1'){if(on_exit){$('#velsof_wheel_container').show();knowSpinWinEvent();}
$('#pull_out_tab').hide();setTimeout(function(){$('#velsof_wheel_main_container').addClass('transform');},500);if(typeof parsed_settings.display_frequency!='undefined'){if(parsed_settings.display_frequency!='1'){if(getCookie('knowband_spinwheel_frequency')=='1'){}else{var d=new Date();if(parsed_settings.display_frequency=='2'){d.setTime(d.getTime()+(1*60*60*1000));}else if(parsed_settings.display_frequency=='3'){d.setTime(d.getTime()+(1*24*60*60*1000));}else if(parsed_settings.display_frequency=='4'){d.setTime(d.getTime()+(7*24*60*60*1000));}else if(parsed_settings.display_frequency=='5'){d.setTime(d.getTime()+(30*24*60*60*1000));}
var expires="expires="+d.toUTCString();document.cookie="knowband_spinwheel_frequency="+parsed_settings.display_frequency+";"+expires+";path=/";}}}
if(typeof display_interval!='undefined'){if(getCookie('knowband_spinwheel_interval')=='1'){}else{var d1=new Date();var days=parseInt(display_interval);d1.setTime(d1.getTime()+(days*24*60*60*1000));var expires="expires="+d1.toUTCString();document.cookie="knowband_spinwheel_interval="+display_interval+";"+expires+";path=/";}}}}}else{$('#pull_out_tab').show();}}}
function playWheelSound(){if(wheel_sound=='1'){setTimeout(function(){var audio=new Audio(wheel_sound_file_path);audio.play();},100);}}
function rotateWheel(event){var allowedTags=['div','span','b','strong','i','em','u','a','img','button','input','label','nav','dd','dl','dt','ul','li','h1','h2','h3','form'];event.stopImmediatePropagation();var email=$('#vss_combined_input_field').val();var error=false;var errmsg='';if(email.trim()==""){error=true;errmsg=email_blank_error;}else if(!isEmail(email.trim())){error=true;errmsg=email_error;}
if(!error){var cus_email=$('#vss_combined_input_field').val();$.ajax({type:"POST",url:urlFrontAjax,dataType:"JSON",data:{ajax:true,customer_email:cus_email,method:'checkWinningAndGenerateCoupon'},beforeSend:function(){$('#velsof_offer_main_container').fadeOut('slow');$('#vss_loader').fadeIn('slow');},success:function(json){if(typeof json['email_recheck_failed']!='undefined'){$('#velsof_offer_main_container').fadeIn('fast');$('#vss_loader').fadeOut('fast');$('.tooltiptext').html(escaper.escapeHtml(json['email_recheck_failed'],allowedTags));$('.tooltiptext').show();setTimeout(function(){$('.tooltiptext').hide();},5000);}else if(typeof json['win']!='undefined'&&json['win']==true){document.getElementById('velsof_spinner').style.animationName='spinwheel_'+json['slice_to_select'];playWheelSound();setTimeout(function(){$('#vss_loader').fadeOut('slow');$('#velsof_main_header').hide();$('#spinwheeltitle').hide();$('.velsof_ul').hide();$('#vss_try_your_luck_button').hide();$('#spinwheel_exit').hide();if(json['coupon_code']){if(show_fireworks=='1'){$('#velsof_wheel_main_container').fireworks();}
var replaced=$("#spin_successmessage").html().replace('{discount}',json['label']);}else{var replaced=$("#spin_successmessage").html().replace('{discount}',coupon_discount_ph);}
$('#spin_successmessage').html(escaper.escapeHtml(replaced,allowedTags));$('#spin_successmessage').show();$('#sucmsgdes').show();$('#spinwheel_continue_btn').show();if(typeof coupon_display_options!='undefined'&&coupon_display_options!='2'){$('#vss_combined_input_field').val(json['coupon_code']);$('#vss_combined_input_field').attr('readonly',true);}else{$('#vss_combined_input_field').hide();$('#spin_sent_on_email').show();}
$('#velsof_offer_main_container').fadeIn('fast');},6000);jQuery.ajax({type:"POST",url:urlFrontAjax,dataType:"JSON",data:{ajax:true,method:'sendEmailWithCouponCode',coupon_code:json['coupon_code'],category_str:json['category_str'],customer_email:cus_email},success:function(json){if(typeof json['error']!='undefined'&&json['error']==true){alert(json['error']);}}});var d1=new Date();d1.setTime(d1.getTime()+(3*24*60*60*1000));var expires="expires="+d1.toUTCString();document.cookie="knowband_spinwheel_nolucky=1;"+expires+";path=/";}else{document.getElementById('velsof_spinner').style.animationName='spinwheel_'+json['slice_to_select'];playWheelSound();setTimeout(function(){$('#vss_loader').fadeOut('slow');if(json['error']){$('#spin_falemsg').html(escaper.escapeHtml(json['error'],allowedTags));}
$('#velsof_main_header').hide();$('#spinwheeltitle').hide();$('.velsof_ul').hide();$('#vss_try_your_luck_button').hide();$('#spinwheel_exit').hide();$('#vss_combined_input_field').hide();$('#spin_falemsg').show();$('#vss_next_time_button').show();$('#velsof_offer_main_container').fadeIn('fast');},6000);}}});}else{$('.tooltiptext').html(errmsg);$('.tooltiptext').show();setTimeout(function(){$('.tooltiptext').hide();},2000);}}
function applyModuleConfigurations(){if(time_display!==''){var time=Number(time_display)*1000;setTimeout(function(){showSpinWheelAndContainer();},time);}else if(scroll_display!==''){window.displayed_through_scroll=false;$(document).on("scroll",function(){if(!window.displayed_through_scroll){var s=$(window).scrollTop(),d=$(document).height(),c=$(window).height();var scrollPercent=(s /(d-c))*100;if(scrollPercent>=scroll_display){showSpinWheelAndContainer();window.displayed_through_scroll=true;}}});}else if(when_exit==true){setTimeout(function(){var popup=ouibounce(document.getElementById("velsof_wheel_container"),{aggressive:true,timer:0,callback:function(){showSpinWheelAndContainer(false);}});},500);}else{showSpinWheelAndContainer();}}
function hideImageBlock(ele){$(ele).parent().hide();}
function getCookie(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}
return"";}
function knowSpinWinEvent(){var knowbandData={'id':'spinandwin','name':'Spin and Win','creative':'','position':pageName5.toLowerCase()};if(!initDataLayer.hasOwnProperty('ecommerce')){initDataLayer.ecommerce={'promoView':{'promotions':[knowbandData]}}}else{if(initDataLayer.ecommerce.hasOwnProperty('promoView')){if(initDataLayer.ecommerce.promoView.hasOwnProperty('promotions')){initDataLayer.ecommerce.promoView.promotions.push(knowbandData);}else{initDataLayer.ecommerce.promoView.promotions=[knowbandData];}}else{initDataLayer.ecommerce.promoView={'promotions':[knowbandData]};}}}
function isEmail(email){var regex=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;if(!regex.test(email)){return regex.test(email);}else{var splChars="+-,/*";var splChars_exist=false;for(var i=0;i<email.length;i++){if(splChars.indexOf(email.charAt(i))!=-1){splChars_exist=true;break;}}
if(splChars_exist){return false;}}
return true;}
function copyToClipboard(elem){var targetId="_hiddenCopyText_";var isInput=elem.tagName==="INPUT"||elem.tagName==="TEXTAREA";var origSelectionStart,origSelectionEnd;if(isInput){target=elem;origSelectionStart=elem.selectionStart;origSelectionEnd=elem.selectionEnd;}else{target=document.getElementById(targetId);if(!target){var target=document.createElement("textarea");target.style.position="absolute";target.style.left="-9999px";target.style.top="0";target.id=targetId;document.body.appendChild(target);}
target.textContent=elem.textContent;}
var currentFocus=document.activeElement;target.focus();target.setSelectionRange(0,target.value.length);var succeed;try{succeed=document.execCommand("copy");}catch(e){succeed=false;}
if(currentFocus&&typeof currentFocus.focus==="function"){currentFocus.focus();}
if(isInput){elem.setSelectionRange(origSelectionStart,origSelectionEnd);}else{target.textContent="";}
return succeed;}
return{rotateWheel:function(e){rotateWheel(e);},getCookie:function(){getCookie();},isEmail:function(email){return isEmail(email);}}});