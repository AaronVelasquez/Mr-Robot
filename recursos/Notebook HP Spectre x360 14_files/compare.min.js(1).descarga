define(["jquery","Magento_Ui/js/modal/alert","jquery/ui","mage/decorate"],function($,alertModal){"use strict";$.widget('mage.compareCategoryItems',{switchClass:"active",currentTabId:"",currentTabTitleId:"",currentTabContentId:"",categoryUrlKey:"",_create:function(){this.element.decorate('list',true);this._switchClass(this.options.switchClass);this._triggerHeader(this.options.headerSelector);this._addToCompare(this.options.addToCompare);this._removeItem(this.options.removeSelector);this._removeAllItems(this.options.clearAllSelector);},_triggerHeader:function(selector){var self=this;$(selector).off().on('click',function(e){e.preventDefault();if(!isHomePage){self.categoryUrlKey=categoryUrlKey;self._activatedCurrentTab();}
$(e.currentTarget).hasClass(self.switchClass)?$(e.currentTarget).removeClass(self.switchClass):$(e.currentTarget).addClass(self.switchClass);});},_switchClass:function(){if(this.options.switchClass==""){this.switchClass="active";}else{this.switchClass=this.options.switchClass;}},_confirm:function(selector,message){$(selector).off().on('click',function(){return confirm(message);});},_addToCompare:function(selector){var self=this;$(selector).off().on('click',function(e){e.preventDefault();self.categoryUrlKey=$(e.currentTarget).data('category-url-key');self.currentTabId=self._getCurrentTabId();self.currentTabTitleId=self._getCurrentTabTitleId();self.currentTabContentId=self._getCurrentTabContentId();self._activatedCurrentTab();var request=$(e.currentTarget).data('post'),productId=$(e.currentTarget).data('product-id'),formKey=$('input[name="form_key"]').val(),compareHeaderElement=$(self.options.headerSelector);if(request.action&&request.data){$.ajaxSetup({showLoader:true});request.data['form_key']=formKey;request.data['isAjax']=true;$.post(request.action,request.data).done(function(response){if(!compareHeaderElement.hasClass('active')){compareHeaderElement.trigger('click');}
if(response.status!=='success'){$(e.currentTarget).trigger('blur');self._showAlertModal(self.options.errorAlertTitle,response.message);}});return false;}
return false;});},_removeItem:function(selector){var self=this;$(selector).off().on('click',function(e){e.preventDefault();var request=$(e.currentTarget).data('post'),formKey=$('input[name="form_key"]').val();var element=$(e.currentTarget);if(request.action&&request.data){$.ajaxSetup({showLoader:true});request.data['form_key']=formKey;request.data['isAjax']=true;$.post(request.action,request.data).done(function(response){if(response.status==='success'){}});return false;}});},_removeAllItems:function(selector){var self=this;$(selector).off().on('click',function(e){e.preventDefault();var urlKey=$(e.currentTarget).data('category-url-key');var tabContentId=self._getCurrentTabContentId(urlKey);var request=$(e.currentTarget).data('post'),formKey=$('input[name="form_key"]').val();var currentActivatedCompareUl=$(e.currentTarget).parent().parent('li.compare-action').parent();var products='';var productIds=self._getProductIds(currentActivatedCompareUl);if(productIds){products=productIds.join(',');}
if(request.action&&request.data&&products){$.ajaxSetup({showLoader:true});request.data['form_key']=formKey;request.data['isAjax']=true;request.data['products']=products;$.post(request.action,request.data).done(function(response){if(response.status==='success'){}});}
return false;});},_getCurrentTabId:function(){return'tab-label-category.compare.'+this.categoryUrlKey+'.list';},_getCurrentTabTitleId:function(){return'tab-label-category.compare.'+this.categoryUrlKey+'.list-title';},_getCurrentTabContentId:function(){return'category.compare.'+this.categoryUrlKey+'.list';},_activatedCurrentTab:function(){$("[id='"+this._getCurrentTabId()+"']").trigger('click');},_isDuplicateProducts:function(productId){var tabContentElement=$("[id='"+this._getCurrentTabContentId()+"']");if(tabContentElement.find('li.item').length<=0){return false;}
var productIds=[];tabContentElement.find('li.item').each(function(index,item){var itemProductId=$(item).attr('data-product-id');productIds.push(parseInt(itemProductId));});if(productIds.length>0){if($.inArray(productId,productIds)===-1){return false;}else{return true;}}else{return false;}},_checkExceedMaxProducts:function(){return $("[id='"+this._getCurrentTabContentId()+"']").find('li.item').length>=this.options.maxProductCount;},_showAlertModal:function(title,content){alertModal({title:title,content:content,actions:{always:function(){}}});return false;},_getProductIds:function(currentActivatedCompareUl){var productIds=[];$(currentActivatedCompareUl).find('li.item').each(function(){productIds.push($(this).attr('data-product-id'));});return productIds;}});return $.mage.compareCategoryItems;});