define(['jquery','mage/translate','mage/template','stellarGlobal','Magento_Catalog/js/price-utils','Magento_Ui/js/modal/alert','swiperSlide7','HPOLS_Catalog/js/popup','jquery/validate'],function($,$t,$temp,stellarGlobal,priceUtils,alert,Swiper,$p){"use strict";$.widget('mage.dynamicDiscountRecommended',{options:{configurable:'',countryArray:['MX','CO','CL','PE','AR',"BR"]},_init:function(){if($(window).width()<1366){$('.product-dynamic-discount .package2-container').width(this.options.productCountLimit*(140+10));}},_bindEvent:function(){var self=this,productRecomEl='.product.info.detailed',sliderItemNum=0,slideConfig={slidesPerView:'auto',spaceBetween:0,observer:true,pagination:{el:productRecomEl+' .swiper-pagination',type:'fraction',formatFractionTotal:function(number){if(number>1){$(productRecomEl).find('.related-title-tabs ul').css({'justify-content':'flex-start'});}else{$(productRecomEl).find('.related-title-tabs ul').css({'justify-content':'center'});}},},navigation:{nextEl:productRecomEl+' .swiper-button-next',prevEl:productRecomEl+' .swiper-button-prev',},};self.mobieAction();$(document).on('ajaxComplete',function(event,xhr,settings){new Swiper(productRecomEl+' .related-title-tabs .swiper',slideConfig);$(document).on('mouseover','.related-title-tabs li:not(.active)',function(){$(this).removeClass('hoverOut').addClass('hover');});$(document).on('mouseout','.related-title-tabs li:not(.active)',function(){var self=$(this);$(this).removeClass('hover').addClass('hoverOut');setTimeout(function(){self.removeClass('hoverOut');self.removeClass('hover');},500);});});$(document).off('click','.related-title-tabs li').on('click','.related-title-tabs li',function(){if($(this).closest('.catalog-product-popup').length>0){sliderItemNum=4;}else{sliderItemNum=5;}
$(this).closest('ul').siblings('.active-tabs').text($(this).find('.related-attribute-title').text());if($(window).width()<768){$(this).closest('ul').slideUp();}
$(this).removeClass('hover').addClass('active').siblings().removeClass('active');if($(this).hasClass('recommend')){$('.recommended-products').show();$('.other-recommend-product').hide();}else{$('.recommended-products').hide();if($(this).parents('#product-related-links').length>0){$('#product-related-links').find('.other-recommend-product').eq($(this).attr('data-related-index')).show().siblings('.other-recommend-product').hide();$('#product-related-links').find('.other-recommend-product').eq($(this).attr('data-related-index')).find('.swiper-button-prev').addClass('swiper-button-disabled');$('#product-related-links').find('.other-recommend-product').eq($(this).attr('data-related-index')).find('.swiper-button-next').removeClass('swiper-button-disabled');}else{$('.other-recommend-product').eq($(this).attr('data-related-index')).show().siblings('.other-recommend-product').hide();$('.other-recommend-product').eq($(this).attr('data-related-index')).find('.swiper-button-prev').addClass('swiper-button-disabled');$('.other-recommend-product').eq($(this).attr('data-related-index')).find('.swiper-button-next').removeClass('swiper-button-disabled');}
var otherId=$('.other-recommend-product').eq($(this).attr('data-related-index')).attr('id');self.swiperItem('.product-data-contents #'+otherId,16,5.5);}});$('.other-recommend-product .swiper-button-prev').unbind('click').bind('click',function(){$(this).closest('.other-recommend-product').find('.swiper-button-hidden-prev').trigger('click');});$('.other-recommend-product .swiper-button-next').unbind('click').bind('click',function(){$(this).closest('.other-recommend-product').find('.swiper-button-hidden-next').trigger('click');});if($(window).width()>768){$('.related-title-tabs').find('li').first().trigger('click');}else{$('.other-recommend-product').hide();}
$(document).off('click','.product-dynamic-discount .recommended-products .product-item-actions .add-to-bubble, .data.item.content .product-item-actions .add-to-bubble').on('click','.product-dynamic-discount .recommended-products .product-item-actions .add-to-bubble, .data.item.content .product-item-actions .add-to-bubble',function(e){e.stopPropagation();var _this=$(this);if(self.options.currentProductType===self.options.configurable){if(!$('form#product_addtocart_form').validate().form()){window.scrollTo(0,0);return false;}}
setTimeout(function(){_this.removeClass('adding');},10);if(!_this.hasClass('button-added')){var productDataStr=$(this).closest('.product-item-info').attr('data-product'),productData=JSON.parse(productDataStr),purchaseMessage=$(this).closest('.product-item-details').find('.purchase-by-purchase-message').attr('data-msg');var result='';$('.package2-container .added-item.active').each(function(){result=result+$(this).attr('data-product-id')+',';});var resultArr=[];if(result){resultArr=result.split(',');}
productData['format_price']=priceUtils.formatPrice(productData.price);productData['purchase_message']=purchaseMessage;productData['url']=productData['url']==='#'?'javaScript:;':productData['url'];var alt=$(this).closest('.product-item-info').find('.product-image-photo').attr('alt');productData['alt']=alt?alt:productData['name'];var template=$temp('#dynamic-discount-template');var templateHtml=template({data:productData});var currentBubbleContent=$(this).closest('.data.item.content > div').find(".product-dynamic-discount .selected-products .package2 .package2-container");var num=2+parseInt(currentBubbleContent.find(".item").length);var addedItems=currentBubbleContent.find('.item .added-item');var productId=resultArr.find(function(value){return parseInt(productData.id)===parseInt(value);});var showProduct=false;if(typeof productId=='undefined'){showProduct=true;}
if(addedItems.length<self.options.productCountLimit&&showProduct){var bubbleContent=$('.product-dynamic-discount .package2 .package2-container');if(bubbleContent.find('.placeholder-item').length>0){bubbleContent.find('.placeholder-item').first().prepend(templateHtml).removeClass('placeholder-item').find('.default-item').hide();_this.addClass('adding');_this.addClass('button-adding');setTimeout(function(){_this.addClass('button-added').removeClass('button-adding').find('span').text($t('Remove Item'));},3000);$('.popup-noRelated-content').find('.selected-products-list').prepend(templateHtml);}else{console.log('end');}}
self.calculateSelectedProductCount();self.resetTotalPrice();self.resetDiscountAmount();var productId=_this.parents('.product-item-info').attr('data-product-id');self.removeSelected('.remove-btn#id-'+productId);$('.product-dynamic-discount .package3').removeClass('noItem').find('button').prop('disabled',false);}else{var productId=_this.parents('.product-item-info').attr('data-product-id');$('.package2-container').find('span#id-'+productId).trigger('click');$(this).removeClass('button-added').find('span').text($t('Add Item'));}});$(document).on('click','#recommended-addtocart-popup',function(e){e.stopPropagation();var _this=$(this);setTimeout(function(){_this.removeClass('adding');},10);if(!_this.hasClass('adding')){var form=$('.product-info-main').find('.product-add-form button.tocart').closest('form');$.ajax({url:form.attr('action'),data:form.serialize(),type:'post',dataType:'json',success:function(){var bubbleSelectedItems=_this.closest('.selected-products').find('.package2-container .item .added-item.active'),mainSku=$("input[name='sku']").val()+'|1';if(bubbleSelectedItems.length>0){var allSelectedRecommendedProductsData=self.getSelectedRecommendedProductsData(bubbleSelectedItems);if(allSelectedRecommendedProductsData.length){self.addRecommendedProductsToCart(allSelectedRecommendedProductsData);}}else{$p.copyForm($('.popup-noRelated-content'),'catalog-popup-noRelated catalog-product-popup');$('.popup-noRelated-content').find('.swiper-button-prev, .swiper-button-next').hide();}}});if(!$('.product-add-form .product-dynamic-discount:first').hasClass('hide')){$('.product-add-form .product-dynamic-discount:first').addClass('hide');}
_this.addClass('adding');}});$(document).off('click','.mobile-related-title-tabs .closeTabs').on('click','.mobile-related-title-tabs .closeTabs',function(){var parentsEL=$(this).closest('.mobile-related-title-tabs'),this_index=parentsEL.find('.swiper-slide-active').attr('data-related-index');var selectedTab=parentsEL.find('.swiper-slide-active .related-attribute-title').text();$(this).closest('.modal-inner-wrap').css('overflow-y','auto');parentsEL.find('.active-tabs').text(selectedTab);parentsEL.find('.swiper-slide-active').addClass('active').siblings().removeClass('active');if($(this).closest('.catalog-product-popup').length>0){$(this).closest('.mobile-related-title-tabs').siblings('.mobile-tabs-bg').hide()}else{if(self.options.countryArray.includes(window.countryId)){$(this).closest('.mobile-related-title-tabs').siblings('.mobile-tabs-bg').css({background:'#fff',zIndex:11});}else{$(this).closest('.mobile-related-title-tabs').siblings('.mobile-tabs-bg').css({background:'#f4f4f4',zIndex:11});}}
parentsEL.find('.tabsWrapper').hide();if(parentsEL.find('.swiper-slide-active').hasClass('recommend')){parentsEL.siblings('.related-title-tabs').find('li').first().trigger('click');}else{var relatedIndex=parentsEL.find('.swiper-slide-active').attr('data-related-index')
parentsEL.siblings('.related-title-tabs').find("li[data-related-index='"+relatedIndex+"']").trigger('click');}
if($(this).closest('.catalog-product-popup').length>0){$('.mobile-related-title-tabs').css('position','static');}else{if($('body').hasClass('overHidden')){$('.mobile-related-title-tabs').css('position','fixed');}else{$('.mobile-tabs-bg').hide();$('.mobile-related-title-tabs').css('position','static');}}})
$(document).off('click','.mobile-related-title-tabs .close').on('click','.mobile-related-title-tabs .close',function(){$('body').removeClass('overHidden');$('.mobile-tabs-bg').hide();$('.mobile-related-title-tabs, .recommended-products, .other-recommend-product').css({position:'static',height:'auto',background:'white'});$('.mobile-related-title-tabs .close-container').hide();$('.recommended-products, .other-recommend-product').removeClass('showFloat');});},doShowDetails:function(selector){if(selector.hasClass('showLess')){selector.text($t('Show more')).removeClass('showLess');selector.closest('li').find('.product-description').hide();selector.parents('li').find('.short-description').hide();}else{selector.text($t('Show less')).addClass('showLess');selector.closest('li').find('.product-description').css('display','flex');selector.parents('li').find('.short-description').css('display','flex');}},mobieAction:function(){var self=this;if($(window).width()<768){$('.other-recommend-product').hide();$(document).off('click','.mobile-related-title-tabs .active-tabs').on('click','.mobile-related-title-tabs .active-tabs',function(){var parentEl=$(this).closest('.mobile-related-title-tabs');$(this).closest('.modal-inner-wrap').scrollTop(0).css('overflow-y','hidden');parentEl.siblings('.mobile-tabs-bg').css({display:'block',zIndex:3333,background:'#969696',opacity:0.9});var slideConfig={direction:'vertical',slidesPerView:'auto',height:32,grabCursor:true,observer:true};$(this).next('.tabsWrapper').show();if($(this).closest('.catalog-product-popup').length>0){new Swiper('.catalog-product-popup .mobile-related-title-tabs .swiper',slideConfig);}else{new Swiper('.mobile-related-title-tabs .swiper',slideConfig);}
$('.mobile-related-title-tabs').css('position','static');})
$(document).on('click',".product-dynamic-discount .selected-products .package2 .item .default-item",function(){$('body').addClass('overHidden');$('.mobile-related-title-tabs').find('.active-tabs').text($('.mobile-related-title-tabs').find('li').first().find('.related-attribute-title').text());$('.mobile-related-title-tabs').find('li').first().trigger('click');if($('.recommended-products').length>0){$('.recommended-products').show();}else{$('.other-recommend-product').first().show();}
var commdedPopupTop,bgColor;if(self.options.countryArray.includes(window.countryId)){bgColor='#fff';$('.mobile-related-title-tabs .close-container').css({display:'flex',justifyContent:'space-between',background:bgColor});$('.mobile-related-title-tabs .close-container').find('.title').show();commdedPopupTop=174;}else{bgColor='#f4f4f4';$('.mobile-related-title-tabs .close-container').css({display:'flex',});commdedPopupTop=180;}
$('.related-title-tabs').find('li').first().trigger('click');$('.mobile-related-title-tabs').show().css({'position':'fixed','background':bgColor});$('.mobile-tabs-bg').css({display:'block',zIndex:11,background:bgColor})
$('.recommended-products, .other-recommend-product').css({'top':commdedPopupTop+'px','height':$(window).height()-commdedPopupTop,'position':'fixed',background:bgColor,'margin':0,padding:'0 0 0 20px'});$('.recommended-products, .other-recommend-product').addClass('showFloat');self.swiperItem('.product.info.detailed .recommended-products',16,5.5);});}},swiperItem:function(container,space,item){var recommendedItemConfig={spaceBetween:space,observer:true,observeSlideChildren:true,breakpoints:{320:{slidesPerView:1,slidesPerGroup:1},360:{slidesPerView:1.15,slidesPerGroup:1},768:{slidesPerView:2.3,slidesPerGroup:3},1024:{slidesPerView:3.2,slidesPerGroup:3},1366:{slidesPerView:4.3,slidesPerGroup:4},1920:{slidesPerView:item,slidesPerGroup:item-.5}},pagination:{el:container+' .swiper-pagination',clickable:true},navigation:{nextEl:container+' .swiper-button-next',prevEl:container+' .swiper-button-prev',clickable:true},on:{slideChangeTransitionEnd:function(){if(this.isEnd){$(container).find('.swiper-button-next').addClass('swiper-button-disabled');}else{$(container).find('.swiper-button-next').removeClass('swiper-button-disabled');}
if(this.isBeginning){$(container).find('.swiper-button-prev').addClass('swiper-button-disabled');}else{$(container).find('.swiper-button-prev').removeClass('swiper-button-disabled');}
$('.swiper-page-number').find('.current').text(this.activeIndex+1);},slideChangeTransitionStart:function(){$(container+' .swiper-pagination').find('span').eq(this.activeIndex).addClass('swiper-pagination-bullet-active').siblings('span').removeClass('swiper-pagination-bullet-active');},paginationRender:function(){var pageNumber="<div class='swiper-page-number'><span class='current'>"+
(this.activeIndex+1)+"</span>/<span class='total'>"+
this.$wrapperEl[0].childElementCount+"</span></div>";if(!$(container+' .swiper-page-number').length){$(container).find('.dynamic-pagination').prepend(pageNumber);}else{$(container+' .swiper-page-number').find('.current').text((this.activeIndex+1));}
if(this.pagination.bullets.length===1){$(container).find('.swiper-button-prev').hide();$(container).find('.swiper-button-next').hide();}else{$(container).find('.swiper-button-prev').show();$(container).find('.swiper-button-next').show();}}},}
if($(window).width()<768){recommendedItemConfig.pagination.dynamicBullets=true;}
new Swiper(container+' .swiper',recommendedItemConfig);},productSwiper:function(slideLength,slidesPerView,container,prev,next){var swipeConfig={slidesPerView:slidesPerView,spaceBetween:0,observable:true,observeSlideChildren:true,navigation:{nextEl:prev,prevEl:next,},breakpoints:{768:{slidesPerView:1,}},};if(slideLength<=slidesPerView){swipeConfig.simulateTouch=false;}else{}
new Swiper(container,swipeConfig);},_create:function(){this._init();this._bindEvent();},removeSelected:function(doAction){var self=this;$(doAction).unbind('click').bind('click',function(){var _this=$(this);setTimeout(function(){_this.removeClass('adding');},10);var productId=parseInt(_this.closest('.added-item.active').attr('data-product-id')),bubbleItems=$('.product-dynamic-discount .package2-container .item');var currentBubbleContent=$(this).closest('.package2-container');var num=2+parseInt(currentBubbleContent.find(".item .added-item.active").length);_this.closest('.item').addClass('placeholder-item');_this.closest('.item').find('.default-item').show();_this.closest('.added-item').remove();var toButton=$('.'+_this.attr('id'));if(toButton.hasClass('button-added')){toButton.removeClass('button-added').find('span').text($t('Add Item'));}else{setTimeout(function(){toButton.removeClass('button-added').find('span').text($t('Add Item'));},3000);}
currentBubbleContent.find('.item .default-item').parent().css('display','block');var bubbleContent=$('.product-dynamic-discount .package2 .package2-container');self.calculateSelectedProductCount();self.resetTotalPrice();self.resetDiscountAmount();_this.addClass('adding');$('.popup-noRelated-content').find('.added-item').each(function(){var productId=$(this).attr('data-product-id');if('id-'+productId===_this.attr('id')){$(this).remove();return false}});if($('.product-dynamic-discount').find('.package2 .added-item').length<=0){$('.product-dynamic-discount .package3').addClass('noItem').find('button').prop('disabled',true);}});},isShowScrollX:function(){var selectedProductsEl=$('.product-dynamic-discount .selected-products'),realTimePackAge2Width=0,packAge2MaxWidth=0,itemsWidth=0;for(var i=0,len=selectedProductsEl.length;i<len;i++){var spWidth=parseInt(selectedProductsEl.eq(i).find('.package2').css('max-width'));if(spWidth>0){packAge2MaxWidth=spWidth;}
var pa2Width=parseInt(selectedProductsEl.eq(i).find('.package2 .package2-container').outerWidth(true));if(pa2Width>0){realTimePackAge2Width=pa2Width;}
var package2Container=selectedProductsEl.eq(i).find('.package2 .package2-container');if(package2Container.is(':visible')){var items=selectedProductsEl.eq(i).find('.package2 .package2-container .item');for(var j=0,itemLen=items.length;j<itemLen;j++){itemsWidth+=parseInt(items.eq(j).outerWidth(true));}}}
var scroll='';selectedProductsEl.find('.package2 .package2-container').css('width',itemsWidth);},calculateSelectedProductCount:function(){var bubbleItems=$('.product-dynamic-discount .package2-container'),firstPackageContainer=bubbleItems.eq(0),addedItems=firstPackageContainer.children('.item').children('.added-item'),productCount=addedItems.length,oneProductText=$t("product added"),otherProductTextBefore=$t('Chosen'),otherProductTextAfter=$t('products'),searchTerm='en-',lang=$("html").attr('lang');$('.product-dynamic-discount .selected-products .package3 #product-count').text(productCount);if(productCount===1&&lang.indexOf(searchTerm)!==-1){$('.product-dynamic-discount .selected-products .package3 #product-count-before').text('');$('.product-dynamic-discount .selected-products .package3 #product-count-after').text(oneProductText);}else{$('.product-dynamic-discount .selected-products .package3 #product-count-before').text(otherProductTextBefore);$('.product-dynamic-discount .selected-products .package3 #product-count-after').text(otherProductTextAfter);}},resetTotalPrice:function(){var totalPrice=this.calculateTotalPrice(),totalFormatPrice=priceUtils.formatPrice(totalPrice);for(var k=0,pddEltLength=$('.product-dynamic-discount').length;k<pddEltLength;k++){$('.product-dynamic-discount').eq(k).find('.package3 .total-price').text(totalFormatPrice);}},calculateTotalPrice:function(){var currentProductPriceTemp=0;if(this.options.currentProductType==='bundle'){currentProductPriceTemp=this.getBundleProductPrice();}else if(this.options.currentProductType==='simple'){var currentProductPrice=$('.product-dynamic-discount .dynamic-main-product').eq(0).attr('data-price');currentProductPriceTemp=parseFloat(currentProductPrice);}else if(this.options.currentProductType===this.options.configurable){currentProductPriceTemp=this.getConfigurableProductPrice();}
var bubbleTotalPrice=this.calculateBubbleTotalPrice();return parseFloat(currentProductPriceTemp+bubbleTotalPrice);},getBundleProductPrice:function(){var offerPrice=0,bundleTotalEl=$('.bundle-popup-block-offer .offer-have-chosen-total');if(bundleTotalEl.length>0){offerPrice=parseFloat(bundleTotalEl.attr('data-total-price'));}
var currentProductPrice=$('.product-dynamic-discount .dynamic-main-product').eq(0).attr('data-price');return parseFloat(currentProductPrice)+offerPrice;},calculateBubbleTotalPrice:function(){var totalPrice=0,bubblePackage2=$('.product-dynamic-discount .package2-container').eq(0),addedItems=bubblePackage2.find('.item .added-item');for(var n=0,len=addedItems.length;n<len;n++){totalPrice+=parseFloat(addedItems.eq(n).attr('data-price'));}
$('.product-dynamic-discount .product-total .total-price').attr('data-bubble-total-price',totalPrice);return totalPrice;},resetDiscountAmount:function(){var bubbleItems=$('.product-dynamic-discount .package2-container').eq(0),totalDiscountAmount=priceUtils.formatPrice(0);if(bubbleItems.find('.added-item').length>0){var discountAmount=this.calculateBubbleToDiscountAmount();var mainProductDiscountAmount=$('.product-dynamic-discount .dynamic-main-product').eq(0).attr('data-main-product-discount-amount');totalDiscountAmount=priceUtils.formatPrice(discountAmount+parseFloat(mainProductDiscountAmount));}
$('.product-dynamic-discount .package3 .discount-amount').text(totalDiscountAmount);},calculateBubbleToDiscountAmount:function(){var totalPrice=0,bubblePackage2=$('.data.item.content .product-dynamic-discount .package2-container').eq(0),addedItems=bubblePackage2.find('.item .added-item');for(var n=0,len=addedItems.length;n<len;n++){totalPrice+=parseFloat(addedItems.eq(n).attr('data-product-discount'));}
$('.product-dynamic-discount .product-total .total-price').attr('data-bubble-total-price',totalPrice);return totalPrice;},recommendCarePackMapping:function(skuMain,sku){if(!skuMain||typeof skuMain=='undefined'){skuMain=$('.product-social-links').find('.sku').text();}
if(!skuMain||!sku){return false;}
var self=this;var recommendCarePackMappingUrl=self.options.recommendCarePackMappingUrl;var recommendCarePackMapping={mainProductSku:skuMain,carePackSkus:sku}
$.ajax({url:recommendCarePackMappingUrl,type:'POST',dataType:'json',data:{'recommendCarePackMapping':recommendCarePackMapping},success:function(response){$.ajaxSetup({showLoader:false});if(response.code!==200){if(response.message){alert({content:response.message});}}
return false;},error:function(response){$.ajaxSetup({showLoader:false});if(response.messages){alert({content:response.message});}}})},addRecommendedProductsToCart:function(sku){var self=this,loading=true;var productId=$("input[name='product']").val();var skuMain=$("input[name='sku']").val();if(sku&&loading){$.ajaxSetup({showLoader:true});$.ajax({url:self.options.addRecommendProductToCartUrl,type:'POST',dataType:'json',data:{'products':sku,'products_detail':'pdp','product_id':productId,'main_sku':skuMain,},beforeSend:function(){loading=false;},complete:function(){loading=true;},success:function(response){$.ajaxSetup({showLoader:false});$('.modal-content form.product_addtocart_form .view-cart').attr('disabled',false);if(response.isAddToCart){var parentProductSku=$('.product-dynamic-discount').children('.selected-products').children('.package1').children('.dynamic-main-product').attr('data-product-sku');var parentProductLine=$('.product-dynamic-discount').children('.selected-products').children('.package1').children('.dynamic-main-product').attr('data-product-pl');var parentProductName=$('.product-dynamic-discount').children('.selected-products').children('.package1').children('.dynamic-main-product').children('a').attr('title');var pageType=$('.product.info.detailed').children('.product.data.items').find('.data.item.title.active').children('a').attr("href");var reg=/related/;var xmethod='';var cookieOfferId=self.getCookie('spos_offer_id'),offerId='';if(!_.isEmpty(cookieOfferId)&&typeof cookieOfferId!=="undefined"&&cookieOfferId!=='null'){offerId=cookieOfferId;}
if(reg.test(pageType)){xmethod='PDP|Recommended products';}else{xmethod='PDP|Special offer';}
var productInfo=response.recommend_products,list=self.getListName();if(!!productInfo){$.each(productInfo,function(i,itemInfo){itemInfo.xsellProdInfo=response.main_message;itemInfo.xsellMethod=xmethod;if(typeof itemInfo.list!=='undefined'){delete itemInfo.list;}
dataLayer.push({'event':'e_addToCart','offerID':offerId,'ecommerce':{'currencyCode':dlCurrencyCode,'add':{'newCart':true,'detail':{'actionField':{'list':list}},'products':[itemInfo]}}})});}else{var dataLayerProducts=response.dataLayerProducts;if(typeof dataLayerProducts.list!=='undefined'){list=dataLayerProducts.list?dataLayerProducts.list:list;delete dataLayerProducts.list;}
dataLayer.push({'event':'e_addToCart','offerID':offerId,'ecommerce':{'currencyCode':dlCurrencyCode,'add':{'newCart':true,'detail':{'actionField':{"list":list}},'products':[dataLayerProducts]}}})}
$(".product-dynamic-discount .selected-products .package2 .package2-container .added-item[data-product-sku='"+sku+"']").attr('quote-item-id',response.quoteItemId);$p.copyForm($('.popup-noRelated-content'),'catalog-popup-noRelated catalog-product-popup from-dynamic-discount');var slideLength=$('.popup-noRelated-content').find('.added-item').length;self.productSwiper(slideLength,2,'.popup-noRelated-content .swiper','.popup-noRelated-content .swiper-button-prev','.popup-noRelated-content .swiper-button-next')
self.recommendCarePackMapping(skuMain,sku);self.handleAddToCartSuccess(response);}else{if(response.messages){alert({content:response.message});}else{alert({content:errorMsg});}
return false;}},error:function(response){$.ajaxSetup({showLoader:false});if(response.messages){alert(response.messages);}}});}},handleAddToCartSuccess:function(data){},getListName:function(){var recommendProductItems=$('.product .product-data-items #product-related-links .recommended-products .product-items.recommendedproducts'),name=pageName5.toLowerCase(),list=recommendProductItems.attr('data-title');if(list){return list;}else if(name==='pdp'){return'pdp page';}else if(name==='search'){return'search results'}else{return name;}},getCookie:function(cookieName){var cookie=" "+document.cookie;var search=" "+cookieName+"=";var setStr='null';var offset=0;var end=0;if(cookie.length>0){offset=cookie.indexOf(search);if(offset!==-1){offset+=search.length;end=cookie.indexOf(";",offset);if(end===-1){end=cookie.length;}
setStr=unescape(cookie.substring(offset,end));}}
return(setStr);},getSelectedRecommendedProductsData:function(bubbleSelectedItems){var allSelectedRecommendedProductsData=[];for(var i=0;i<bubbleSelectedItems.length;i++){var bubbleProductSku=bubbleSelectedItems.eq(i).attr('data-product-sku'),bubbleProductQty=1;allSelectedRecommendedProductsData.push(bubbleProductSku+'|'+bubbleProductQty);}
return allSelectedRecommendedProductsData.toString();},deleteRecommendedProductsToCart:function(quoteItemId){var self=this,loading=true,form_key=$.mage.cookies.get('form_key');if(loading&&quoteItemId){$.ajaxSetup({showLoader:true});$.ajax({url:self.options.deleteRecommendProductFromCartUrl,data:{'id':quoteItemId,'form_key':form_key,'isAjax':true,},type:'post',dataType:'json',beforeSend:function(){loading=false;},complete:function(){loading=true;}}).done(function(response){$.ajaxSetup({showLoader:false});if(response.success){}else{var msg=response.error_message;if(msg){alert({content:$.mage.__(msg)});}}}).fail(function(error){$.ajaxSetup({showLoader:false});console.log(JSON.stringify(error));});}},getConfigurableProductPrice:function(){var currentProductPrice=$('.product-dynamic-discount .main-product').eq(0).attr('data-price');return parseFloat(currentProductPrice);}});return $.mage.dynamicDiscountRecommended;});