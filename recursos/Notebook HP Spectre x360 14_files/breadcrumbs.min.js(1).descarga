define(['jquery','Magento_Theme/js/model/breadcrumb-list','fancybox'],function($,breadcrumbList){'use strict';return function(widget){$.widget('mage.breadcrumbs',widget,{options:{categoryUrlSuffix:'',useCategoryPathInUrl:false,product:'',catalog:[],categoryIds:'',tag:[],tagIds:'',rewrite:0,categoryItemSelector:'.category-item',menuContainer:'[data-action="navigation"] > ul'},_render:function(){if(this.options.rewrite){this._rewriteHomeText();}else{this._appendCatalogCrumbs();this._bind();this._super();}},_bind:function(){var self=this;$(".breadcrumbs").on('click','.item.back',function(){var url=self.getPrevBreadcrumbsUrl();if(url===undefined){url=BASE_URL;}
location.href=url;});},getPrevBreadcrumbsUrl:function(){return $(".breadcrumbs ul.items li.item").eq(-2).find('a').attr('href');},_appendCatalogCrumbs:function(){if(this.isMobile()){this._addBreadcrumb();var lastBreadcrumb=breadcrumbList.pop();lastBreadcrumb.label='< '+lastBreadcrumb.label;lastBreadcrumb.name='home';breadcrumbList.shift();breadcrumbList.push(lastBreadcrumb);breadcrumbList.push({'name':'last','label':'','link':'','title':''});}else{var categoryCrumbs=this._resolveCategoryCrumbs();var homeCrumb=function(){return{name:'back',label:'< '+$.mage.__('Back'),title:$.mage.__('Go to Back'),link:null,first:true,last:true,readonly:true};};breadcrumbList.unshift(homeCrumb());categoryCrumbs.forEach(function(crumbInfo){breadcrumbList.push(crumbInfo);});this._addBreadcrumb();if(this.options.product){breadcrumbList.push(this._getProductCrumb());}}},_addBreadcrumb:function(){if(!$.isEmptyObject(this.options.catalog)&&this.options.categoryIds.length){var catalog=this.options.catalog;var categoryIds=this.options.categoryIds;for(var i=0,len=categoryIds.length;i<len;i++){var categoryLabel=catalog['category'+categoryIds[i]].label;var categoryLink=catalog['category'+categoryIds[i]].link;var categoryCrumb=this._getCategoryCrumbs(categoryLabel,categoryLink);breadcrumbList.push(categoryCrumb);}}
if(!$.isEmptyObject(this.options.tag)&&this.options.tagIds.length){var tag=this.options.tag;var tagIds=this.options.tagIds;for(var i=0,len=tagIds.length;i<len;i++){var tagLabel=tag['tag'+tagIds[i]].label;var tagLink=tag['tag'+tagIds[i]].link;var tagCrumb=this._getTagCrumbs(tagLabel,tagLink);breadcrumbList.push(tagCrumb);}}},isMobile:function(){return $('body').width()<768;},_getCategoryCrumbs:function(categoryLabel,categoryLink){return{'name':'category','label':categoryLabel,'link':categoryLink,'title':''};},_getTagCrumbs:function(tagLabel,tagLink){return{'name':'tag','label':tagLabel,'link':tagLink,'title':''};},_resolveCategoryCrumbs:function(){var menuItem=this._resolveCategoryMenuItem(),categoryCrumbs=[];if(menuItem!==null&&menuItem.length){categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));while((menuItem=this._getParentMenuItem(menuItem))!==null){categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));}}
return categoryCrumbs;},_getCategoryCrumb:function(menuItem){return{'name':'category','label':menuItem.text(),'link':menuItem.attr('href'),'title':''};},_getProductCrumb:function(){return{'name':'product','label':this.options.product,'link':'','title':''};},_getParentMenuItem:function(menuItem){var classes,classNav,parentClass,parentMenuItem=null;if(!menuItem){return null;}
classes=menuItem.parent().attr('class');classNav=classes.match(/(nav\-)[0-9]+(\-[0-9]+)+/gi);if(classNav){classNav=classNav[0];parentClass=classNav.substr(0,classNav.lastIndexOf('-'));if(parentClass.lastIndexOf('-')!==-1){parentMenuItem=$(this.options.menuContainer).find('.'+parentClass+' > a');parentMenuItem=parentMenuItem.length?parentMenuItem:null;}}
return parentMenuItem;},_resolveCategoryMenuItem:function(){var categoryUrl=this._resolveCategoryUrl(),categoryMenuItem=null;var category;category=categoryUrl.match()
return categoryMenuItem;},_resolveCategoryUrl:function(){var categoryUrl;if(this.options.useCategoryPathInUrl){categoryUrl=window.location.href.split('?')[0];categoryUrl=categoryUrl.substring(0,categoryUrl.lastIndexOf('/'))+
this.options.categoryUrlSuffix;}else{categoryUrl=document.referrer;if(categoryUrl.indexOf('?')>0){categoryUrl=categoryUrl.substr(0,categoryUrl.indexOf('?'));}}
return categoryUrl;},_rewriteHomeText:function(){var newText;var aObj=$(".breadcrumbs ul.items .item.home a");var home=aObj.text().replace(/(^\s*)|(\s*$)/g,"");if(this.isMobile()){if(home.indexOf("<")==-1){newText="< "+$.mage.__('Home');aObj.text(newText);}}else{if(home.indexOf("<")==0){newText=$.mage.__('Home');aObj.text(newText);}}}});return $.mage.breadcrumbs;};});