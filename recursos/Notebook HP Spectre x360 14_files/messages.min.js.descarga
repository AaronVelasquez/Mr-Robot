define(['jquery','uiComponent','Magento_Customer/js/customer-data','underscore','escaper','jquery/jquery-storageapi'],function($,Component,customerData,_,escaper){'use strict';return Component.extend({defaults:{cookieMessages:[],messages:[],allowedTags:['div','span','b','strong','i','em','u','a']},initialize:function(){this._super();this.cookieMessages=_.unique($.cookieStorage.get('mage-messages'),'text');this.revertEscapedMessage();this.messages=customerData.get('messages').extend({disposableCustomerData:'messages'});if(!_.isEmpty(this.messages().messages)){customerData.set('messages',{});}
$.mage.cookies.set('mage-messages','',{samesite:'strict',domain:''});},prepareMessageForHtml:function(message){return escaper.escapeHtml(message,this.allowedTags);},revertEscapedMessage:function(){if(enableMessageEscaped&&!_.isEmpty(messageEscapedRules)&&!_.isEmpty(this.cookieMessages)){var _this=this;$.each(this.cookieMessages,function(index,message){for(var escaped in messageEscapedRules){if(messageEscapedRules.hasOwnProperty(escaped)){var reg=new RegExp(escaped,'g');message.text=message.text.replace(reg,messageEscapedRules[escaped]);}}
_this.cookieMessages[index].text=message.text;});}},afterLoaded:function(element){$(element).removeClass('hide');},closeMessage:function(data,event){if(event.currentTarget){$(event.currentTarget).closest('.messages').remove();customerData.set('messages',{});$.mage.cookies.set('mage-messages','',{samesite:'strict',domain:''});}}});});